{
  "version": 3,
  "file": "agent-manager.js",
  "sources": [
    "../../../../node_modules/.pnpm/react-i18next@15.5.1_i18nex_26c01b18dbeb0f7eddd0145ddd558473/node_modules/react-i18next/dist/es/I18nextProvider.js",
    "../../../../node_modules/.pnpm/lucide-react@0.518.0_react@18.3.1/node_modules/lucide-react/dist/esm/icons/arrow-right-left.js",
    "../../../../node_modules/.pnpm/lucide-react@0.518.0_react@18.3.1/node_modules/lucide-react/dist/esm/icons/circle-alert.js",
    "../../../../node_modules/.pnpm/lucide-react@0.518.0_react@18.3.1/node_modules/lucide-react/dist/esm/icons/circle-check.js",
    "../../../../node_modules/.pnpm/lucide-react@0.518.0_react@18.3.1/node_modules/lucide-react/dist/esm/icons/circle.js",
    "../../../../node_modules/.pnpm/lucide-react@0.518.0_react@18.3.1/node_modules/lucide-react/dist/esm/icons/layers.js",
    "../../../../node_modules/.pnpm/lucide-react@0.518.0_react@18.3.1/node_modules/lucide-react/dist/esm/icons/loader.js",
    "../../../../node_modules/.pnpm/lucide-react@0.518.0_react@18.3.1/node_modules/lucide-react/dist/esm/icons/refresh-cw.js",
    "../../../../node_modules/.pnpm/lucide-react@0.518.0_react@18.3.1/node_modules/lucide-react/dist/esm/icons/terminal.js",
    "../../../../node_modules/.pnpm/jotai@2.15.2_@babel+core@7._1bb0e1b94000813c5b2923e025f70c2a/node_modules/jotai/esm/vanilla/internals.mjs",
    "../../../../node_modules/.pnpm/jotai@2.15.2_@babel+core@7._1bb0e1b94000813c5b2923e025f70c2a/node_modules/jotai/esm/vanilla.mjs",
    "../../../../node_modules/.pnpm/jotai@2.15.2_@babel+core@7._1bb0e1b94000813c5b2923e025f70c2a/node_modules/jotai/esm/react.mjs",
    "../../../../node_modules/.pnpm/jotai@2.15.2_@babel+core@7._1bb0e1b94000813c5b2923e025f70c2a/node_modules/jotai/esm/vanilla/utils.mjs",
    "../../../../webview-ui/src/kilocode/agent-manager/state/sessionStateMachine.ts",
    "../../../../webview-ui/src/kilocode/agent-manager/state/atoms/sessions.ts",
    "../../../../webview-ui/src/kilocode/agent-manager/state/atoms/stateMachine.ts",
    "../../../../webview-ui/src/kilocode/agent-manager/state/atoms/messages.ts",
    "../../../../webview-ui/src/kilocode/agent-manager/state/atoms/todos.ts",
    "../../../../webview-ui/src/kilocode/agent-manager/state/atoms/branches.ts",
    "../../../../webview-ui/src/kilocode/agent-manager/state/hooks/extractTodosFromMessages.ts",
    "../../../../webview-ui/src/kilocode/agent-manager/state/hooks/useAgentManagerMessages.ts",
    "../../../../webview-ui/src/kilocode/agent-manager/state/atoms/messageQueue.ts",
    "../../../../webview-ui/src/kilocode/agent-manager/utils/vscode.ts",
    "../../../../webview-ui/src/kilocode/agent-manager/state/hooks/useMessageQueueProcessor.ts",
    "../../../../webview-ui/src/kilocode/agent-manager/utils/timeUtils.ts",
    "../../../../webview-ui/src/kilocode/agent-manager/components/SessionSidebar.tsx",
    "../../../../webview-ui/src/kilocode/agent-manager/components/SimpleMarkdown.tsx",
    "../../../../webview-ui/src/kilocode/agent-manager/components/FollowUpSuggestions.tsx",
    "../../../../webview-ui/src/kilocode/agent-manager/components/CommandExecutionBlock.tsx",
    "../../../../webview-ui/src/kilocode/agent-manager/components/MessageList.tsx",
    "../../../../webview-ui/src/kilocode/agent-manager/components/AgentTodoList.tsx",
    "../../../../webview-ui/src/kilocode/agent-manager/components/ChatInput.tsx",
    "../../../../webview-ui/src/kilocode/agent-manager/components/BranchPicker.tsx",
    "../../../../webview-ui/src/kilocode/agent-manager/components/KiloLogo.tsx",
    "../../../../webview-ui/src/kilocode/agent-manager/components/SessionDetail.tsx",
    "../../../../webview-ui/src/kilocode/agent-manager/components/AgentManagerApp.tsx",
    "../../../../webview-ui/src/kilocode/agent-manager/index.tsx"
  ],
  "sourcesContent": [
    "import { createElement, useMemo } from 'react';\nimport { I18nContext } from './context.js';\nexport function I18nextProvider({\n  i18n,\n  defaultNS,\n  children\n}) {\n  const value = useMemo(() => ({\n    i18n,\n    defaultNS\n  }), [i18n, defaultNS]);\n  return createElement(I18nContext.Provider, {\n    value\n  }, children);\n}",
    "/**\n * @license lucide-react v0.518.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m16 3 4 4-4 4\", key: \"1x1c3m\" }],\n  [\"path\", { d: \"M20 7H4\", key: \"zbl0bi\" }],\n  [\"path\", { d: \"m8 21-4-4 4-4\", key: \"h9nckh\" }],\n  [\"path\", { d: \"M4 17h16\", key: \"g4d7ey\" }]\n];\nconst ArrowRightLeft = createLucideIcon(\"arrow-right-left\", __iconNode);\n\nexport { __iconNode, ArrowRightLeft as default };\n//# sourceMappingURL=arrow-right-left.js.map\n",
    "/**\n * @license lucide-react v0.518.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"8\", y2: \"12\", key: \"1pkeuh\" }],\n  [\"line\", { x1: \"12\", x2: \"12.01\", y1: \"16\", y2: \"16\", key: \"4dfq90\" }]\n];\nconst CircleAlert = createLucideIcon(\"circle-alert\", __iconNode);\n\nexport { __iconNode, CircleAlert as default };\n//# sourceMappingURL=circle-alert.js.map\n",
    "/**\n * @license lucide-react v0.518.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"m9 12 2 2 4-4\", key: \"dzmm74\" }]\n];\nconst CircleCheck = createLucideIcon(\"circle-check\", __iconNode);\n\nexport { __iconNode, CircleCheck as default };\n//# sourceMappingURL=circle-check.js.map\n",
    "/**\n * @license lucide-react v0.518.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }]];\nconst Circle = createLucideIcon(\"circle\", __iconNode);\n\nexport { __iconNode, Circle as default };\n//# sourceMappingURL=circle.js.map\n",
    "/**\n * @license lucide-react v0.518.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z\",\n      key: \"zw3jo\"\n    }\n  ],\n  [\n    \"path\",\n    {\n      d: \"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12\",\n      key: \"1wduqc\"\n    }\n  ],\n  [\n    \"path\",\n    {\n      d: \"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17\",\n      key: \"kqbvx6\"\n    }\n  ]\n];\nconst Layers = createLucideIcon(\"layers\", __iconNode);\n\nexport { __iconNode, Layers as default };\n//# sourceMappingURL=layers.js.map\n",
    "/**\n * @license lucide-react v0.518.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 2v4\", key: \"3427ic\" }],\n  [\"path\", { d: \"m16.2 7.8 2.9-2.9\", key: \"r700ao\" }],\n  [\"path\", { d: \"M18 12h4\", key: \"wj9ykh\" }],\n  [\"path\", { d: \"m16.2 16.2 2.9 2.9\", key: \"1bxg5t\" }],\n  [\"path\", { d: \"M12 18v4\", key: \"jadmvz\" }],\n  [\"path\", { d: \"m4.9 19.1 2.9-2.9\", key: \"bwix9q\" }],\n  [\"path\", { d: \"M2 12h4\", key: \"j09sii\" }],\n  [\"path\", { d: \"m4.9 4.9 2.9 2.9\", key: \"giyufr\" }]\n];\nconst Loader = createLucideIcon(\"loader\", __iconNode);\n\nexport { __iconNode, Loader as default };\n//# sourceMappingURL=loader.js.map\n",
    "/**\n * @license lucide-react v0.518.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\", key: \"v9h5vc\" }],\n  [\"path\", { d: \"M21 3v5h-5\", key: \"1q7to0\" }],\n  [\"path\", { d: \"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\", key: \"3uifl3\" }],\n  [\"path\", { d: \"M8 16H3v5\", key: \"1cv678\" }]\n];\nconst RefreshCw = createLucideIcon(\"refresh-cw\", __iconNode);\n\nexport { __iconNode, RefreshCw as default };\n//# sourceMappingURL=refresh-cw.js.map\n",
    "/**\n * @license lucide-react v0.518.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 19h8\", key: \"baeox8\" }],\n  [\"path\", { d: \"m4 17 6-6-6-6\", key: \"1yngyt\" }]\n];\nconst Terminal = createLucideIcon(\"terminal\", __iconNode);\n\nexport { __iconNode, Terminal as default };\n//# sourceMappingURL=terminal.js.map\n",
    "function hasInitialValue(atom) {\n  return \"init\" in atom;\n}\nfunction isActuallyWritableAtom(atom) {\n  return !!atom.write;\n}\nfunction isAtomStateInitialized(atomState) {\n  return \"v\" in atomState || \"e\" in atomState;\n}\nfunction returnAtomValue(atomState) {\n  if (\"e\" in atomState) {\n    throw atomState.e;\n  }\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && !(\"v\" in atomState)) {\n    throw new Error(\"[Bug] atom state is not initialized\");\n  }\n  return atomState.v;\n}\nconst promiseStateMap = /* @__PURE__ */ new WeakMap();\nfunction isPendingPromise(value) {\n  var _a;\n  return isPromiseLike(value) && !!((_a = promiseStateMap.get(value)) == null ? void 0 : _a[0]);\n}\nfunction abortPromise(promise) {\n  const promiseState = promiseStateMap.get(promise);\n  if (promiseState == null ? void 0 : promiseState[0]) {\n    promiseState[0] = false;\n    promiseState[1].forEach((fn) => fn());\n  }\n}\nfunction registerAbortHandler(promise, abortHandler) {\n  let promiseState = promiseStateMap.get(promise);\n  if (!promiseState) {\n    promiseState = [true, /* @__PURE__ */ new Set()];\n    promiseStateMap.set(promise, promiseState);\n    const settle = () => {\n      promiseState[0] = false;\n    };\n    promise.then(settle, settle);\n  }\n  promiseState[1].add(abortHandler);\n}\nfunction isPromiseLike(p) {\n  return typeof (p == null ? void 0 : p.then) === \"function\";\n}\nfunction addPendingPromiseToDependency(atom, promise, dependencyAtomState) {\n  if (!dependencyAtomState.p.has(atom)) {\n    dependencyAtomState.p.add(atom);\n    const cleanup = () => dependencyAtomState.p.delete(atom);\n    promise.then(cleanup, cleanup);\n  }\n}\nfunction getMountedOrPendingDependents(atom, atomState, mountedMap) {\n  var _a;\n  const dependents = /* @__PURE__ */ new Set();\n  for (const a of ((_a = mountedMap.get(atom)) == null ? void 0 : _a.t) || []) {\n    if (mountedMap.has(a)) {\n      dependents.add(a);\n    }\n  }\n  for (const atomWithPendingPromise of atomState.p) {\n    dependents.add(atomWithPendingPromise);\n  }\n  return dependents;\n}\nconst createStoreHook = () => {\n  const callbacks = /* @__PURE__ */ new Set();\n  const notify = () => callbacks.forEach((fn) => fn());\n  notify.add = (fn) => {\n    callbacks.add(fn);\n    return () => callbacks.delete(fn);\n  };\n  return notify;\n};\nconst createStoreHookForAtoms = () => {\n  const all = {};\n  const callbacks = /* @__PURE__ */ new WeakMap();\n  const notify = (atom) => {\n    var _a, _b;\n    (_a = callbacks.get(all)) == null ? void 0 : _a.forEach((fn) => fn(atom));\n    (_b = callbacks.get(atom)) == null ? void 0 : _b.forEach((fn) => fn());\n  };\n  notify.add = (atom, fn) => {\n    const key = atom || all;\n    const fns = (callbacks.has(key) ? callbacks : callbacks.set(key, /* @__PURE__ */ new Set())).get(key);\n    fns.add(fn);\n    return () => {\n      fns == null ? void 0 : fns.delete(fn);\n      if (!fns.size) {\n        callbacks.delete(key);\n      }\n    };\n  };\n  return notify;\n};\nfunction initializeStoreHooks(storeHooks) {\n  storeHooks.i || (storeHooks.i = createStoreHookForAtoms());\n  storeHooks.r || (storeHooks.r = createStoreHookForAtoms());\n  storeHooks.c || (storeHooks.c = createStoreHookForAtoms());\n  storeHooks.m || (storeHooks.m = createStoreHookForAtoms());\n  storeHooks.u || (storeHooks.u = createStoreHookForAtoms());\n  storeHooks.f || (storeHooks.f = createStoreHook());\n  return storeHooks;\n}\nconst atomRead = (_store, atom, ...params) => atom.read(...params);\nconst atomWrite = (_store, atom, ...params) => atom.write(...params);\nconst atomOnInit = (store, atom) => {\n  var _a;\n  return (_a = atom.unstable_onInit) == null ? void 0 : _a.call(atom, store);\n};\nconst atomOnMount = (_store, atom, setAtom) => {\n  var _a;\n  return (_a = atom.onMount) == null ? void 0 : _a.call(atom, setAtom);\n};\nconst ensureAtomState = (store, atom) => {\n  var _a;\n  const buildingBlocks = getInternalBuildingBlocks(store);\n  const atomStateMap = buildingBlocks[0];\n  const storeHooks = buildingBlocks[6];\n  const atomOnInit2 = buildingBlocks[9];\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && !atom) {\n    throw new Error(\"Atom is undefined or null\");\n  }\n  let atomState = atomStateMap.get(atom);\n  if (!atomState) {\n    atomState = { d: /* @__PURE__ */ new Map(), p: /* @__PURE__ */ new Set(), n: 0 };\n    atomStateMap.set(atom, atomState);\n    (_a = storeHooks.i) == null ? void 0 : _a.call(storeHooks, atom);\n    atomOnInit2 == null ? void 0 : atomOnInit2(store, atom);\n  }\n  return atomState;\n};\nconst flushCallbacks = (store) => {\n  const buildingBlocks = getInternalBuildingBlocks(store);\n  const mountedMap = buildingBlocks[1];\n  const changedAtoms = buildingBlocks[3];\n  const mountCallbacks = buildingBlocks[4];\n  const unmountCallbacks = buildingBlocks[5];\n  const storeHooks = buildingBlocks[6];\n  const recomputeInvalidatedAtoms2 = buildingBlocks[13];\n  const errors = [];\n  const call = (fn) => {\n    try {\n      fn();\n    } catch (e) {\n      errors.push(e);\n    }\n  };\n  do {\n    if (storeHooks.f) {\n      call(storeHooks.f);\n    }\n    const callbacks = /* @__PURE__ */ new Set();\n    const add = callbacks.add.bind(callbacks);\n    changedAtoms.forEach((atom) => {\n      var _a;\n      return (_a = mountedMap.get(atom)) == null ? void 0 : _a.l.forEach(add);\n    });\n    changedAtoms.clear();\n    unmountCallbacks.forEach(add);\n    unmountCallbacks.clear();\n    mountCallbacks.forEach(add);\n    mountCallbacks.clear();\n    callbacks.forEach(call);\n    if (changedAtoms.size) {\n      recomputeInvalidatedAtoms2(store);\n    }\n  } while (changedAtoms.size || unmountCallbacks.size || mountCallbacks.size);\n  if (errors.length) {\n    throw new AggregateError(errors);\n  }\n};\nconst recomputeInvalidatedAtoms = (store) => {\n  const buildingBlocks = getInternalBuildingBlocks(store);\n  const mountedMap = buildingBlocks[1];\n  const invalidatedAtoms = buildingBlocks[2];\n  const changedAtoms = buildingBlocks[3];\n  const ensureAtomState2 = buildingBlocks[11];\n  const readAtomState2 = buildingBlocks[14];\n  const mountDependencies2 = buildingBlocks[17];\n  const topSortedReversed = [];\n  const visiting = /* @__PURE__ */ new WeakSet();\n  const visited = /* @__PURE__ */ new WeakSet();\n  const stack = Array.from(changedAtoms);\n  while (stack.length) {\n    const a = stack[stack.length - 1];\n    const aState = ensureAtomState2(store, a);\n    if (visited.has(a)) {\n      stack.pop();\n      continue;\n    }\n    if (visiting.has(a)) {\n      if (invalidatedAtoms.get(a) === aState.n) {\n        topSortedReversed.push([a, aState]);\n      } else if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && invalidatedAtoms.has(a)) {\n        throw new Error(\"[Bug] invalidated atom exists\");\n      }\n      visited.add(a);\n      stack.pop();\n      continue;\n    }\n    visiting.add(a);\n    for (const d of getMountedOrPendingDependents(a, aState, mountedMap)) {\n      if (!visiting.has(d)) {\n        stack.push(d);\n      }\n    }\n  }\n  for (let i = topSortedReversed.length - 1; i >= 0; --i) {\n    const [a, aState] = topSortedReversed[i];\n    let hasChangedDeps = false;\n    for (const dep of aState.d.keys()) {\n      if (dep !== a && changedAtoms.has(dep)) {\n        hasChangedDeps = true;\n        break;\n      }\n    }\n    if (hasChangedDeps) {\n      readAtomState2(store, a);\n      mountDependencies2(store, a);\n    }\n    invalidatedAtoms.delete(a);\n  }\n};\nconst storeMutationSet = /* @__PURE__ */ new WeakSet();\nconst readAtomState = (store, atom) => {\n  var _a, _b;\n  const buildingBlocks = getInternalBuildingBlocks(store);\n  const mountedMap = buildingBlocks[1];\n  const invalidatedAtoms = buildingBlocks[2];\n  const changedAtoms = buildingBlocks[3];\n  const storeHooks = buildingBlocks[6];\n  const atomRead2 = buildingBlocks[7];\n  const ensureAtomState2 = buildingBlocks[11];\n  const flushCallbacks2 = buildingBlocks[12];\n  const recomputeInvalidatedAtoms2 = buildingBlocks[13];\n  const readAtomState2 = buildingBlocks[14];\n  const writeAtomState2 = buildingBlocks[16];\n  const mountDependencies2 = buildingBlocks[17];\n  const atomState = ensureAtomState2(store, atom);\n  if (isAtomStateInitialized(atomState)) {\n    if (mountedMap.has(atom) && invalidatedAtoms.get(atom) !== atomState.n) {\n      return atomState;\n    }\n    if (Array.from(atomState.d).every(\n      ([a, n]) => (\n        // Recursively, read the atom state of the dependency, and\n        // check if the atom epoch number is unchanged\n        readAtomState2(store, a).n === n\n      )\n    )) {\n      return atomState;\n    }\n  }\n  atomState.d.clear();\n  let isSync = true;\n  function mountDependenciesIfAsync() {\n    if (mountedMap.has(atom)) {\n      mountDependencies2(store, atom);\n      recomputeInvalidatedAtoms2(store);\n      flushCallbacks2(store);\n    }\n  }\n  function getter(a) {\n    var _a2;\n    if (a === atom) {\n      const aState2 = ensureAtomState2(store, a);\n      if (!isAtomStateInitialized(aState2)) {\n        if (hasInitialValue(a)) {\n          setAtomStateValueOrPromise(store, a, a.init);\n        } else {\n          throw new Error(\"no atom init\");\n        }\n      }\n      return returnAtomValue(aState2);\n    }\n    const aState = readAtomState2(store, a);\n    try {\n      return returnAtomValue(aState);\n    } finally {\n      atomState.d.set(a, aState.n);\n      if (isPendingPromise(atomState.v)) {\n        addPendingPromiseToDependency(atom, atomState.v, aState);\n      }\n      (_a2 = mountedMap.get(a)) == null ? void 0 : _a2.t.add(atom);\n      if (!isSync) {\n        mountDependenciesIfAsync();\n      }\n    }\n  }\n  let controller;\n  let setSelf;\n  const options = {\n    get signal() {\n      if (!controller) {\n        controller = new AbortController();\n      }\n      return controller.signal;\n    },\n    get setSelf() {\n      if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && !isActuallyWritableAtom(atom)) {\n        console.warn(\"setSelf function cannot be used with read-only atom\");\n      }\n      if (!setSelf && isActuallyWritableAtom(atom)) {\n        setSelf = (...args) => {\n          if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && isSync) {\n            console.warn(\"setSelf function cannot be called in sync\");\n          }\n          if (!isSync) {\n            try {\n              return writeAtomState2(store, atom, ...args);\n            } finally {\n              recomputeInvalidatedAtoms2(store);\n              flushCallbacks2(store);\n            }\n          }\n        };\n      }\n      return setSelf;\n    }\n  };\n  const prevEpochNumber = atomState.n;\n  try {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      storeMutationSet.delete(store);\n    }\n    const valueOrPromise = atomRead2(store, atom, getter, options);\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && storeMutationSet.has(store)) {\n      console.warn(\n        \"Detected store mutation during atom read. This is not supported.\"\n      );\n    }\n    setAtomStateValueOrPromise(store, atom, valueOrPromise);\n    if (isPromiseLike(valueOrPromise)) {\n      registerAbortHandler(valueOrPromise, () => controller == null ? void 0 : controller.abort());\n      valueOrPromise.then(mountDependenciesIfAsync, mountDependenciesIfAsync);\n    }\n    (_a = storeHooks.r) == null ? void 0 : _a.call(storeHooks, atom);\n    return atomState;\n  } catch (error) {\n    delete atomState.v;\n    atomState.e = error;\n    ++atomState.n;\n    return atomState;\n  } finally {\n    isSync = false;\n    if (prevEpochNumber !== atomState.n && invalidatedAtoms.get(atom) === prevEpochNumber) {\n      invalidatedAtoms.set(atom, atomState.n);\n      changedAtoms.add(atom);\n      (_b = storeHooks.c) == null ? void 0 : _b.call(storeHooks, atom);\n    }\n  }\n};\nconst invalidateDependents = (store, atom) => {\n  const buildingBlocks = getInternalBuildingBlocks(store);\n  const mountedMap = buildingBlocks[1];\n  const invalidatedAtoms = buildingBlocks[2];\n  const ensureAtomState2 = buildingBlocks[11];\n  const stack = [atom];\n  while (stack.length) {\n    const a = stack.pop();\n    const aState = ensureAtomState2(store, a);\n    for (const d of getMountedOrPendingDependents(a, aState, mountedMap)) {\n      const dState = ensureAtomState2(store, d);\n      invalidatedAtoms.set(d, dState.n);\n      stack.push(d);\n    }\n  }\n};\nconst writeAtomState = (store, atom, ...args) => {\n  const buildingBlocks = getInternalBuildingBlocks(store);\n  const changedAtoms = buildingBlocks[3];\n  const storeHooks = buildingBlocks[6];\n  const atomWrite2 = buildingBlocks[8];\n  const ensureAtomState2 = buildingBlocks[11];\n  const flushCallbacks2 = buildingBlocks[12];\n  const recomputeInvalidatedAtoms2 = buildingBlocks[13];\n  const readAtomState2 = buildingBlocks[14];\n  const invalidateDependents2 = buildingBlocks[15];\n  const mountDependencies2 = buildingBlocks[17];\n  let isSync = true;\n  const getter = (a) => returnAtomValue(readAtomState2(store, a));\n  const setter = (a, ...args2) => {\n    var _a;\n    const aState = ensureAtomState2(store, a);\n    try {\n      if (a === atom) {\n        if (!hasInitialValue(a)) {\n          throw new Error(\"atom not writable\");\n        }\n        if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n          storeMutationSet.add(store);\n        }\n        const prevEpochNumber = aState.n;\n        const v = args2[0];\n        setAtomStateValueOrPromise(store, a, v);\n        mountDependencies2(store, a);\n        if (prevEpochNumber !== aState.n) {\n          changedAtoms.add(a);\n          (_a = storeHooks.c) == null ? void 0 : _a.call(storeHooks, a);\n          invalidateDependents2(store, a);\n        }\n        return void 0;\n      } else {\n        return writeAtomState(store, a, ...args2);\n      }\n    } finally {\n      if (!isSync) {\n        recomputeInvalidatedAtoms2(store);\n        flushCallbacks2(store);\n      }\n    }\n  };\n  try {\n    return atomWrite2(store, atom, getter, setter, ...args);\n  } finally {\n    isSync = false;\n  }\n};\nconst mountDependencies = (store, atom) => {\n  var _a;\n  const buildingBlocks = getInternalBuildingBlocks(store);\n  const mountedMap = buildingBlocks[1];\n  const changedAtoms = buildingBlocks[3];\n  const storeHooks = buildingBlocks[6];\n  const ensureAtomState2 = buildingBlocks[11];\n  const invalidateDependents2 = buildingBlocks[15];\n  const mountAtom2 = buildingBlocks[18];\n  const unmountAtom2 = buildingBlocks[19];\n  const atomState = ensureAtomState2(store, atom);\n  const mounted = mountedMap.get(atom);\n  if (mounted && !isPendingPromise(atomState.v)) {\n    for (const [a, n] of atomState.d) {\n      if (!mounted.d.has(a)) {\n        const aState = ensureAtomState2(store, a);\n        const aMounted = mountAtom2(store, a);\n        aMounted.t.add(atom);\n        mounted.d.add(a);\n        if (n !== aState.n) {\n          changedAtoms.add(a);\n          (_a = storeHooks.c) == null ? void 0 : _a.call(storeHooks, a);\n          invalidateDependents2(store, a);\n        }\n      }\n    }\n    for (const a of mounted.d || []) {\n      if (!atomState.d.has(a)) {\n        mounted.d.delete(a);\n        const aMounted = unmountAtom2(store, a);\n        aMounted == null ? void 0 : aMounted.t.delete(atom);\n      }\n    }\n  }\n};\nconst mountAtom = (store, atom) => {\n  var _a;\n  const buildingBlocks = getInternalBuildingBlocks(store);\n  const mountedMap = buildingBlocks[1];\n  const mountCallbacks = buildingBlocks[4];\n  const storeHooks = buildingBlocks[6];\n  const atomOnMount2 = buildingBlocks[10];\n  const ensureAtomState2 = buildingBlocks[11];\n  const flushCallbacks2 = buildingBlocks[12];\n  const recomputeInvalidatedAtoms2 = buildingBlocks[13];\n  const readAtomState2 = buildingBlocks[14];\n  const writeAtomState2 = buildingBlocks[16];\n  const atomState = ensureAtomState2(store, atom);\n  let mounted = mountedMap.get(atom);\n  if (!mounted) {\n    readAtomState2(store, atom);\n    for (const a of atomState.d.keys()) {\n      const aMounted = mountAtom(store, a);\n      aMounted.t.add(atom);\n    }\n    mounted = {\n      l: /* @__PURE__ */ new Set(),\n      d: new Set(atomState.d.keys()),\n      t: /* @__PURE__ */ new Set()\n    };\n    mountedMap.set(atom, mounted);\n    (_a = storeHooks.m) == null ? void 0 : _a.call(storeHooks, atom);\n    if (isActuallyWritableAtom(atom)) {\n      const processOnMount = () => {\n        let isSync = true;\n        const setAtom = (...args) => {\n          try {\n            return writeAtomState2(store, atom, ...args);\n          } finally {\n            if (!isSync) {\n              recomputeInvalidatedAtoms2(store);\n              flushCallbacks2(store);\n            }\n          }\n        };\n        try {\n          const onUnmount = atomOnMount2(store, atom, setAtom);\n          if (onUnmount) {\n            mounted.u = () => {\n              isSync = true;\n              try {\n                onUnmount();\n              } finally {\n                isSync = false;\n              }\n            };\n          }\n        } finally {\n          isSync = false;\n        }\n      };\n      mountCallbacks.add(processOnMount);\n    }\n  }\n  return mounted;\n};\nconst unmountAtom = (store, atom) => {\n  var _a;\n  const buildingBlocks = getInternalBuildingBlocks(store);\n  const mountedMap = buildingBlocks[1];\n  const unmountCallbacks = buildingBlocks[5];\n  const storeHooks = buildingBlocks[6];\n  const ensureAtomState2 = buildingBlocks[11];\n  const unmountAtom2 = buildingBlocks[19];\n  const atomState = ensureAtomState2(store, atom);\n  let mounted = mountedMap.get(atom);\n  if (mounted && !mounted.l.size && !Array.from(mounted.t).some((a) => {\n    var _a2;\n    return (_a2 = mountedMap.get(a)) == null ? void 0 : _a2.d.has(atom);\n  })) {\n    if (mounted.u) {\n      unmountCallbacks.add(mounted.u);\n    }\n    mounted = void 0;\n    mountedMap.delete(atom);\n    (_a = storeHooks.u) == null ? void 0 : _a.call(storeHooks, atom);\n    for (const a of atomState.d.keys()) {\n      const aMounted = unmountAtom2(store, a);\n      aMounted == null ? void 0 : aMounted.t.delete(atom);\n    }\n    return void 0;\n  }\n  return mounted;\n};\nconst setAtomStateValueOrPromise = (store, atom, valueOrPromise) => {\n  const ensureAtomState2 = getInternalBuildingBlocks(store)[11];\n  const atomState = ensureAtomState2(store, atom);\n  const hasPrevValue = \"v\" in atomState;\n  const prevValue = atomState.v;\n  if (isPromiseLike(valueOrPromise)) {\n    for (const a of atomState.d.keys()) {\n      addPendingPromiseToDependency(\n        atom,\n        valueOrPromise,\n        ensureAtomState2(store, a)\n      );\n    }\n  }\n  atomState.v = valueOrPromise;\n  delete atomState.e;\n  if (!hasPrevValue || !Object.is(prevValue, atomState.v)) {\n    ++atomState.n;\n    if (isPromiseLike(prevValue)) {\n      abortPromise(prevValue);\n    }\n  }\n};\nconst storeGet = (store, atom) => {\n  const readAtomState2 = getInternalBuildingBlocks(store)[14];\n  return returnAtomValue(readAtomState2(store, atom));\n};\nconst storeSet = (store, atom, ...args) => {\n  const buildingBlocks = getInternalBuildingBlocks(store);\n  const flushCallbacks2 = buildingBlocks[12];\n  const recomputeInvalidatedAtoms2 = buildingBlocks[13];\n  const writeAtomState2 = buildingBlocks[16];\n  try {\n    return writeAtomState2(store, atom, ...args);\n  } finally {\n    recomputeInvalidatedAtoms2(store);\n    flushCallbacks2(store);\n  }\n};\nconst storeSub = (store, atom, listener) => {\n  const buildingBlocks = getInternalBuildingBlocks(store);\n  const flushCallbacks2 = buildingBlocks[12];\n  const mountAtom2 = buildingBlocks[18];\n  const unmountAtom2 = buildingBlocks[19];\n  const mounted = mountAtom2(store, atom);\n  const listeners = mounted.l;\n  listeners.add(listener);\n  flushCallbacks2(store);\n  return () => {\n    listeners.delete(listener);\n    unmountAtom2(store, atom);\n    flushCallbacks2(store);\n  };\n};\nconst buildingBlockMap = /* @__PURE__ */ new WeakMap();\nconst getInternalBuildingBlocks = (store) => {\n  const buildingBlocks = buildingBlockMap.get(store);\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && !buildingBlocks) {\n    throw new Error(\n      \"Store must be created by buildStore to read its building blocks\"\n    );\n  }\n  return buildingBlocks;\n};\nfunction getBuildingBlocks(store) {\n  const buildingBlocks = getInternalBuildingBlocks(store);\n  const enhanceBuildingBlocks = buildingBlocks[24];\n  if (enhanceBuildingBlocks) {\n    return enhanceBuildingBlocks(buildingBlocks);\n  }\n  return buildingBlocks;\n}\nfunction buildStore(...buildArgs) {\n  const store = {\n    get(atom) {\n      const storeGet2 = getInternalBuildingBlocks(store)[21];\n      return storeGet2(store, atom);\n    },\n    set(atom, ...args) {\n      const storeSet2 = getInternalBuildingBlocks(store)[22];\n      return storeSet2(store, atom, ...args);\n    },\n    sub(atom, listener) {\n      const storeSub2 = getInternalBuildingBlocks(store)[23];\n      return storeSub2(store, atom, listener);\n    }\n  };\n  const buildingBlocks = [\n    // store state\n    /* @__PURE__ */ new WeakMap(),\n    // atomStateMap\n    /* @__PURE__ */ new WeakMap(),\n    // mountedMap\n    /* @__PURE__ */ new WeakMap(),\n    // invalidatedAtoms\n    /* @__PURE__ */ new Set(),\n    // changedAtoms\n    /* @__PURE__ */ new Set(),\n    // mountCallbacks\n    /* @__PURE__ */ new Set(),\n    // unmountCallbacks\n    {},\n    // storeHooks\n    // atom interceptors\n    atomRead,\n    atomWrite,\n    atomOnInit,\n    atomOnMount,\n    // building-block functions\n    ensureAtomState,\n    flushCallbacks,\n    recomputeInvalidatedAtoms,\n    readAtomState,\n    invalidateDependents,\n    writeAtomState,\n    mountDependencies,\n    mountAtom,\n    unmountAtom,\n    setAtomStateValueOrPromise,\n    storeGet,\n    storeSet,\n    storeSub,\n    void 0\n  ].map((fn, i) => buildArgs[i] || fn);\n  buildingBlockMap.set(store, Object.freeze(buildingBlocks));\n  return store;\n}\n\nexport { abortPromise as INTERNAL_abortPromise, addPendingPromiseToDependency as INTERNAL_addPendingPromiseToDependency, buildStore as INTERNAL_buildStoreRev2, getBuildingBlocks as INTERNAL_getBuildingBlocksRev2, getMountedOrPendingDependents as INTERNAL_getMountedOrPendingDependents, hasInitialValue as INTERNAL_hasInitialValue, initializeStoreHooks as INTERNAL_initializeStoreHooksRev2, isActuallyWritableAtom as INTERNAL_isActuallyWritableAtom, isAtomStateInitialized as INTERNAL_isAtomStateInitialized, isPendingPromise as INTERNAL_isPendingPromise, isPromiseLike as INTERNAL_isPromiseLike, promiseStateMap as INTERNAL_promiseStateMap, registerAbortHandler as INTERNAL_registerAbortHandler, returnAtomValue as INTERNAL_returnAtomValue };\n",
    "import { INTERNAL_buildStoreRev2 } from 'jotai/vanilla/internals';\n\nlet keyCount = 0;\nfunction atom(read, write) {\n  const key = `atom${++keyCount}`;\n  const config = {\n    toString() {\n      return (import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && this.debugLabel ? key + \":\" + this.debugLabel : key;\n    }\n  };\n  if (typeof read === \"function\") {\n    config.read = read;\n  } else {\n    config.init = read;\n    config.read = defaultRead;\n    config.write = defaultWrite;\n  }\n  if (write) {\n    config.write = write;\n  }\n  return config;\n}\nfunction defaultRead(get) {\n  return get(this);\n}\nfunction defaultWrite(get, set, arg) {\n  return set(\n    this,\n    typeof arg === \"function\" ? arg(get(this)) : arg\n  );\n}\n\nlet overiddenCreateStore;\nfunction INTERNAL_overrideCreateStore(fn) {\n  overiddenCreateStore = fn(overiddenCreateStore);\n}\nfunction createStore() {\n  if (overiddenCreateStore) {\n    return overiddenCreateStore();\n  }\n  return INTERNAL_buildStoreRev2();\n}\nlet defaultStore;\nfunction getDefaultStore() {\n  if (!defaultStore) {\n    defaultStore = createStore();\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      globalThis.__JOTAI_DEFAULT_STORE__ || (globalThis.__JOTAI_DEFAULT_STORE__ = defaultStore);\n      if (globalThis.__JOTAI_DEFAULT_STORE__ !== defaultStore) {\n        console.warn(\n          \"Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044\"\n        );\n      }\n    }\n  }\n  return defaultStore;\n}\n\nexport { INTERNAL_overrideCreateStore, atom, createStore, getDefaultStore };\n",
    "'use client';\nimport React, { createContext, useContext, useRef, createElement, useReducer, useEffect, useDebugValue, useCallback } from 'react';\nimport { getDefaultStore, createStore } from 'jotai/vanilla';\nimport { INTERNAL_registerAbortHandler } from 'jotai/vanilla/internals';\n\nconst StoreContext = createContext(\n  void 0\n);\nfunction useStore(options) {\n  const store = useContext(StoreContext);\n  return (options == null ? void 0 : options.store) || store || getDefaultStore();\n}\nfunction Provider({\n  children,\n  store\n}) {\n  const storeRef = useRef(null);\n  if (store) {\n    return createElement(StoreContext.Provider, { value: store }, children);\n  }\n  if (storeRef.current === null) {\n    storeRef.current = createStore();\n  }\n  return createElement(\n    StoreContext.Provider,\n    {\n      // TODO should we use useState instead?\n      // eslint-disable-next-line react-hooks/refs\n      value: storeRef.current\n    },\n    children\n  );\n}\n\nconst isPromiseLike = (x) => typeof (x == null ? void 0 : x.then) === \"function\";\nconst attachPromiseStatus = (promise) => {\n  if (!promise.status) {\n    promise.status = \"pending\";\n    promise.then(\n      (v) => {\n        promise.status = \"fulfilled\";\n        promise.value = v;\n      },\n      (e) => {\n        promise.status = \"rejected\";\n        promise.reason = e;\n      }\n    );\n  }\n};\nconst use = React.use || // A shim for older React versions\n((promise) => {\n  if (promise.status === \"pending\") {\n    throw promise;\n  } else if (promise.status === \"fulfilled\") {\n    return promise.value;\n  } else if (promise.status === \"rejected\") {\n    throw promise.reason;\n  } else {\n    attachPromiseStatus(promise);\n    throw promise;\n  }\n});\nconst continuablePromiseMap = /* @__PURE__ */ new WeakMap();\nconst createContinuablePromise = (promise, getValue) => {\n  let continuablePromise = continuablePromiseMap.get(promise);\n  if (!continuablePromise) {\n    continuablePromise = new Promise((resolve, reject) => {\n      let curr = promise;\n      const onFulfilled = (me) => (v) => {\n        if (curr === me) {\n          resolve(v);\n        }\n      };\n      const onRejected = (me) => (e) => {\n        if (curr === me) {\n          reject(e);\n        }\n      };\n      const onAbort = () => {\n        try {\n          const nextValue = getValue();\n          if (isPromiseLike(nextValue)) {\n            continuablePromiseMap.set(nextValue, continuablePromise);\n            curr = nextValue;\n            nextValue.then(onFulfilled(nextValue), onRejected(nextValue));\n            INTERNAL_registerAbortHandler(nextValue, onAbort);\n          } else {\n            resolve(nextValue);\n          }\n        } catch (e) {\n          reject(e);\n        }\n      };\n      promise.then(onFulfilled(promise), onRejected(promise));\n      INTERNAL_registerAbortHandler(promise, onAbort);\n    });\n    continuablePromiseMap.set(promise, continuablePromise);\n  }\n  return continuablePromise;\n};\nfunction useAtomValue(atom, options) {\n  const { delay, unstable_promiseStatus: promiseStatus = !React.use } = options || {};\n  const store = useStore(options);\n  const [[valueFromReducer, storeFromReducer, atomFromReducer], rerender] = useReducer(\n    (prev) => {\n      const nextValue = store.get(atom);\n      if (Object.is(prev[0], nextValue) && prev[1] === store && prev[2] === atom) {\n        return prev;\n      }\n      return [nextValue, store, atom];\n    },\n    void 0,\n    () => [store.get(atom), store, atom]\n  );\n  let value = valueFromReducer;\n  if (storeFromReducer !== store || atomFromReducer !== atom) {\n    rerender();\n    value = store.get(atom);\n  }\n  useEffect(() => {\n    const unsub = store.sub(atom, () => {\n      if (promiseStatus) {\n        try {\n          const value2 = store.get(atom);\n          if (isPromiseLike(value2)) {\n            attachPromiseStatus(\n              createContinuablePromise(value2, () => store.get(atom))\n            );\n          }\n        } catch (e) {\n        }\n      }\n      if (typeof delay === \"number\") {\n        setTimeout(rerender, delay);\n        return;\n      }\n      rerender();\n    });\n    rerender();\n    return unsub;\n  }, [store, atom, delay, promiseStatus]);\n  useDebugValue(value);\n  if (isPromiseLike(value)) {\n    const promise = createContinuablePromise(value, () => store.get(atom));\n    if (promiseStatus) {\n      attachPromiseStatus(promise);\n    }\n    return use(promise);\n  }\n  return value;\n}\n\nfunction useSetAtom(atom, options) {\n  const store = useStore(options);\n  const setAtom = useCallback(\n    (...args) => {\n      if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && !(\"write\" in atom)) {\n        throw new Error(\"not writable atom\");\n      }\n      return store.set(atom, ...args);\n    },\n    [store, atom]\n  );\n  return setAtom;\n}\n\nfunction useAtom(atom, options) {\n  return [\n    useAtomValue(atom, options),\n    // We do wrong type assertion here, which results in throwing an error.\n    useSetAtom(atom, options)\n  ];\n}\n\nexport { Provider, useAtom, useAtomValue, useSetAtom, useStore };\n",
    "import { atom } from 'jotai/vanilla';\n\nconst RESET = Symbol(\n  (import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" ? \"RESET\" : \"\"\n);\n\nfunction atomWithReset(initialValue) {\n  const anAtom = atom(\n    initialValue,\n    (get, set, update) => {\n      const nextValue = typeof update === \"function\" ? update(get(anAtom)) : update;\n      set(anAtom, nextValue === RESET ? initialValue : nextValue);\n    }\n  );\n  return anAtom;\n}\n\nfunction atomWithReducer(initialValue, reducer) {\n  return atom(initialValue, function(get, set, action) {\n    set(this, reducer(get(this), action));\n  });\n}\n\nfunction atomFamily(initializeAtom, areEqual) {\n  let shouldRemove = null;\n  const atoms = /* @__PURE__ */ new Map();\n  const listeners = /* @__PURE__ */ new Set();\n  const createAtom = (param) => {\n    let item;\n    if (areEqual === void 0) {\n      item = atoms.get(param);\n    } else {\n      for (const [key, value] of atoms) {\n        if (areEqual(key, param)) {\n          item = value;\n          break;\n        }\n      }\n    }\n    if (item !== void 0) {\n      if (shouldRemove == null ? void 0 : shouldRemove(item[1], param)) {\n        createAtom.remove(param);\n      } else {\n        return item[0];\n      }\n    }\n    const newAtom = initializeAtom(param);\n    atoms.set(param, [newAtom, Date.now()]);\n    notifyListeners(\"CREATE\", param, newAtom);\n    return newAtom;\n  };\n  const notifyListeners = (type, param, atom) => {\n    for (const listener of listeners) {\n      listener({ type, param, atom });\n    }\n  };\n  createAtom.unstable_listen = (callback) => {\n    listeners.add(callback);\n    return () => {\n      listeners.delete(callback);\n    };\n  };\n  createAtom.getParams = () => atoms.keys();\n  createAtom.remove = (param) => {\n    if (areEqual === void 0) {\n      if (!atoms.has(param)) return;\n      const [atom] = atoms.get(param);\n      atoms.delete(param);\n      notifyListeners(\"REMOVE\", param, atom);\n    } else {\n      for (const [key, [atom]] of atoms) {\n        if (areEqual(key, param)) {\n          atoms.delete(key);\n          notifyListeners(\"REMOVE\", key, atom);\n          break;\n        }\n      }\n    }\n  };\n  createAtom.setShouldRemove = (fn) => {\n    shouldRemove = fn;\n    if (!shouldRemove) return;\n    for (const [key, [atom, createdAt]] of atoms) {\n      if (shouldRemove(createdAt, key)) {\n        atoms.delete(key);\n        notifyListeners(\"REMOVE\", key, atom);\n      }\n    }\n  };\n  return createAtom;\n}\n\nconst getCached$2 = (c, m, k) => (m.has(k) ? m : m.set(k, c())).get(k);\nconst cache1$3 = /* @__PURE__ */ new WeakMap();\nconst memo3 = (create, dep1, dep2, dep3) => {\n  const cache2 = getCached$2(() => /* @__PURE__ */ new WeakMap(), cache1$3, dep1);\n  const cache3 = getCached$2(() => /* @__PURE__ */ new WeakMap(), cache2, dep2);\n  return getCached$2(create, cache3, dep3);\n};\nfunction selectAtom(anAtom, selector, equalityFn = Object.is) {\n  return memo3(\n    () => {\n      const EMPTY = Symbol();\n      const selectValue = ([value, prevSlice]) => {\n        if (prevSlice === EMPTY) {\n          return selector(value);\n        }\n        const slice = selector(value, prevSlice);\n        return equalityFn(prevSlice, slice) ? prevSlice : slice;\n      };\n      const derivedAtom = atom((get) => {\n        const prev = get(derivedAtom);\n        const value = get(anAtom);\n        return selectValue([value, prev]);\n      });\n      derivedAtom.init = EMPTY;\n      return derivedAtom;\n    },\n    anAtom,\n    selector,\n    equalityFn\n  );\n}\n\nconst frozenAtoms = /* @__PURE__ */ new WeakSet();\nconst deepFreeze = (value) => {\n  if (typeof value !== \"object\" || value === null) {\n    return value;\n  }\n  Object.freeze(value);\n  const propNames = Object.getOwnPropertyNames(value);\n  for (const name of propNames) {\n    deepFreeze(value[name]);\n  }\n  return value;\n};\nfunction freezeAtom(anAtom) {\n  if (frozenAtoms.has(anAtom)) {\n    return anAtom;\n  }\n  frozenAtoms.add(anAtom);\n  const origRead = anAtom.read;\n  anAtom.read = function(get, options) {\n    return deepFreeze(origRead.call(this, get, options));\n  };\n  if (\"write\" in anAtom) {\n    const origWrite = anAtom.write;\n    anAtom.write = function(get, set, ...args) {\n      return origWrite.call(\n        this,\n        get,\n        (...setArgs) => {\n          if (setArgs[0] === anAtom) {\n            setArgs[1] = deepFreeze(setArgs[1]);\n          }\n          return set(...setArgs);\n        },\n        ...args\n      );\n    };\n  }\n  return anAtom;\n}\nfunction freezeAtomCreator(createAtom) {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    console.warn(\n      \"[DEPRECATED] freezeAtomCreator is deprecated, define it on users end\"\n    );\n  }\n  return ((...args) => freezeAtom(createAtom(...args)));\n}\n\nconst getCached$1 = (c, m, k) => (m.has(k) ? m : m.set(k, c())).get(k);\nconst cache1$2 = /* @__PURE__ */ new WeakMap();\nconst memo2$1 = (create, dep1, dep2) => {\n  const cache2 = getCached$1(() => /* @__PURE__ */ new WeakMap(), cache1$2, dep1);\n  return getCached$1(create, cache2, dep2);\n};\nconst cacheKeyForEmptyKeyExtractor = {};\nconst isWritable = (atom2) => !!atom2.write;\nconst isFunction = (x) => typeof x === \"function\";\nfunction splitAtom(arrAtom, keyExtractor) {\n  return memo2$1(\n    () => {\n      const mappingCache = /* @__PURE__ */ new WeakMap();\n      const getMapping = (arr, prev) => {\n        let mapping = mappingCache.get(arr);\n        if (mapping) {\n          return mapping;\n        }\n        const prevMapping = prev && mappingCache.get(prev);\n        const atomList = [];\n        const keyList = [];\n        arr.forEach((item, index) => {\n          const key = keyExtractor ? keyExtractor(item) : index;\n          keyList[index] = key;\n          const cachedAtom = prevMapping && prevMapping.atomList[prevMapping.keyList.indexOf(key)];\n          if (cachedAtom) {\n            atomList[index] = cachedAtom;\n            return;\n          }\n          const read = (get) => {\n            const prev2 = get(mappingAtom);\n            const currArr = get(arrAtom);\n            const mapping2 = getMapping(currArr, prev2 == null ? void 0 : prev2.arr);\n            const index2 = mapping2.keyList.indexOf(key);\n            if (index2 < 0 || index2 >= currArr.length) {\n              const prevItem = arr[getMapping(arr).keyList.indexOf(key)];\n              if (prevItem) {\n                return prevItem;\n              }\n              throw new Error(\"splitAtom: index out of bounds for read\");\n            }\n            return currArr[index2];\n          };\n          const write = (get, set, update) => {\n            const prev2 = get(mappingAtom);\n            const arr2 = get(arrAtom);\n            const mapping2 = getMapping(arr2, prev2 == null ? void 0 : prev2.arr);\n            const index2 = mapping2.keyList.indexOf(key);\n            if (index2 < 0 || index2 >= arr2.length) {\n              throw new Error(\"splitAtom: index out of bounds for write\");\n            }\n            const nextItem = isFunction(update) ? update(arr2[index2]) : update;\n            if (!Object.is(arr2[index2], nextItem)) {\n              set(arrAtom, [\n                ...arr2.slice(0, index2),\n                nextItem,\n                ...arr2.slice(index2 + 1)\n              ]);\n            }\n          };\n          atomList[index] = isWritable(arrAtom) ? atom(read, write) : atom(read);\n        });\n        if (prevMapping && prevMapping.keyList.length === keyList.length && prevMapping.keyList.every((x, i) => x === keyList[i])) {\n          mapping = prevMapping;\n        } else {\n          mapping = { arr, atomList, keyList };\n        }\n        mappingCache.set(arr, mapping);\n        return mapping;\n      };\n      const mappingAtom = atom((get) => {\n        const prev = get(mappingAtom);\n        const arr = get(arrAtom);\n        const mapping = getMapping(arr, prev == null ? void 0 : prev.arr);\n        return mapping;\n      });\n      if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n        mappingAtom.debugPrivate = true;\n      }\n      mappingAtom.init = void 0;\n      const splittedAtom = isWritable(arrAtom) ? atom(\n        (get) => get(mappingAtom).atomList,\n        (get, set, action) => {\n          switch (action.type) {\n            case \"remove\": {\n              const index = get(splittedAtom).indexOf(action.atom);\n              if (index >= 0) {\n                const arr = get(arrAtom);\n                set(arrAtom, [\n                  ...arr.slice(0, index),\n                  ...arr.slice(index + 1)\n                ]);\n              }\n              break;\n            }\n            case \"insert\": {\n              const index = action.before ? get(splittedAtom).indexOf(action.before) : get(splittedAtom).length;\n              if (index >= 0) {\n                const arr = get(arrAtom);\n                set(arrAtom, [\n                  ...arr.slice(0, index),\n                  action.value,\n                  ...arr.slice(index)\n                ]);\n              }\n              break;\n            }\n            case \"move\": {\n              const index1 = get(splittedAtom).indexOf(action.atom);\n              const index2 = action.before ? get(splittedAtom).indexOf(action.before) : get(splittedAtom).length;\n              if (index1 >= 0 && index2 >= 0) {\n                const arr = get(arrAtom);\n                if (index1 < index2) {\n                  set(arrAtom, [\n                    ...arr.slice(0, index1),\n                    ...arr.slice(index1 + 1, index2),\n                    arr[index1],\n                    ...arr.slice(index2)\n                  ]);\n                } else {\n                  set(arrAtom, [\n                    ...arr.slice(0, index2),\n                    arr[index1],\n                    ...arr.slice(index2, index1),\n                    ...arr.slice(index1 + 1)\n                  ]);\n                }\n              }\n              break;\n            }\n          }\n        }\n      ) : atom((get) => get(mappingAtom).atomList);\n      return splittedAtom;\n    },\n    arrAtom,\n    keyExtractor || cacheKeyForEmptyKeyExtractor\n  );\n}\n\nfunction atomWithDefault(getDefault) {\n  const EMPTY = Symbol();\n  const overwrittenAtom = atom(EMPTY);\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    overwrittenAtom.debugPrivate = true;\n  }\n  const anAtom = atom(\n    (get, options) => {\n      const overwritten = get(overwrittenAtom);\n      if (overwritten !== EMPTY) {\n        return overwritten;\n      }\n      return getDefault(get, options);\n    },\n    (get, set, update) => {\n      const newValue = typeof update === \"function\" ? update(get(anAtom)) : update;\n      set(overwrittenAtom, newValue === RESET ? EMPTY : newValue);\n    }\n  );\n  return anAtom;\n}\n\nconst isPromiseLike$3 = (x) => typeof (x == null ? void 0 : x.then) === \"function\";\nfunction withStorageValidator(validator) {\n  return (unknownStorage) => {\n    const storage = {\n      ...unknownStorage,\n      getItem: (key, initialValue) => {\n        const validate = (value2) => {\n          if (!validator(value2)) {\n            return initialValue;\n          }\n          return value2;\n        };\n        const value = unknownStorage.getItem(key, initialValue);\n        if (isPromiseLike$3(value)) {\n          return value.then(validate);\n        }\n        return validate(value);\n      }\n    };\n    return storage;\n  };\n}\nfunction createJSONStorage(getStringStorage = () => {\n  try {\n    return window.localStorage;\n  } catch (e) {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      if (typeof window !== \"undefined\") {\n        console.warn(e);\n      }\n    }\n    return void 0;\n  }\n}, options) {\n  var _a;\n  let lastStr;\n  let lastValue;\n  const storage = {\n    getItem: (key, initialValue) => {\n      var _a2, _b;\n      const parse = (str2) => {\n        str2 = str2 || \"\";\n        if (lastStr !== str2) {\n          try {\n            lastValue = JSON.parse(str2, options == null ? void 0 : options.reviver);\n          } catch (e) {\n            return initialValue;\n          }\n          lastStr = str2;\n        }\n        return lastValue;\n      };\n      const str = (_b = (_a2 = getStringStorage()) == null ? void 0 : _a2.getItem(key)) != null ? _b : null;\n      if (isPromiseLike$3(str)) {\n        return str.then(parse);\n      }\n      return parse(str);\n    },\n    setItem: (key, newValue) => {\n      var _a2;\n      return (_a2 = getStringStorage()) == null ? void 0 : _a2.setItem(\n        key,\n        JSON.stringify(newValue, options == null ? void 0 : options.replacer)\n      );\n    },\n    removeItem: (key) => {\n      var _a2;\n      return (_a2 = getStringStorage()) == null ? void 0 : _a2.removeItem(key);\n    }\n  };\n  const createHandleSubscribe = (subscriber2) => (key, callback, initialValue) => subscriber2(key, (v) => {\n    let newValue;\n    try {\n      newValue = JSON.parse(v || \"\");\n    } catch (e) {\n      newValue = initialValue;\n    }\n    callback(newValue);\n  });\n  let subscriber;\n  try {\n    subscriber = (_a = getStringStorage()) == null ? void 0 : _a.subscribe;\n  } catch (e) {\n  }\n  if (!subscriber && typeof window !== \"undefined\" && typeof window.addEventListener === \"function\" && window.Storage) {\n    subscriber = (key, callback) => {\n      if (!(getStringStorage() instanceof window.Storage)) {\n        return () => {\n        };\n      }\n      const storageEventCallback = (e) => {\n        if (e.storageArea === getStringStorage() && e.key === key) {\n          callback(e.newValue);\n        }\n      };\n      window.addEventListener(\"storage\", storageEventCallback);\n      return () => {\n        window.removeEventListener(\"storage\", storageEventCallback);\n      };\n    };\n  }\n  if (subscriber) {\n    storage.subscribe = createHandleSubscribe(subscriber);\n  }\n  return storage;\n}\nconst defaultStorage = createJSONStorage();\nfunction atomWithStorage(key, initialValue, storage = defaultStorage, options) {\n  const getOnInit = options == null ? void 0 : options.getOnInit;\n  const baseAtom = atom(\n    getOnInit ? storage.getItem(key, initialValue) : initialValue\n  );\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    baseAtom.debugPrivate = true;\n  }\n  baseAtom.onMount = (setAtom) => {\n    setAtom(storage.getItem(key, initialValue));\n    let unsub;\n    if (storage.subscribe) {\n      unsub = storage.subscribe(key, setAtom, initialValue);\n    }\n    return unsub;\n  };\n  const anAtom = atom(\n    (get) => get(baseAtom),\n    (get, set, update) => {\n      const nextValue = typeof update === \"function\" ? update(get(baseAtom)) : update;\n      if (nextValue === RESET) {\n        set(baseAtom, initialValue);\n        return storage.removeItem(key);\n      }\n      if (isPromiseLike$3(nextValue)) {\n        return nextValue.then((resolvedValue) => {\n          set(baseAtom, resolvedValue);\n          return storage.setItem(key, resolvedValue);\n        });\n      }\n      set(baseAtom, nextValue);\n      return storage.setItem(key, nextValue);\n    }\n  );\n  return anAtom;\n}\n\nconst isPromiseLike$2 = (x) => typeof (x == null ? void 0 : x.then) === \"function\";\nfunction atomWithObservable(getObservable, options) {\n  const returnResultData = (result) => {\n    if (\"e\" in result) {\n      throw result.e;\n    }\n    return result.d;\n  };\n  const observableResultAtom = atom((get) => {\n    var _a;\n    let observable = getObservable(get);\n    const itself = (_a = observable[Symbol.observable]) == null ? void 0 : _a.call(observable);\n    if (itself) {\n      observable = itself;\n    }\n    let resolve;\n    const makePending = () => new Promise((r) => {\n      resolve = r;\n    });\n    const initialResult = options && \"initialValue\" in options ? {\n      d: typeof options.initialValue === \"function\" ? options.initialValue() : options.initialValue\n    } : makePending();\n    let setResult;\n    let lastResult;\n    const listener = (result) => {\n      lastResult = result;\n      resolve == null ? void 0 : resolve(result);\n      setResult == null ? void 0 : setResult(result);\n    };\n    let subscription;\n    let timer;\n    const isNotMounted = () => !setResult;\n    const unsubscribe = () => {\n      if (subscription) {\n        subscription.unsubscribe();\n        subscription = void 0;\n      }\n    };\n    const start = () => {\n      if (subscription) {\n        clearTimeout(timer);\n        subscription.unsubscribe();\n      }\n      subscription = observable.subscribe({\n        next: (d) => listener({ d }),\n        error: (e) => listener({ e }),\n        complete: () => {\n        }\n      });\n      if (isNotMounted() && (options == null ? void 0 : options.unstable_timeout)) {\n        timer = setTimeout(unsubscribe, options.unstable_timeout);\n      }\n    };\n    start();\n    const resultAtom = atom(lastResult || initialResult);\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      resultAtom.debugPrivate = true;\n    }\n    resultAtom.onMount = (update) => {\n      setResult = update;\n      if (lastResult) {\n        update(lastResult);\n      }\n      if (subscription) {\n        clearTimeout(timer);\n      } else {\n        start();\n      }\n      return () => {\n        setResult = void 0;\n        if (options == null ? void 0 : options.unstable_timeout) {\n          timer = setTimeout(unsubscribe, options.unstable_timeout);\n        } else {\n          unsubscribe();\n        }\n      };\n    };\n    return [resultAtom, observable, makePending, start, isNotMounted];\n  });\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    observableResultAtom.debugPrivate = true;\n  }\n  const observableAtom = atom(\n    (get) => {\n      const [resultAtom] = get(observableResultAtom);\n      const result = get(resultAtom);\n      if (isPromiseLike$2(result)) {\n        return result.then(returnResultData);\n      }\n      return returnResultData(result);\n    },\n    (get, set, data) => {\n      const [resultAtom, observable, makePending, start, isNotMounted] = get(observableResultAtom);\n      if (\"next\" in observable) {\n        if (isNotMounted()) {\n          set(resultAtom, makePending());\n          start();\n        }\n        observable.next(data);\n      } else {\n        throw new Error(\"observable is not subject\");\n      }\n    }\n  );\n  return observableAtom;\n}\n\nconst cache1$1 = /* @__PURE__ */ new WeakMap();\nconst memo1 = (create, dep1) => (cache1$1.has(dep1) ? cache1$1 : cache1$1.set(dep1, create())).get(dep1);\nconst isPromiseLike$1 = (p) => typeof (p == null ? void 0 : p.then) === \"function\";\nconst LOADING = { state: \"loading\" };\nfunction loadable(anAtom) {\n  return memo1(() => {\n    const loadableCache = /* @__PURE__ */ new WeakMap();\n    const refreshAtom = atom([() => {\n    }, 0]);\n    refreshAtom.unstable_onInit = (store) => {\n      store.set(refreshAtom, ([, c]) => [\n        () => store.set(refreshAtom, ([f, c2]) => [f, c2 + 1]),\n        c\n      ]);\n    };\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      refreshAtom.debugPrivate = true;\n    }\n    const derivedAtom = atom((get) => {\n      const [triggerRefresh] = get(refreshAtom);\n      let value;\n      try {\n        value = get(anAtom);\n      } catch (error) {\n        return { state: \"hasError\", error };\n      }\n      if (!isPromiseLike$1(value)) {\n        return { state: \"hasData\", data: value };\n      }\n      const promise = value;\n      const cached1 = loadableCache.get(promise);\n      if (cached1) {\n        return cached1;\n      }\n      promise.then(\n        (data) => {\n          loadableCache.set(promise, { state: \"hasData\", data });\n          triggerRefresh();\n        },\n        (error) => {\n          loadableCache.set(promise, { state: \"hasError\", error });\n          triggerRefresh();\n        }\n      );\n      const cached2 = loadableCache.get(promise);\n      if (cached2) {\n        return cached2;\n      }\n      loadableCache.set(promise, LOADING);\n      return LOADING;\n    });\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      derivedAtom.debugPrivate = true;\n    }\n    return atom((get) => get(derivedAtom));\n  }, anAtom);\n}\n\nconst getCached = (c, m, k) => (m.has(k) ? m : m.set(k, c())).get(k);\nconst cache1 = /* @__PURE__ */ new WeakMap();\nconst memo2 = (create, dep1, dep2) => {\n  const cache2 = getCached(() => /* @__PURE__ */ new WeakMap(), cache1, dep1);\n  return getCached(create, cache2, dep2);\n};\nconst isPromiseLike = (p) => typeof (p == null ? void 0 : p.then) === \"function\";\nconst defaultFallback = () => void 0;\nfunction unwrap(anAtom, fallback = defaultFallback) {\n  return memo2(\n    () => {\n      const promiseErrorCache = /* @__PURE__ */ new WeakMap();\n      const promiseResultCache = /* @__PURE__ */ new WeakMap();\n      const refreshAtom = atom([() => {\n      }, 0]);\n      refreshAtom.unstable_onInit = (store) => {\n        store.set(refreshAtom, ([, c]) => [\n          () => store.set(refreshAtom, ([f, c2]) => [f, c2 + 1]),\n          c\n        ]);\n      };\n      if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n        refreshAtom.debugPrivate = true;\n      }\n      const promiseAndValueAtom = atom((get) => {\n        const [triggerRefresh] = get(refreshAtom);\n        let prev;\n        try {\n          prev = get(promiseAndValueAtom);\n        } catch (e) {\n        }\n        const promise = get(anAtom);\n        if (!isPromiseLike(promise)) {\n          return { v: promise };\n        }\n        if (promise !== (prev == null ? void 0 : prev.p)) {\n          promise.then(\n            (v) => {\n              promiseResultCache.set(promise, v);\n              triggerRefresh();\n            },\n            (e) => {\n              promiseErrorCache.set(promise, e);\n              triggerRefresh();\n            }\n          );\n        }\n        if (promiseErrorCache.has(promise)) {\n          throw promiseErrorCache.get(promise);\n        }\n        if (promiseResultCache.has(promise)) {\n          return {\n            p: promise,\n            v: promiseResultCache.get(promise)\n          };\n        }\n        if (prev && \"v\" in prev) {\n          return { p: promise, f: fallback(prev.v), v: prev.v };\n        }\n        return { p: promise, f: fallback() };\n      });\n      promiseAndValueAtom.init = void 0;\n      if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n        promiseAndValueAtom.debugPrivate = true;\n      }\n      return atom(\n        (get) => {\n          const state = get(promiseAndValueAtom);\n          if (\"f\" in state) {\n            return state.f;\n          }\n          return state.v;\n        },\n        (_get, set, ...args) => set(anAtom, ...args)\n      );\n    },\n    anAtom,\n    fallback\n  );\n}\n\nfunction atomWithRefresh(read, write) {\n  const refreshAtom = atom(0);\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    refreshAtom.debugPrivate = true;\n  }\n  return atom(\n    (get, options) => {\n      get(refreshAtom);\n      return read(get, options);\n    },\n    (get, set, ...args) => {\n      if (args.length === 0) {\n        set(refreshAtom, (c) => c + 1);\n      } else if (write) {\n        return write(get, set, ...args);\n      } else if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n        throw new Error(\"refresh must be called without arguments\");\n      }\n    }\n  );\n}\n\nfunction atomWithLazy(makeInitial) {\n  const a = atom(void 0);\n  delete a.init;\n  Object.defineProperty(a, \"init\", {\n    get() {\n      return makeInitial();\n    }\n  });\n  return a;\n}\n\nexport { RESET, atomFamily, atomWithDefault, atomWithLazy, atomWithObservable, atomWithReducer, atomWithRefresh, atomWithReset, atomWithStorage, createJSONStorage, freezeAtom, freezeAtomCreator, loadable, selectAtom, splitAtom, withStorageValidator as unstable_withStorageValidator, unwrap };\n",
    "/**\r\n * Session State Machine\r\n *\r\n * Manages the lifecycle state of an agent session from creation to completion.\r\n * See SESSION_STATE_MACHINE.md for the full design specification.\r\n */\r\n\r\n// ============ States ============\r\nexport const SessionState = {\r\n\tidle: \"idle\",\r\n\tcreating: \"creating\",\r\n\tstreaming: \"streaming\",\r\n\twaiting_approval: \"waiting_approval\",\r\n\twaiting_input: \"waiting_input\",\r\n\tcompleted: \"completed\",\r\n\tpaused: \"paused\",\r\n\terror: \"error\",\r\n\tstopped: \"stopped\",\r\n} as const\r\n\r\nexport type SessionState = (typeof SessionState)[keyof typeof SessionState]\r\n\r\n// ============ Events ============\r\n\r\ntype StartSessionEvent = { type: \"start_session\" }\r\ntype SessionCreatedEvent = { type: \"session_created\"; sessionId: string }\r\ntype ApiReqStartedEvent = { type: \"api_req_started\" }\r\ntype SayTextEvent = { type: \"say_text\"; partial: boolean }\r\ntype AskToolEvent = { type: \"ask_tool\"; partial: boolean }\r\ntype AskCommandEvent = { type: \"ask_command\"; partial: boolean }\r\ntype AskBrowserActionLaunchEvent = { type: \"ask_browser_action_launch\"; partial: boolean }\r\ntype AskUseMcpServerEvent = { type: \"ask_use_mcp_server\"; partial: boolean }\r\ntype AskFollowupEvent = { type: \"ask_followup\"; partial: boolean }\r\ntype AskCompletionResultEvent = { type: \"ask_completion_result\" }\r\ntype AskApiReqFailedEvent = { type: \"ask_api_req_failed\" }\r\ntype AskMistakeLimitReachedEvent = { type: \"ask_mistake_limit_reached\" }\r\ntype AskInvalidModelEvent = { type: \"ask_invalid_model\" }\r\ntype AskPaymentRequiredPromptEvent = { type: \"ask_payment_required_prompt\" }\r\ntype AskResumeTaskEvent = { type: \"ask_resume_task\" }\r\ntype ProcessErrorEvent = { type: \"process_error\"; error: string }\r\ntype ApproveActionEvent = { type: \"approve_action\" }\r\ntype RejectActionEvent = { type: \"reject_action\" }\r\ntype SendMessageEvent = { type: \"send_message\"; content: string }\r\ntype CancelSessionEvent = { type: \"cancel_session\" }\r\ntype RetryEvent = { type: \"retry\" }\r\n\r\nexport type SessionEvent =\r\n\t| StartSessionEvent\r\n\t| SessionCreatedEvent\r\n\t| ApiReqStartedEvent\r\n\t| SayTextEvent\r\n\t| AskToolEvent\r\n\t| AskCommandEvent\r\n\t| AskBrowserActionLaunchEvent\r\n\t| AskUseMcpServerEvent\r\n\t| AskFollowupEvent\r\n\t| AskCompletionResultEvent\r\n\t| AskApiReqFailedEvent\r\n\t| AskMistakeLimitReachedEvent\r\n\t| AskInvalidModelEvent\r\n\t| AskPaymentRequiredPromptEvent\r\n\t| AskResumeTaskEvent\r\n\t| ProcessErrorEvent\r\n\t| ApproveActionEvent\r\n\t| RejectActionEvent\r\n\t| SendMessageEvent\r\n\t| CancelSessionEvent\r\n\t| RetryEvent\r\n\r\n// ============ Context ============\r\n\r\nexport interface SessionContext {\r\n\tsessionId?: string\r\n\terrorMessage?: string\r\n\tsawApiReqStarted: boolean\r\n\tsawSessionCreated: boolean\r\n}\r\n\r\n// ============ UI State ============\r\n\r\nexport interface SessionUiState {\r\n\tshowSpinner: boolean\r\n\tshowCancelButton: boolean\r\n\tisActive: boolean\r\n}\r\n\r\n// ============ State Machine Interface ============\r\n\r\nexport interface SessionStateMachine {\r\n\tgetState(): SessionState\r\n\tsend(event: SessionEvent): void\r\n\tgetUiState(): SessionUiState\r\n\tgetContext(): SessionContext\r\n\treset(): void\r\n}\r\n\r\n// ============ Implementation ============\r\n\r\nfunction createInitialContext(): SessionContext {\r\n\treturn {\r\n\t\tsessionId: undefined,\r\n\t\terrorMessage: undefined,\r\n\t\tsawApiReqStarted: false,\r\n\t\tsawSessionCreated: false,\r\n\t}\r\n}\r\n\r\nexport function createSessionStateMachine(): SessionStateMachine {\r\n\tlet state: SessionState = SessionState.idle\r\n\tlet context: SessionContext = createInitialContext()\r\n\r\n\tconst send = (event: SessionEvent): void => {\r\n\t\tconst { nextState, contextUpdate } = transition(state, event, context)\r\n\t\tstate = nextState\r\n\t\tif (contextUpdate) {\r\n\t\t\tcontext = { ...context, ...contextUpdate }\r\n\t\t}\r\n\t}\r\n\r\n\tconst getState = (): SessionState => state\r\n\r\n\tconst getUiState = (): SessionUiState => {\r\n\t\treturn {\r\n\t\t\tshowSpinner: state === SessionState.creating || state === SessionState.streaming,\r\n\t\t\tshowCancelButton:\r\n\t\t\t\tstate === SessionState.creating ||\r\n\t\t\t\tstate === SessionState.streaming ||\r\n\t\t\t\tstate === SessionState.waiting_approval ||\r\n\t\t\t\tstate === SessionState.waiting_input,\r\n\t\t\tisActive:\r\n\t\t\t\tstate === SessionState.creating ||\r\n\t\t\t\tstate === SessionState.streaming ||\r\n\t\t\t\tstate === SessionState.waiting_approval ||\r\n\t\t\t\tstate === SessionState.waiting_input,\r\n\t\t}\r\n\t}\r\n\r\n\tconst getContext = (): SessionContext => ({ ...context })\r\n\r\n\tconst reset = (): void => {\r\n\t\tstate = SessionState.idle\r\n\t\tcontext = createInitialContext()\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetState,\r\n\t\tsend,\r\n\t\tgetUiState,\r\n\t\tgetContext,\r\n\t\treset,\r\n\t}\r\n}\r\n\r\n// ============ Transition Logic ============\r\n\r\ninterface TransitionResult {\r\n\tnextState: SessionState\r\n\tcontextUpdate?: Partial<SessionContext>\r\n}\r\n\r\nfunction transition(currentState: SessionState, event: SessionEvent, context: SessionContext): TransitionResult {\r\n\tswitch (currentState) {\r\n\t\tcase SessionState.idle:\r\n\t\t\treturn transitionFromIdle(event)\r\n\r\n\t\tcase SessionState.creating:\r\n\t\t\treturn transitionFromCreating(event, context)\r\n\r\n\t\tcase SessionState.streaming:\r\n\t\t\treturn transitionFromStreaming(event)\r\n\r\n\t\tcase SessionState.waiting_approval:\r\n\t\t\treturn transitionFromWaitingApproval(event)\r\n\r\n\t\tcase SessionState.waiting_input:\r\n\t\t\treturn transitionFromWaitingInput(event)\r\n\r\n\t\tcase SessionState.completed:\r\n\t\t\treturn transitionFromCompleted(event)\r\n\r\n\t\tcase SessionState.paused:\r\n\t\t\treturn transitionFromPaused(event)\r\n\r\n\t\tcase SessionState.error:\r\n\t\t\treturn transitionFromError(event)\r\n\r\n\t\tcase SessionState.stopped:\r\n\t\t\treturn transitionFromStopped(event)\r\n\r\n\t\tdefault:\r\n\t\t\treturn { nextState: currentState }\r\n\t}\r\n}\r\n\r\nfunction transitionFromIdle(event: SessionEvent): TransitionResult {\r\n\tswitch (event.type) {\r\n\t\tcase \"start_session\":\r\n\t\t\treturn { nextState: SessionState.creating }\r\n\r\n\t\t// Allow direct transition to streaming if we receive events that indicate\r\n\t\t// the session is already running (e.g., multi-version mode, or missed start_session)\r\n\t\tcase \"session_created\":\r\n\t\t\treturn {\r\n\t\t\t\tnextState: SessionState.streaming,\r\n\t\t\t\tcontextUpdate: {\r\n\t\t\t\t\tsawSessionCreated: true,\r\n\t\t\t\t\tsessionId: (event as SessionCreatedEvent).sessionId,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\r\n\t\tcase \"api_req_started\":\r\n\t\t\treturn {\r\n\t\t\t\tnextState: SessionState.streaming,\r\n\t\t\t\tcontextUpdate: { sawApiReqStarted: true },\r\n\t\t\t}\r\n\r\n\t\tdefault:\r\n\t\t\treturn { nextState: SessionState.idle }\r\n\t}\r\n}\r\n\r\nfunction transitionFromCreating(event: SessionEvent, context: SessionContext): TransitionResult {\r\n\tswitch (event.type) {\r\n\t\tcase \"session_created\": {\r\n\t\t\tconst newContext: Partial<SessionContext> = {\r\n\t\t\t\tsawSessionCreated: true,\r\n\t\t\t\tsessionId: event.sessionId,\r\n\t\t\t}\r\n\t\t\t// Transition to streaming only if we've seen both events\r\n\t\t\tif (context.sawApiReqStarted) {\r\n\t\t\t\treturn { nextState: SessionState.streaming, contextUpdate: newContext }\r\n\t\t\t}\r\n\t\t\treturn { nextState: SessionState.creating, contextUpdate: newContext }\r\n\t\t}\r\n\r\n\t\tcase \"api_req_started\": {\r\n\t\t\tconst newContext: Partial<SessionContext> = { sawApiReqStarted: true }\r\n\t\t\t// Transition to streaming only if we've seen both events\r\n\t\t\tif (context.sawSessionCreated) {\r\n\t\t\t\treturn { nextState: SessionState.streaming, contextUpdate: newContext }\r\n\t\t\t}\r\n\t\t\treturn { nextState: SessionState.creating, contextUpdate: newContext }\r\n\t\t}\r\n\r\n\t\tcase \"process_error\":\r\n\t\t\treturn {\r\n\t\t\t\tnextState: SessionState.error,\r\n\t\t\t\tcontextUpdate: { errorMessage: event.error },\r\n\t\t\t}\r\n\r\n\t\tcase \"cancel_session\":\r\n\t\t\treturn { nextState: SessionState.stopped }\r\n\r\n\t\tdefault:\r\n\t\t\treturn { nextState: SessionState.creating }\r\n\t}\r\n}\r\n\r\nfunction transitionFromStreaming(event: SessionEvent): TransitionResult {\r\n\tswitch (event.type) {\r\n\t\t// Stay streaming on any say message\r\n\t\tcase \"say_text\":\r\n\t\t\treturn { nextState: SessionState.streaming }\r\n\r\n\t\t// Stay streaming on api_req_started (new request)\r\n\t\tcase \"api_req_started\":\r\n\t\t\treturn { nextState: SessionState.streaming }\r\n\r\n\t\t// Approval-required asks (only on complete)\r\n\t\tcase \"ask_tool\":\r\n\t\tcase \"ask_command\":\r\n\t\tcase \"ask_browser_action_launch\":\r\n\t\tcase \"ask_use_mcp_server\":\r\n\t\t\tif (event.partial) {\r\n\t\t\t\treturn { nextState: SessionState.streaming }\r\n\t\t\t}\r\n\t\t\treturn { nextState: SessionState.waiting_approval }\r\n\r\n\t\t// Input-required asks (only on complete)\r\n\t\tcase \"ask_followup\":\r\n\t\t\t// In practice, followup questions may only arrive as partial chunks and never emit a final\r\n\t\t\t// non-partial event. Treat any followup as \"waiting for user input\".\r\n\t\t\treturn { nextState: SessionState.waiting_input }\r\n\r\n\t\t// Completion\r\n\t\tcase \"ask_completion_result\":\r\n\t\t\treturn { nextState: SessionState.completed }\r\n\r\n\t\t// Errors\r\n\t\tcase \"ask_api_req_failed\":\r\n\t\tcase \"ask_mistake_limit_reached\":\r\n\t\tcase \"ask_invalid_model\":\r\n\t\tcase \"ask_payment_required_prompt\":\r\n\t\t\treturn { nextState: SessionState.error }\r\n\r\n\t\t// Paused\r\n\t\tcase \"ask_resume_task\":\r\n\t\t\treturn { nextState: SessionState.paused }\r\n\r\n\t\t// Cancel\r\n\t\tcase \"cancel_session\":\r\n\t\t\treturn { nextState: SessionState.stopped }\r\n\r\n\t\tdefault:\r\n\t\t\treturn { nextState: SessionState.streaming }\r\n\t}\r\n}\r\n\r\nfunction transitionFromWaitingApproval(event: SessionEvent): TransitionResult {\r\n\tswitch (event.type) {\r\n\t\tcase \"approve_action\":\r\n\t\tcase \"reject_action\":\r\n\t\tcase \"api_req_started\": // Auto-approved\r\n\t\t\treturn { nextState: SessionState.streaming }\r\n\r\n\t\tcase \"cancel_session\":\r\n\t\t\treturn { nextState: SessionState.stopped }\r\n\r\n\t\tdefault:\r\n\t\t\treturn { nextState: SessionState.waiting_approval }\r\n\t}\r\n}\r\n\r\nfunction transitionFromWaitingInput(event: SessionEvent): TransitionResult {\r\n\tswitch (event.type) {\r\n\t\tcase \"api_req_started\":\r\n\t\t\treturn { nextState: SessionState.streaming }\r\n\r\n\t\tcase \"send_message\":\r\n\t\t\treturn { nextState: SessionState.streaming }\r\n\r\n\t\tcase \"cancel_session\":\r\n\t\t\treturn { nextState: SessionState.stopped }\r\n\r\n\t\tdefault:\r\n\t\t\treturn { nextState: SessionState.waiting_input }\r\n\t}\r\n}\r\n\r\nfunction transitionFromCompleted(event: SessionEvent): TransitionResult {\r\n\tswitch (event.type) {\r\n\t\tcase \"api_req_started\":\r\n\t\t\treturn { nextState: SessionState.streaming }\r\n\r\n\t\tcase \"send_message\": // Continue with follow-up\r\n\t\t\treturn { nextState: SessionState.streaming }\r\n\r\n\t\tcase \"start_session\": // New task\r\n\t\t\treturn { nextState: SessionState.creating }\r\n\r\n\t\tdefault:\r\n\t\t\treturn { nextState: SessionState.completed }\r\n\t}\r\n}\r\n\r\nfunction transitionFromPaused(event: SessionEvent): TransitionResult {\r\n\tswitch (event.type) {\r\n\t\tcase \"api_req_started\":\r\n\t\t\treturn { nextState: SessionState.streaming }\r\n\r\n\t\tcase \"cancel_session\":\r\n\t\t\treturn { nextState: SessionState.stopped }\r\n\r\n\t\tdefault:\r\n\t\t\treturn { nextState: SessionState.paused }\r\n\t}\r\n}\r\n\r\nfunction transitionFromError(event: SessionEvent): TransitionResult {\r\n\tswitch (event.type) {\r\n\t\tcase \"api_req_started\":\r\n\t\t\treturn { nextState: SessionState.streaming }\r\n\r\n\t\tcase \"retry\":\r\n\t\t\treturn { nextState: SessionState.streaming }\r\n\r\n\t\tcase \"cancel_session\":\r\n\t\t\treturn { nextState: SessionState.stopped }\r\n\r\n\t\tdefault:\r\n\t\t\treturn { nextState: SessionState.error }\r\n\t}\r\n}\r\n\r\nfunction transitionFromStopped(event: SessionEvent): TransitionResult {\r\n\tswitch (event.type) {\r\n\t\tcase \"api_req_started\":\r\n\t\t\treturn { nextState: SessionState.streaming }\r\n\r\n\t\tcase \"start_session\": // New task\r\n\t\t\treturn { nextState: SessionState.creating }\r\n\r\n\t\tdefault:\r\n\t\t\treturn { nextState: SessionState.stopped }\r\n\t}\r\n}\r\n",
    "import { atom } from \"jotai\"\r\nimport { atomFamily } from \"jotai/utils\"\r\n\r\nexport type AgentStatus = \"creating\" | \"running\" | \"done\" | \"error\" | \"stopped\"\r\nexport type SessionSource = \"local\" | \"remote\"\r\n\r\nexport interface ParallelModeInfo {\r\n\tenabled: boolean\r\n\tbranch?: string\r\n\tworktreePath?: string\r\n\tcompletionMessage?: string\r\n}\r\n\r\nexport interface AgentSession {\r\n\tsessionId: string\r\n\tlabel: string\r\n\tprompt: string\r\n\tstatus: AgentStatus\r\n\tstartTime: number\r\n\tendTime?: number\r\n\texitCode?: number\r\n\terror?: string\r\n\tpid?: number\r\n\tsource: SessionSource\r\n\tparallelMode?: ParallelModeInfo\r\n\tgitUrl?: string\r\n\tautoMode?: boolean // True if session was started with --auto flag (non-interactive)\r\n}\r\n\r\n/**\r\n * Represents a session that is being created (waiting for CLI's session_created event)\r\n */\r\nexport interface PendingSession {\r\n\tprompt: string\r\n\tlabel: string\r\n\tstartTime: number\r\n\tparallelMode?: boolean\r\n\tgitUrl?: string\r\n\tautoMode?: boolean // True if session will be started with --auto flag\r\n}\r\n\r\nexport interface RemoteSession {\r\n\tsession_id: string\r\n\ttitle: string\r\n\tcreated_at: string\r\n\tupdated_at: string\r\n\tgit_url?: string\r\n}\r\n\r\n// Core atoms\r\nexport const sessionsMapAtom = atom<Record<string, AgentSession>>({})\r\nexport const sessionOrderAtom = atom<string[]>([])\r\nexport const selectedSessionIdAtom = atom<string | null>(null)\r\nexport const remoteSessionsAtom = atom<RemoteSession[]>([])\r\nexport const isRefreshingRemoteSessionsAtom = atom(false)\r\nexport const pendingSessionAtom = atom<PendingSession | null>(null)\r\n\r\nexport const startSessionFailedCounterAtom = atom(0)\r\n\r\n// Per-session input value for the chat input field\r\nexport const sessionInputAtomFamily = atomFamily((_sessionId: string) => atom(\"\"))\r\n\r\n// User preference for run mode (persisted across new agent forms)\r\nexport type RunMode = \"local\" | \"worktree\"\r\n// Default to local until worktree mode is ready to ship\r\nexport const preferredRunModeAtom = atom<RunMode>(\"local\")\r\n\r\n// Version count for multi-version mode (1 = single, 2-4 = multi-version with worktrees)\r\nexport type VersionCount = 1 | 2 | 3 | 4\r\nexport const MAX_VERSION_COUNT = 4\r\n// Derive options from MAX_VERSION_COUNT to ensure consistency\r\nexport const VERSION_COUNT_OPTIONS = Array.from({ length: MAX_VERSION_COUNT }, (_, i) => (i + 1) as VersionCount)\r\nexport const versionCountAtom = atom<VersionCount>(1)\r\n\r\n/**\r\n * Generate version labels with (v1), (v2), etc. suffixes for multi-version mode.\r\n * Single version (count=1) returns the original label without suffix.\r\n */\r\nexport function generateVersionLabels(baseLabel: string, count: VersionCount): string[] {\r\n\tif (count === 1) {\r\n\t\treturn [baseLabel]\r\n\t}\r\n\r\n\treturn Array.from({ length: count }, (_, i) => `${baseLabel} (v${i + 1})`)\r\n}\r\n\r\n// Derived - local sessions only\r\nexport const sessionsArrayAtom = atom((get) => {\r\n\tconst map = get(sessionsMapAtom)\r\n\tconst order = get(sessionOrderAtom)\r\n\treturn order.map((id) => map[id]).filter((s): s is AgentSession => s !== undefined)\r\n})\r\n\r\nfunction toAgentSession(remote: RemoteSession): AgentSession {\r\n\t// Parse dates safely - invalid dates will produce NaN from getTime()\r\n\tconst createdTime = remote.created_at ? new Date(remote.created_at).getTime() : 0\r\n\tconst updatedTime = remote.updated_at ? new Date(remote.updated_at).getTime() : 0\r\n\r\n\treturn {\r\n\t\tsessionId: remote.session_id,\r\n\t\tlabel: remote.title || \"Untitled\",\r\n\t\tprompt: \"\",\r\n\t\tstatus: \"done\",\r\n\t\t// Use 0 as fallback if dates are invalid (NaN)\r\n\t\tstartTime: Number.isNaN(createdTime) ? 0 : createdTime,\r\n\t\tendTime: Number.isNaN(updatedTime) ? 0 : updatedTime,\r\n\t\tsource: \"remote\",\r\n\t\tgitUrl: remote.git_url,\r\n\t}\r\n}\r\n\r\n// Merged sessions: local sessions + remote sessions (deduplicated)\r\nexport const mergedSessionsAtom = atom((get) => {\r\n\tconst localSessions = get(sessionsArrayAtom)\r\n\tconst remoteSessions = get(remoteSessionsAtom)\r\n\r\n\t// Build set of session IDs we already have locally\r\n\tconst localSessionIds = new Set(localSessions.filter((s) => s.sessionId).map((s) => s.sessionId))\r\n\r\n\t// Convert remote sessions, excluding those we already have locally\r\n\tconst remoteAsDisplay = remoteSessions.filter((rs) => !localSessionIds.has(rs.session_id)).map(toAgentSession)\r\n\r\n\t// Local sessions first (may be running), then remote sessions (completed)\r\n\treturn [...localSessions, ...remoteAsDisplay]\r\n})\r\n\r\nexport const selectedSessionAtom = atom((get) => {\r\n\tconst id = get(selectedSessionIdAtom)\r\n\tif (!id) return null\r\n\r\n\t// First check local sessions map\r\n\tconst localSession = get(sessionsMapAtom)[id]\r\n\tif (localSession) return localSession\r\n\r\n\t// Then check remote sessions (converted to AgentSession format)\r\n\tconst remoteSessions = get(remoteSessionsAtom)\r\n\tconst remoteSession = remoteSessions.find((rs) => rs.session_id === id)\r\n\tif (remoteSession) return toAgentSession(remoteSession)\r\n\r\n\treturn null\r\n})\r\n\r\n// Actions\r\nexport const upsertSessionAtom = atom(null, (get, set, session: AgentSession) => {\r\n\tconst current = get(sessionsMapAtom)\r\n\tconst order = get(sessionOrderAtom)\r\n\tconst isNewSession = !order.includes(session.sessionId)\r\n\r\n\tset(sessionsMapAtom, { ...current, [session.sessionId]: session })\r\n\tif (isNewSession) {\r\n\t\tset(sessionOrderAtom, [session.sessionId, ...order])\r\n\t\tif (get(selectedSessionIdAtom) === null) {\r\n\t\t\tset(selectedSessionIdAtom, session.sessionId)\r\n\t\t}\r\n\t}\r\n})\r\n\r\nexport const removeSessionAtom = atom(null, (get, set, sessionId: string) => {\r\n\tconst current = get(sessionsMapAtom)\r\n\tconst { [sessionId]: _, ...rest } = current\r\n\tset(sessionsMapAtom, rest)\r\n\tset(\r\n\t\tsessionOrderAtom,\r\n\t\tget(sessionOrderAtom).filter((id) => id !== sessionId),\r\n\t)\r\n\tif (get(selectedSessionIdAtom) === sessionId) {\r\n\t\tconst remaining = get(sessionOrderAtom)\r\n\t\tset(selectedSessionIdAtom, remaining[0] || null)\r\n\t}\r\n})\r\n\r\nexport const updateSessionStatusAtom = atom(\r\n\tnull,\r\n\t(\r\n\t\tget,\r\n\t\tset,\r\n\t\tpayload: {\r\n\t\t\tsessionId: string\r\n\t\t\tstatus: AgentStatus\r\n\t\t\texitCode?: number\r\n\t\t\terror?: string\r\n\t\t},\r\n\t) => {\r\n\t\tconst current = get(sessionsMapAtom)\r\n\t\tconst session = current[payload.sessionId]\r\n\t\tif (!session) return\r\n\r\n\t\tset(sessionsMapAtom, {\r\n\t\t\t...current,\r\n\t\t\t[payload.sessionId]: {\r\n\t\t\t\t...session,\r\n\t\t\t\tstatus: payload.status,\r\n\t\t\t\texitCode: payload.exitCode,\r\n\t\t\t\terror: payload.error,\r\n\t\t\t\tendTime: payload.status !== \"running\" ? Date.now() : session.endTime,\r\n\t\t\t},\r\n\t\t})\r\n\t},\r\n)\r\n\r\nexport const setRemoteSessionsAtom = atom(null, (_get, set, sessions: RemoteSession[]) => {\r\n\tset(remoteSessionsAtom, sessions)\r\n\tset(isRefreshingRemoteSessionsAtom, false)\r\n})\r\n",
    "/**\r\n * Jotai atoms for session state machines.\r\n *\r\n * Wraps the state machine to provide reactive state management for each session.\r\n */\r\nimport { atom } from \"jotai\"\r\nimport {\r\n\tcreateSessionStateMachine,\r\n\ttype SessionStateMachine,\r\n\ttype SessionEvent,\r\n\ttype SessionState,\r\n\ttype SessionUiState,\r\n} from \"../sessionStateMachine\"\r\nimport { selectedSessionIdAtom } from \"./sessions\"\r\n\r\n// Map of session ID to state machine instance\r\nconst sessionStateMachines = new Map<string, SessionStateMachine>()\r\n\r\n/**\r\n * Reset all state machines. Only for testing.\r\n */\r\nexport function __resetStateMachines() {\r\n\tsessionStateMachines.clear()\r\n}\r\n\r\n/**\r\n * Get or create a state machine for a session.\r\n */\r\nfunction getOrCreateMachine(sessionId: string): SessionStateMachine {\r\n\tlet machine = sessionStateMachines.get(sessionId)\r\n\tif (!machine) {\r\n\t\tmachine = createSessionStateMachine()\r\n\t\tsessionStateMachines.set(sessionId, machine)\r\n\t}\r\n\treturn machine\r\n}\r\n\r\n/**\r\n * Stores the current state for each session (triggers Jotai reactivity).\r\n */\r\nexport const sessionMachineStateAtom = atom<Record<string, SessionState>>({})\r\n\r\n/**\r\n * Stores the UI state for each session (triggers Jotai reactivity).\r\n */\r\nexport const sessionMachineUiStateAtom = atom<Record<string, SessionUiState>>({})\r\n\r\n/**\r\n * Send an event to a session's state machine.\r\n * This will update the machine state and trigger Jotai reactivity.\r\n */\r\nexport const sendSessionEventAtom = atom(null, (get, set, payload: { sessionId: string; event: SessionEvent }) => {\r\n\tconst { sessionId, event } = payload\r\n\tconst machine = getOrCreateMachine(sessionId)\r\n\r\n\tmachine.send(event)\r\n\r\n\t// Update atoms to trigger reactivity\r\n\tconst currentStates = get(sessionMachineStateAtom)\r\n\tconst currentUiStates = get(sessionMachineUiStateAtom)\r\n\r\n\tset(sessionMachineStateAtom, {\r\n\t\t...currentStates,\r\n\t\t[sessionId]: machine.getState(),\r\n\t})\r\n\r\n\tset(sessionMachineUiStateAtom, {\r\n\t\t...currentUiStates,\r\n\t\t[sessionId]: machine.getUiState(),\r\n\t})\r\n})\r\n\r\n/**\r\n * Reset a session's state machine to idle.\r\n */\r\nexport const resetSessionMachineAtom = atom(null, (get, set, sessionId: string) => {\r\n\tconst machine = sessionStateMachines.get(sessionId)\r\n\tif (machine) {\r\n\t\tmachine.reset()\r\n\r\n\t\tconst currentStates = get(sessionMachineStateAtom)\r\n\t\tconst currentUiStates = get(sessionMachineUiStateAtom)\r\n\r\n\t\tset(sessionMachineStateAtom, {\r\n\t\t\t...currentStates,\r\n\t\t\t[sessionId]: machine.getState(),\r\n\t\t})\r\n\r\n\t\tset(sessionMachineUiStateAtom, {\r\n\t\t\t...currentUiStates,\r\n\t\t\t[sessionId]: machine.getUiState(),\r\n\t\t})\r\n\t}\r\n})\r\n\r\n/**\r\n * Clean up a session's state machine (e.g., when session is removed).\r\n */\r\nexport const cleanupSessionMachineAtom = atom(null, (_get, _set, sessionId: string) => {\r\n\tsessionStateMachines.delete(sessionId)\r\n})\r\n\r\n/**\r\n * Get the state for the selected session.\r\n */\r\nexport const selectedSessionMachineStateAtom = atom((get) => {\r\n\tconst sessionId = get(selectedSessionIdAtom)\r\n\tif (!sessionId) return null\r\n\r\n\tconst states = get(sessionMachineStateAtom)\r\n\treturn states[sessionId] ?? null\r\n})\r\n\r\n/**\r\n * Get the UI state for the selected session.\r\n */\r\nexport const selectedSessionMachineUiStateAtom = atom((get) => {\r\n\tconst sessionId = get(selectedSessionIdAtom)\r\n\tif (!sessionId) return null\r\n\r\n\tconst uiStates = get(sessionMachineUiStateAtom)\r\n\treturn uiStates[sessionId] ?? null\r\n})\r\n\r\n/**\r\n * Derived: should show spinner for a session.\r\n * Falls back to false if no state machine exists.\r\n */\r\nexport const sessionShowSpinnerAtom = atom((get) => {\r\n\tconst uiStates = get(sessionMachineUiStateAtom)\r\n\treturn (sessionId: string) => uiStates[sessionId]?.showSpinner ?? false\r\n})\r\n\r\n/**\r\n * Derived: should show cancel button for a session.\r\n */\r\nexport const sessionShowCancelButtonAtom = atom((get) => {\r\n\tconst uiStates = get(sessionMachineUiStateAtom)\r\n\treturn (sessionId: string) => uiStates[sessionId]?.showCancelButton ?? false\r\n})\r\n\r\n/**\r\n * Derived: is session active (creating, streaming, waiting).\r\n */\r\nexport const sessionIsActiveAtom = atom((get) => {\r\n\tconst uiStates = get(sessionMachineUiStateAtom)\r\n\treturn (sessionId: string) => uiStates[sessionId]?.isActive ?? false\r\n})\r\n",
    "import { atom } from \"jotai\"\r\nimport { atomFamily } from \"jotai/utils\"\r\nimport type { ClineMessage } from \"@roo-code/types\"\r\nimport { sendSessionEventAtom } from \"./stateMachine\"\r\nimport type { SessionEvent } from \"../sessionStateMachine\"\r\n\r\n// Per-session messages using atomFamily\r\nexport const sessionMessagesAtomFamily = atomFamily((_sessionId: string) => atom<ClineMessage[]>([]))\r\n\r\n// Version tracking for reconciliation (per session)\r\nexport const sessionMessageVersionsAtomFamily = atomFamily((_sessionId: string) => atom<Map<number, number>>(new Map()))\r\n\r\n// Derived: last message per session\r\nexport const lastSessionMessageAtomFamily = atomFamily((sessionId: string) =>\r\n\tatom((get) => {\r\n\t\tconst messages = get(sessionMessagesAtomFamily(sessionId))\r\n\t\treturn messages[messages.length - 1] || null\r\n\t}),\r\n)\r\n\r\n// Derived: check if session has messages\r\nexport const hasSessionMessagesAtomFamily = atomFamily((sessionId: string) =>\r\n\tatom((get) => {\r\n\t\tconst messages = get(sessionMessagesAtomFamily(sessionId))\r\n\t\treturn messages.length > 0\r\n\t}),\r\n)\r\n\r\n// Actions\r\nexport const updateSessionMessagesAtom = atom(\r\n\tnull,\r\n\t(get, set, payload: { sessionId: string; messages: ClineMessage[] }) => {\r\n\t\tconst { sessionId, messages } = payload\r\n\t\tconst current = get(sessionMessagesAtomFamily(sessionId))\r\n\t\tconst versions = get(sessionMessageVersionsAtomFamily(sessionId))\r\n\r\n\t\t// Reconcile to prevent streaming flicker\r\n\t\tconst reconciled = reconcileMessages(current, messages, versions)\r\n\t\tset(sessionMessagesAtomFamily(sessionId), reconciled)\r\n\r\n\t\t// Update version map\r\n\t\tconst newVersions = new Map<number, number>()\r\n\t\treconciled.forEach((m) => newVersions.set(m.ts, getContentLength(m)))\r\n\t\tset(sessionMessageVersionsAtomFamily(sessionId), newVersions)\r\n\r\n\t\t// Send events for new/updated messages (in order)\r\n\t\tconst previous = new Map(current.map((m) => [m.ts, m]))\r\n\t\tfor (const msg of reconciled) {\r\n\t\t\tconst prev = previous.get(msg.ts)\r\n\t\t\tconst isNew = !prev\r\n\t\t\tconst becameComplete = prev?.partial && !msg.partial\r\n\t\t\tif (!isNew && !becameComplete) continue\r\n\t\t\tconst event = messageToEvent(msg)\r\n\t\t\tif (event) {\r\n\t\t\t\tset(sendSessionEventAtom, { sessionId, event })\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n)\r\n\r\nexport const updateSessionMessageByTsAtom = atom(\r\n\tnull,\r\n\t(get, set, payload: { sessionId: string; message: ClineMessage }) => {\r\n\t\tconst { sessionId, message } = payload\r\n\t\tconst messages = get(sessionMessagesAtomFamily(sessionId))\r\n\t\tconst idx = messages.findIndex((m) => m.ts === message.ts)\r\n\t\tif (idx === -1) return\r\n\r\n\t\tconst newMessages = [...messages]\r\n\t\tnewMessages[idx] = message\r\n\t\tset(sessionMessagesAtomFamily(sessionId), newMessages)\r\n\r\n\t\t// Update version\r\n\t\tconst versions = get(sessionMessageVersionsAtomFamily(sessionId))\r\n\t\tconst newVersions = new Map(versions)\r\n\t\tnewVersions.set(message.ts, getContentLength(message))\r\n\t\tset(sessionMessageVersionsAtomFamily(sessionId), newVersions)\r\n\t},\r\n)\r\n\r\nexport const clearSessionMessagesAtom = atom(null, (_get, set, sessionId: string) => {\r\n\tset(sessionMessagesAtomFamily(sessionId), [])\r\n\tset(sessionMessageVersionsAtomFamily(sessionId), new Map())\r\n})\r\n\r\n// Helpers - adapted from cli/src/state/atoms/extension.ts\r\nexport function getContentLength(msg: ClineMessage): number {\r\n\treturn (msg.text?.length || 0) + (msg.say?.length || 0) + (msg.ask?.length || 0)\r\n}\r\n\r\nexport function reconcileMessages(\r\n\tcurrent: ClineMessage[],\r\n\tincoming: ClineMessage[],\r\n\tversions: Map<number, number>,\r\n): ClineMessage[] {\r\n\tconst currentMap = new Map(current.map((m) => [m.ts, m]))\r\n\r\n\treturn incoming.map((incomingMsg) => {\r\n\t\tconst existing = currentMap.get(incomingMsg.ts)\r\n\t\tif (!existing) return incomingMsg\r\n\r\n\t\t// Protect completed messages from partial rollback\r\n\t\tif (!existing.partial && incomingMsg.partial) {\r\n\t\t\tconst currentLen = versions.get(incomingMsg.ts) || 0\r\n\t\t\tif (getContentLength(incomingMsg) <= currentLen) {\r\n\t\t\t\treturn existing\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn incomingMsg\r\n\t})\r\n}\r\n\r\n/**\r\n * Convert a ClineMessage to a SessionEvent for the state machine.\r\n * Returns null if the message doesn't map to a state-changing event.\r\n */\r\nexport function messageToEvent(msg: ClineMessage): SessionEvent | null {\r\n\tconst partial = msg.partial ?? false\r\n\r\n\t// Say messages - check the say field for specific event types\r\n\tif (msg.type === \"say\" && msg.say) {\r\n\t\tswitch (msg.say) {\r\n\t\t\t// API request started - important for transitioning to streaming\r\n\t\t\tcase \"api_req_started\":\r\n\t\t\t\treturn { type: \"api_req_started\" }\r\n\r\n\t\t\t// Text and other say messages - stay streaming\r\n\t\t\tcase \"text\":\r\n\t\t\tcase \"command_output\":\r\n\t\t\tcase \"user_feedback\":\r\n\t\t\tcase \"user_feedback_diff\":\r\n\t\t\tcase \"api_req_finished\":\r\n\t\t\tcase \"api_req_retried\":\r\n\t\t\tcase \"completion_result\":\r\n\t\t\tcase \"shell_integration_warning\":\r\n\t\t\tcase \"checkpoint_saved\":\r\n\t\t\t\treturn { type: \"say_text\", partial }\r\n\r\n\t\t\tdefault:\r\n\t\t\t\treturn { type: \"say_text\", partial }\r\n\t\t}\r\n\t}\r\n\r\n\t// Ask messages - depend on ask type\r\n\tif (msg.type === \"ask\" && msg.ask) {\r\n\t\tswitch (msg.ask) {\r\n\t\t\t// Approval-required asks\r\n\t\t\tcase \"tool\":\r\n\t\t\t\treturn { type: \"ask_tool\", partial }\r\n\t\t\tcase \"command\":\r\n\t\t\t\treturn { type: \"ask_command\", partial }\r\n\t\t\tcase \"browser_action_launch\":\r\n\t\t\t\treturn { type: \"ask_browser_action_launch\", partial }\r\n\t\t\tcase \"use_mcp_server\":\r\n\t\t\t\treturn { type: \"ask_use_mcp_server\", partial }\r\n\r\n\t\t\t// Input-required asks\r\n\t\t\tcase \"followup\":\r\n\t\t\t\treturn { type: \"ask_followup\", partial }\r\n\r\n\t\t\t// Completion\r\n\t\t\tcase \"completion_result\":\r\n\t\t\t\treturn { type: \"ask_completion_result\" }\r\n\r\n\t\t\t// Errors\r\n\t\t\tcase \"api_req_failed\":\r\n\t\t\t\treturn { type: \"ask_api_req_failed\" }\r\n\t\t\tcase \"mistake_limit_reached\":\r\n\t\t\t\treturn { type: \"ask_mistake_limit_reached\" }\r\n\t\t\tcase \"invalid_model\":\r\n\t\t\t\treturn { type: \"ask_invalid_model\" }\r\n\t\t\tcase \"payment_required_prompt\":\r\n\t\t\t\treturn { type: \"ask_payment_required_prompt\" }\r\n\r\n\t\t\t// Resumable\r\n\t\t\tcase \"resume_task\":\r\n\t\t\t\treturn { type: \"ask_resume_task\" }\r\n\t\t\tcase \"resume_completed_task\":\r\n\t\t\t\treturn { type: \"ask_resume_task\" }\r\n\r\n\t\t\tdefault:\r\n\t\t\t\treturn null\r\n\t\t}\r\n\t}\r\n\r\n\treturn null\r\n}\r\n",
    "import { atom } from \"jotai\"\r\nimport { atomFamily } from \"jotai/utils\"\r\nimport type { TodoItem } from \"@roo-code/types\"\r\n\r\n/**\r\n * Per-session todo list using atomFamily.\r\n * Tracks the latest todos extracted from session messages.\r\n */\r\nexport const sessionTodosAtomFamily = atomFamily((_sessionId: string) => atom<TodoItem[]>([]))\r\n\r\n/**\r\n * Computed stats for a todo list.\r\n */\r\nexport interface TodoStats {\r\n\ttodos: TodoItem[]\r\n\tcompletedCount: number\r\n\ttotalCount: number\r\n\tinProgressTodo: TodoItem | undefined\r\n\tnextPendingTodo: TodoItem | undefined\r\n\tcurrentTodo: TodoItem | undefined\r\n\tallCompleted: boolean\r\n\tprogressPercent: number\r\n}\r\n\r\n/**\r\n * Compute stats from a todo list. Pure function for testability.\r\n */\r\nexport function computeTodoStats(todos: TodoItem[]): TodoStats {\r\n\tconst completedCount = todos.filter((t) => t.status === \"completed\").length\r\n\tconst totalCount = todos.length\r\n\tconst inProgressTodo = todos.find((t) => t.status === \"in_progress\")\r\n\tconst nextPendingTodo = todos.find((t) => t.status === \"pending\")\r\n\tconst currentTodo = inProgressTodo || nextPendingTodo\r\n\tconst allCompleted = totalCount > 0 && completedCount === totalCount\r\n\tconst progressPercent = totalCount > 0 ? (completedCount / totalCount) * 100 : 0\r\n\r\n\treturn {\r\n\t\ttodos,\r\n\t\tcompletedCount,\r\n\t\ttotalCount,\r\n\t\tinProgressTodo,\r\n\t\tnextPendingTodo,\r\n\t\tcurrentTodo,\r\n\t\tallCompleted,\r\n\t\tprogressPercent,\r\n\t}\r\n}\r\n\r\n/**\r\n * Derived atom family for todo stats per session.\r\n */\r\nexport const sessionTodoStatsAtomFamily = atomFamily((sessionId: string) =>\r\n\tatom((get): TodoStats => {\r\n\t\tconst todos = get(sessionTodosAtomFamily(sessionId))\r\n\t\treturn computeTodoStats(todos)\r\n\t}),\r\n)\r\n\r\n/**\r\n * Action atom to update todos for a session.\r\n */\r\nexport const updateSessionTodosAtom = atom(null, (_get, set, payload: { sessionId: string; todos: TodoItem[] }) => {\r\n\tconst { sessionId, todos } = payload\r\n\tset(sessionTodosAtomFamily(sessionId), todos)\r\n})\r\n",
    "import { atom } from \"jotai\"\r\n\r\n/**\r\n * List of local branches available in the workspace repository.\r\n * This is workspace-level state (not session-specific) because all sessions\r\n * share the same git repository and have access to the same branches.\r\n */\r\nexport const branchesAtom = atom<string[]>([])\r\n\r\n/**\r\n * Current branch name in the workspace (not session-specific)\r\n */\r\nexport const currentBranchAtom = atom<string | undefined>(undefined)\r\n\r\n/**\r\n * Action atom to update the branches list and current branch\r\n */\r\nexport const updateBranchesAtom = atom(null, (_get, set, payload: { branches: string[]; currentBranch?: string }) => {\r\n\tconst { branches, currentBranch } = payload\r\n\tset(branchesAtom, branches)\r\n\tset(currentBranchAtom, currentBranch)\r\n})\r\n",
    "import type { ClineMessage, TodoItem } from \"@roo-code/types\"\r\n\r\ninterface TodoMetadata {\r\n\ttool?: string\r\n\ttodos?: TodoItem[]\r\n}\r\n\r\n/**\r\n * Extract the latest todos from a list of ClineMessages.\r\n * Checks both metadata (from CLI) and parsed text for todo data.\r\n */\r\nexport function extractTodosFromMessages(messages: ClineMessage[]): TodoItem[] {\r\n\tconst todos = messages\r\n\t\t.filter(\r\n\t\t\t(msg) =>\r\n\t\t\t\t(msg.type === \"ask\" && msg.ask === \"tool\") || (msg.type === \"say\" && msg.say === \"user_edit_todos\"),\r\n\t\t)\r\n\t\t.map((msg) => {\r\n\t\t\t// Check metadata first (CLI sends tool info here)\r\n\t\t\tconst metadata = msg.metadata as TodoMetadata | undefined\r\n\t\t\tif (metadata?.tool === \"updateTodoList\" && Array.isArray(metadata.todos)) {\r\n\t\t\t\treturn { tool: \"updateTodoList\", todos: metadata.todos }\r\n\t\t\t}\r\n\t\t\t// Fall back to parsing text\r\n\t\t\ttry {\r\n\t\t\t\treturn JSON.parse(msg.text ?? \"{}\")\r\n\t\t\t} catch {\r\n\t\t\t\treturn null\r\n\t\t\t}\r\n\t\t})\r\n\t\t.filter((item) => item && item.tool === \"updateTodoList\" && Array.isArray(item.todos))\r\n\t\t.map((item) => item.todos as TodoItem[])\r\n\t\t.pop()\r\n\r\n\treturn todos ?? []\r\n}\r\n",
    "import { useEffect, useRef } from \"react\"\r\nimport { useAtomValue, useSetAtom } from \"jotai\"\r\nimport type { ClineMessage } from \"@roo-code/types\"\r\nimport { updateSessionMessagesAtom } from \"../atoms/messages\"\r\nimport { updateSessionTodosAtom } from \"../atoms/todos\"\r\nimport { updateBranchesAtom } from \"../atoms/branches\"\r\nimport { extractTodosFromMessages } from \"./extractTodosFromMessages\"\r\nimport {\r\n\tupsertSessionAtom,\r\n\tremoveSessionAtom,\r\n\tselectedSessionIdAtom,\r\n\tstartSessionFailedCounterAtom,\r\n\tsessionOrderAtom,\r\n\tremoteSessionsAtom,\r\n\tpendingSessionAtom,\r\n\tisRefreshingRemoteSessionsAtom,\r\n\ttype AgentSession,\r\n\ttype RemoteSession,\r\n\ttype PendingSession,\r\n} from \"../atoms/sessions\"\r\nimport { sendSessionEventAtom, cleanupSessionMachineAtom } from \"../atoms/stateMachine\"\r\nimport type { SessionEvent } from \"../sessionStateMachine\"\r\n\r\ninterface AgentManagerState {\r\n\tsessions: AgentSession[]\r\n\tselectedId: string | null\r\n}\r\n\r\ninterface ChatMessagesMessage {\r\n\ttype: \"agentManager.chatMessages\"\r\n\tsessionId: string\r\n\tmessages: ClineMessage[]\r\n}\r\n\r\ninterface StateMessage {\r\n\ttype: \"agentManager.state\"\r\n\tstate: AgentManagerState\r\n}\r\n\r\ninterface StartSessionFailedMessage {\r\n\ttype: \"agentManager.startSessionFailed\"\r\n}\r\n\r\ninterface RemoteSessionsMessage {\r\n\ttype: \"agentManager.remoteSessions\"\r\n\tsessions: RemoteSession[]\r\n}\r\n\r\ninterface PendingSessionMessage {\r\n\ttype: \"agentManager.pendingSession\"\r\n\tpendingSession: PendingSession | null\r\n}\r\n\r\ninterface StateEventMessage {\r\n\ttype: \"agentManager.stateEvent\"\r\n\tsessionId: string\r\n\teventType: string\r\n\tpartial?: boolean\r\n}\r\n\r\ninterface BranchesMessage {\r\n\ttype: \"agentManager.branches\"\r\n\tbranches: string[]\r\n\tcurrentBranch?: string\r\n}\r\n\r\ntype ExtensionMessage =\r\n\t| ChatMessagesMessage\r\n\t| StateMessage\r\n\t| StartSessionFailedMessage\r\n\t| RemoteSessionsMessage\r\n\t| PendingSessionMessage\r\n\t| StateEventMessage\r\n\t| BranchesMessage\r\n\t| { type: string; [key: string]: unknown }\r\n\r\n/**\r\n * Maps extension state event types to state machine events.\r\n */\r\nfunction mapToStateMachineEvent(eventType: string, partial?: boolean): SessionEvent | null {\r\n\tswitch (eventType) {\r\n\t\tcase \"api_req_started\":\r\n\t\t\treturn { type: \"api_req_started\" }\r\n\r\n\t\t// Input-required asks\r\n\t\tcase \"ask_followup\":\r\n\t\t\t// Followups should always transition to waiting_input (partial handling is done in the state machine).\r\n\t\t\treturn { type: \"ask_followup\", partial: partial ?? false }\r\n\r\n\t\t// Approval-required asks\r\n\t\tcase \"ask_tool\":\r\n\t\t\treturn { type: \"ask_tool\", partial: partial ?? false }\r\n\t\tcase \"ask_command\":\r\n\t\t\treturn { type: \"ask_command\", partial: partial ?? false }\r\n\t\tcase \"ask_browser_action_launch\":\r\n\t\t\treturn { type: \"ask_browser_action_launch\", partial: partial ?? false }\r\n\t\tcase \"ask_use_mcp_server\":\r\n\t\t\treturn { type: \"ask_use_mcp_server\", partial: partial ?? false }\r\n\r\n\t\t// Completion\r\n\t\tcase \"ask_completion_result\":\r\n\t\t\treturn { type: \"ask_completion_result\" }\r\n\r\n\t\t// Paused state\r\n\t\tcase \"ask_resume_task\":\r\n\t\t\treturn { type: \"ask_resume_task\" }\r\n\r\n\t\t// Error states\r\n\t\tcase \"ask_api_req_failed\":\r\n\t\t\treturn { type: \"ask_api_req_failed\" }\r\n\t\tcase \"ask_mistake_limit_reached\":\r\n\t\t\treturn { type: \"ask_mistake_limit_reached\" }\r\n\t\tcase \"ask_invalid_model\":\r\n\t\t\treturn { type: \"ask_invalid_model\" }\r\n\t\tcase \"ask_payment_required_prompt\":\r\n\t\t\treturn { type: \"ask_payment_required_prompt\" }\r\n\r\n\t\t// Cancellation\r\n\t\tcase \"cancel_session\":\r\n\t\t\treturn { type: \"cancel_session\" }\r\n\r\n\t\tdefault:\r\n\t\t\treturn null\r\n\t}\r\n}\r\n\r\n/**\r\n * Hook that listens for messages from the extension and updates Jotai state.\r\n * This bridges the VS Code extension IPC with the Jotai state management.\r\n */\r\nexport function useAgentManagerMessages() {\r\n\tconst updateSessionMessages = useSetAtom(updateSessionMessagesAtom)\r\n\tconst updateSessionTodos = useSetAtom(updateSessionTodosAtom)\r\n\tconst updateBranches = useSetAtom(updateBranchesAtom)\r\n\tconst upsertSession = useSetAtom(upsertSessionAtom)\r\n\tconst removeSession = useSetAtom(removeSessionAtom)\r\n\tconst setSelectedSessionId = useSetAtom(selectedSessionIdAtom)\r\n\tconst setStartSessionFailedCounter = useSetAtom(startSessionFailedCounterAtom)\r\n\tconst setRemoteSessions = useSetAtom(remoteSessionsAtom)\r\n\tconst setPendingSession = useSetAtom(pendingSessionAtom)\r\n\tconst setIsRefreshingRemoteSessions = useSetAtom(isRefreshingRemoteSessionsAtom)\r\n\tconst sendSessionEvent = useSetAtom(sendSessionEventAtom)\r\n\tconst cleanupSessionMachine = useSetAtom(cleanupSessionMachineAtom)\r\n\tconst sessionOrder = useAtomValue(sessionOrderAtom)\r\n\tconst hasInitializedSelection = useRef(false)\r\n\tconst knownSessionsRef = useRef(new Set<string>())\r\n\r\n\tuseEffect(() => {\r\n\t\tfunction handleMessage(event: MessageEvent<ExtensionMessage>) {\r\n\t\t\tconst message = event.data\r\n\r\n\t\t\tswitch (message.type) {\r\n\t\t\t\tcase \"agentManager.chatMessages\": {\r\n\t\t\t\t\tconst { sessionId, messages } = message as ChatMessagesMessage\r\n\t\t\t\t\tupdateSessionMessages({ sessionId, messages })\r\n\t\t\t\t\t// Extract and update todos from messages\r\n\t\t\t\t\tconst todos = extractTodosFromMessages(messages)\r\n\t\t\t\t\tupdateSessionTodos({ sessionId, todos })\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase \"agentManager.state\": {\r\n\t\t\t\t\tconst { state } = message as StateMessage\r\n\t\t\t\t\tfor (const session of state.sessions) {\r\n\t\t\t\t\t\t// Check if this is a new session we haven't seen before\r\n\t\t\t\t\t\tconst isNewSession = !knownSessionsRef.current.has(session.sessionId)\r\n\t\t\t\t\t\tupsertSession(session)\r\n\r\n\t\t\t\t\t\t// Send state machine events for new sessions based on status\r\n\t\t\t\t\t\tif (isNewSession) {\r\n\t\t\t\t\t\t\tknownSessionsRef.current.add(session.sessionId)\r\n\t\t\t\t\t\t\tif (session.status === \"creating\" || session.status === \"running\") {\r\n\t\t\t\t\t\t\t\tsendSessionEvent({\r\n\t\t\t\t\t\t\t\t\tsessionId: session.sessionId,\r\n\t\t\t\t\t\t\t\t\tevent: { type: \"start_session\" },\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tsendSessionEvent({\r\n\t\t\t\t\t\t\t\t\tsessionId: session.sessionId,\r\n\t\t\t\t\t\t\t\t\tevent: { type: \"session_created\", sessionId: session.sessionId },\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// If session is already running, also send api_req_started\r\n\t\t\t\t\t\t\t\t// The state machine needs both session_created AND api_req_started\r\n\t\t\t\t\t\t\t\t// to transition from \"creating\" to \"streaming\"\r\n\t\t\t\t\t\t\t\tif (session.status === \"running\") {\r\n\t\t\t\t\t\t\t\t\tsendSessionEvent({\r\n\t\t\t\t\t\t\t\t\t\tsessionId: session.sessionId,\r\n\t\t\t\t\t\t\t\t\t\tevent: { type: \"api_req_started\" },\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst extensionSessionIds = new Set(state.sessions.map((s) => s.sessionId))\r\n\t\t\t\t\tfor (const sessionId of sessionOrder) {\r\n\t\t\t\t\t\tif (!extensionSessionIds.has(sessionId)) {\r\n\t\t\t\t\t\t\tremoveSession(sessionId)\r\n\t\t\t\t\t\t\tcleanupSessionMachine(sessionId)\r\n\t\t\t\t\t\t\tknownSessionsRef.current.delete(sessionId)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!hasInitializedSelection.current && state.selectedId !== undefined) {\r\n\t\t\t\t\t\tsetSelectedSessionId(state.selectedId)\r\n\t\t\t\t\t\thasInitializedSelection.current = true\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase \"agentManager.startSessionFailed\": {\r\n\t\t\t\t\t// Increment counter so components can reset their loading state\r\n\t\t\t\t\tsetStartSessionFailedCounter((c) => c + 1)\r\n\t\t\t\t\t// Also clear pending session\r\n\t\t\t\t\tsetPendingSession(null)\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase \"agentManager.remoteSessions\": {\r\n\t\t\t\t\tconst { sessions } = message as RemoteSessionsMessage\r\n\t\t\t\t\tsetRemoteSessions(sessions)\r\n\t\t\t\t\tsetIsRefreshingRemoteSessions(false)\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase \"agentManager.pendingSession\": {\r\n\t\t\t\t\tconst { pendingSession } = message as PendingSessionMessage\r\n\t\t\t\t\tsetPendingSession(pendingSession)\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase \"agentManager.stateEvent\": {\r\n\t\t\t\t\tconst { sessionId, eventType, partial } = message as StateEventMessage\r\n\t\t\t\t\t// Convert extension state events to state machine events\r\n\t\t\t\t\tconst event = mapToStateMachineEvent(eventType, partial)\r\n\t\t\t\t\tif (event) {\r\n\t\t\t\t\t\tsendSessionEvent({ sessionId, event })\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase \"agentManager.branches\": {\r\n\t\t\t\t\tconst { branches, currentBranch } = message as BranchesMessage\r\n\t\t\t\t\tupdateBranches({ branches, currentBranch })\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\twindow.addEventListener(\"message\", handleMessage)\r\n\t\treturn () => window.removeEventListener(\"message\", handleMessage)\r\n\t}, [\r\n\t\tupdateSessionMessages,\r\n\t\tupdateSessionTodos,\r\n\t\tupdateBranches,\r\n\t\tupsertSession,\r\n\t\tremoveSession,\r\n\t\tsetSelectedSessionId,\r\n\t\tsetStartSessionFailedCounter,\r\n\t\tsetRemoteSessions,\r\n\t\tsetPendingSession,\r\n\t\tsetIsRefreshingRemoteSessions,\r\n\t\tsendSessionEvent,\r\n\t\tcleanupSessionMachine,\r\n\t\tsessionOrder,\r\n\t])\r\n}\r\n",
    "import { atom } from \"jotai\"\r\nimport { atomFamily } from \"jotai/utils\"\r\n\r\n/**\r\n * Generate a random UUID using native crypto.randomUUID().\r\n * Available in all modern browsers and Node.js environments.\r\n */\r\nconst generateId = (): string => crypto.randomUUID()\r\n\r\nexport interface QueuedMessage {\r\n\tid: string\r\n\tsessionId: string\r\n\tcontent: string\r\n\tstatus: \"queued\" | \"sending\" | \"sent\" | \"failed\"\r\n\ttimestamp: number\r\n\terror?: string\r\n\tretryCount: number\r\n\tmaxRetries: number\r\n}\r\n\r\n// Per-session message queue\r\nexport const sessionMessageQueueAtomFamily = atomFamily((_sessionId: string) => atom<QueuedMessage[]>([]))\r\n\r\n// Track currently sending message ID per session\r\nexport const sessionSendingMessageIdAtomFamily = atomFamily((_sessionId: string) => atom<string | null>(null))\r\n\r\n// Derived: is session queue empty?\r\nexport const isSessionQueueEmptyAtomFamily = atomFamily((sessionId: string) =>\r\n\tatom((get) => {\r\n\t\tconst queue = get(sessionMessageQueueAtomFamily(sessionId))\r\n\t\treturn queue.length === 0\r\n\t}),\r\n)\r\n\r\n// Derived: get next queued message (first one with \"queued\" status)\r\nexport const nextQueuedMessageAtomFamily = atomFamily((sessionId: string) =>\r\n\tatom((get) => {\r\n\t\tconst queue = get(sessionMessageQueueAtomFamily(sessionId))\r\n\t\treturn queue.find((msg) => msg.status === \"queued\") || null\r\n\t}),\r\n)\r\n\r\n// Action: Add message to queue\r\nexport const addToQueueAtom = atom(null, (get, set, payload: { sessionId: string; content: string }) => {\r\n\tconst { sessionId, content } = payload\r\n\tconst queue = get(sessionMessageQueueAtomFamily(sessionId))\r\n\r\n\tconst newMessage: QueuedMessage = {\r\n\t\tid: generateId(),\r\n\t\tsessionId,\r\n\t\tcontent,\r\n\t\tstatus: \"queued\",\r\n\t\ttimestamp: Date.now(),\r\n\t\tretryCount: 0,\r\n\t\tmaxRetries: 3,\r\n\t}\r\n\r\n\tset(sessionMessageQueueAtomFamily(sessionId), [...queue, newMessage])\r\n\treturn newMessage\r\n})\r\n\r\n// Action: Update message status\r\nexport const updateMessageStatusAtom = atom(\r\n\tnull,\r\n\t(\r\n\t\tget,\r\n\t\tset,\r\n\t\tpayload: {\r\n\t\t\tsessionId: string\r\n\t\t\tmessageId: string\r\n\t\t\tstatus: \"queued\" | \"sending\" | \"sent\" | \"failed\"\r\n\t\t\terror?: string\r\n\t\t},\r\n\t) => {\r\n\t\tconst { sessionId, messageId, status, error } = payload\r\n\t\tconst queue = get(sessionMessageQueueAtomFamily(sessionId))\r\n\r\n\t\tconst updated = queue.map((msg) =>\r\n\t\t\tmsg.id === messageId\r\n\t\t\t\t? {\r\n\t\t\t\t\t\t...msg,\r\n\t\t\t\t\t\tstatus,\r\n\t\t\t\t\t\terror: error || undefined,\r\n\t\t\t\t\t}\r\n\t\t\t\t: msg,\r\n\t\t)\r\n\r\n\t\tset(sessionMessageQueueAtomFamily(sessionId), updated)\r\n\t},\r\n)\r\n\r\n// Action: Remove message from queue\r\nexport const removeFromQueueAtom = atom(null, (get, set, payload: { sessionId: string; messageId: string }) => {\r\n\tconst { sessionId, messageId } = payload\r\n\tconst queue = get(sessionMessageQueueAtomFamily(sessionId))\r\n\r\n\tconst filtered = queue.filter((msg) => msg.id !== messageId)\r\n\tset(sessionMessageQueueAtomFamily(sessionId), filtered)\r\n})\r\n\r\n// Action: Retry a failed message\r\nexport const retryFailedMessageAtom = atom(null, (get, set, payload: { sessionId: string; messageId: string }) => {\r\n\tconst { sessionId, messageId } = payload\r\n\tconst queue = get(sessionMessageQueueAtomFamily(sessionId))\r\n\r\n\tconst updated = queue.map((msg) => {\r\n\t\tif (msg.id === messageId && msg.status === \"failed\") {\r\n\t\t\t// Only retry if haven't exceeded max retries\r\n\t\t\tif (msg.retryCount < msg.maxRetries) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...msg,\r\n\t\t\t\t\tstatus: \"queued\" as const,\r\n\t\t\t\t\terror: undefined,\r\n\t\t\t\t\tretryCount: msg.retryCount + 1,\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn msg\r\n\t})\r\n\r\n\tset(sessionMessageQueueAtomFamily(sessionId), updated)\r\n})\r\n\r\n// Action: Clear queue for session\r\nexport const clearSessionQueueAtom = atom(null, (_get, set, sessionId: string) => {\r\n\tset(sessionMessageQueueAtomFamily(sessionId), [])\r\n\tset(sessionSendingMessageIdAtomFamily(sessionId), null)\r\n})\r\n\r\n// Action: Set currently sending message\r\nexport const setSendingMessageAtom = atom(\r\n\tnull,\r\n\t(_get, set, payload: { sessionId: string; messageId: string | null }) => {\r\n\t\tconst { sessionId, messageId } = payload\r\n\t\tset(sessionSendingMessageIdAtomFamily(sessionId), messageId)\r\n\t},\r\n)\r\n",
    "/**\r\n * VS Code webview API wrapper for Agent Manager\r\n */\r\n\r\ninterface VSCodeApi {\r\n\tpostMessage: (message: unknown) => void\r\n\tgetState: () => unknown\r\n\tsetState: (state: unknown) => void\r\n}\r\n\r\n// Declare the VS Code API acquisition function\r\ndeclare function acquireVsCodeApi(): VSCodeApi\r\n\r\n// Cache the API instance\r\nlet vsCodeApi: VSCodeApi | undefined\r\n\r\nexport function getVSCodeApi(): VSCodeApi {\r\n\tif (!vsCodeApi) {\r\n\t\tvsCodeApi = acquireVsCodeApi()\r\n\t}\r\n\treturn vsCodeApi\r\n}\r\n\r\nexport const vscode = {\r\n\tpostMessage: (message: unknown) => getVSCodeApi().postMessage(message),\r\n\tgetState: () => getVSCodeApi().getState(),\r\n\tsetState: (state: unknown) => getVSCodeApi().setState(state),\r\n}\r\n",
    "import { useEffect, useCallback } from \"react\"\r\nimport { useAtomValue, useSetAtom } from \"jotai\"\r\nimport {\r\n\tsessionMessageQueueAtomFamily,\r\n\tsessionSendingMessageIdAtomFamily,\r\n\tupdateMessageStatusAtom,\r\n\tremoveFromQueueAtom,\r\n\tsetSendingMessageAtom,\r\n} from \"../atoms/messageQueue\"\r\nimport { vscode } from \"../../utils/vscode\"\r\n\r\n/**\r\n * Hook that processes the message queue for a session.\r\n * Listens for message status updates from the extension and:\r\n * - Updates queue item status\r\n * - Removes sent messages from queue\r\n * - Sends next queued message when current one completes\r\n *\r\n * @param sessionId - The current session ID (can be null)\r\n */\r\nexport function useMessageQueueProcessor(sessionId: string | null) {\r\n\tconst queue = useAtomValue(sessionMessageQueueAtomFamily(sessionId || \"\"))\r\n\tconst sendingMessageId = useAtomValue(sessionSendingMessageIdAtomFamily(sessionId || \"\"))\r\n\tconst updateStatus = useSetAtom(updateMessageStatusAtom)\r\n\tconst removeFromQueue = useSetAtom(removeFromQueueAtom)\r\n\tconst setSendingMessage = useSetAtom(setSendingMessageAtom)\r\n\r\n\t// Send the next queued message\r\n\tconst sendNextMessage = useCallback(\r\n\t\t(messageId: string, content: string) => {\r\n\t\t\tif (!sessionId) return\r\n\r\n\t\t\tsetSendingMessage({ sessionId, messageId })\r\n\t\t\tvscode.postMessage({\r\n\t\t\t\ttype: \"agentManager.messageQueued\",\r\n\t\t\t\tsessionId,\r\n\t\t\t\tmessageId,\r\n\t\t\t\tcontent,\r\n\t\t\t})\r\n\t\t},\r\n\t\t[sessionId, setSendingMessage],\r\n\t)\r\n\r\n\t// Listen for message status updates from the extension\r\n\tuseEffect(() => {\r\n\t\tif (!sessionId) return\r\n\r\n\t\tconst handleMessage = (event: MessageEvent) => {\r\n\t\t\tif (event.data.type !== \"agentManager.messageStatus\") return\r\n\r\n\t\t\tconst { sessionId: eventSessionId, messageId, status, error } = event.data\r\n\r\n\t\t\tif (eventSessionId !== sessionId) return\r\n\r\n\t\t\tif (status === \"sending\" || status === \"failed\") {\r\n\t\t\t\tupdateStatus({ sessionId, messageId, status, error })\r\n\t\t\t}\r\n\r\n\t\t\tif (status === \"sent\") {\r\n\t\t\t\tremoveFromQueue({ sessionId, messageId })\r\n\t\t\t\tsetSendingMessage({ sessionId, messageId: null })\r\n\t\t\t\t// Next message is picked up by the auto-process effect when sendingMessageId becomes null\r\n\t\t\t}\r\n\r\n\t\t\tif (status === \"failed\") {\r\n\t\t\t\tsetSendingMessage({ sessionId, messageId: null })\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\twindow.addEventListener(\"message\", handleMessage)\r\n\t\treturn () => window.removeEventListener(\"message\", handleMessage)\r\n\t}, [sessionId, updateStatus, removeFromQueue, setSendingMessage])\r\n\r\n\t// Auto-process queue when it changes and nothing is currently sending\r\n\tuseEffect(() => {\r\n\t\tif (!sessionId) return\r\n\t\tif (sendingMessageId) return\r\n\r\n\t\tconst queuedMsg = queue.find((msg) => msg.status === \"queued\")\r\n\t\tif (queuedMsg) {\r\n\t\t\tsendNextMessage(queuedMsg.id, queuedMsg.content)\r\n\t\t}\r\n\t}, [sessionId, queue, sendingMessageId, sendNextMessage])\r\n}\r\n",
    "export interface RelativeTimeLabels {\r\n\tjustNow: string\r\n\tminuteAgo: string\r\n\tminutesAgo: (count: number) => string\r\n\thourAgo: string\r\n\thoursAgo: (count: number) => string\r\n\tdayAgo: string\r\n\tdaysAgo: (count: number) => string\r\n\tweekAgo: string\r\n\tweeksAgo: (count: number) => string\r\n}\r\n\r\n/**\r\n * Formats a timestamp as a human-readable relative time string\r\n * @param timestamp - Unix timestamp in milliseconds\r\n * @param labels - Localized labels for time units\r\n * @returns Formatted relative time string, or empty string if timestamp is invalid\r\n */\r\nexport function formatRelativeTime(timestamp: number, labels: RelativeTimeLabels): string {\r\n\tif (!timestamp || isNaN(timestamp)) {\r\n\t\treturn \"\"\r\n\t}\r\n\r\n\tconst now = Date.now()\r\n\tconst diff = now - timestamp\r\n\tconst seconds = Math.floor(diff / 1000)\r\n\tconst minutes = Math.floor(seconds / 60)\r\n\tconst hours = Math.floor(minutes / 60)\r\n\tconst days = Math.floor(hours / 24)\r\n\r\n\tif (days > 7) {\r\n\t\tconst weeks = Math.floor(days / 7)\r\n\t\treturn weeks === 1 ? labels.weekAgo : labels.weeksAgo(weeks)\r\n\t}\r\n\tif (days > 0) {\r\n\t\treturn days === 1 ? labels.dayAgo : labels.daysAgo(days)\r\n\t}\r\n\tif (hours > 0) {\r\n\t\treturn hours === 1 ? labels.hourAgo : labels.hoursAgo(hours)\r\n\t}\r\n\tif (minutes > 0) {\r\n\t\treturn minutes === 1 ? labels.minuteAgo : labels.minutesAgo(minutes)\r\n\t}\r\n\treturn labels.justNow\r\n}\r\n\r\n/**\r\n * Creates RelativeTimeLabels from an i18next translation function\r\n */\r\nexport function createRelativeTimeLabels(t: (key: string, options?: { count: number }) => string): RelativeTimeLabels {\r\n\treturn {\r\n\t\tjustNow: t(\"time.justNow\"),\r\n\t\tminuteAgo: t(\"time.minuteAgo\"),\r\n\t\tminutesAgo: (count: number) => t(\"time.minutesAgo\", { count }),\r\n\t\thourAgo: t(\"time.hourAgo\"),\r\n\t\thoursAgo: (count: number) => t(\"time.hoursAgo\", { count }),\r\n\t\tdayAgo: t(\"time.dayAgo\"),\r\n\t\tdaysAgo: (count: number) => t(\"time.daysAgo\", { count }),\r\n\t\tweekAgo: t(\"time.weekAgo\"),\r\n\t\tweeksAgo: (count: number) => t(\"time.weeksAgo\", { count }),\r\n\t}\r\n}\r\n",
    "import React, { useMemo, useState } from \"react\"\r\nimport { useAtom, useAtomValue, useSetAtom } from \"jotai\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport {\r\n\tmergedSessionsAtom,\r\n\tselectedSessionIdAtom,\r\n\tisRefreshingRemoteSessionsAtom,\r\n\tpendingSessionAtom,\r\n\ttype AgentSession,\r\n} from \"../state/atoms/sessions\"\r\nimport { sessionMachineUiStateAtom } from \"../state/atoms/stateMachine\"\r\nimport { vscode } from \"../utils/vscode\"\r\nimport { formatRelativeTime, createRelativeTimeLabels } from \"../utils/timeUtils\"\r\nimport { Plus, Loader2, RefreshCw, GitBranch, Folder, Share2 } from \"lucide-react\"\r\n\r\nexport function SessionSidebar() {\r\n\tconst { t } = useTranslation(\"agentManager\")\r\n\tconst sessions = useAtomValue(mergedSessionsAtom)\r\n\tconst pendingSession = useAtomValue(pendingSessionAtom)\r\n\tconst [selectedId, setSelectedId] = useAtom(selectedSessionIdAtom)\r\n\tconst isRefreshing = useAtomValue(isRefreshingRemoteSessionsAtom)\r\n\tconst setIsRefreshing = useSetAtom(isRefreshingRemoteSessionsAtom)\r\n\tconst machineUiState = useAtomValue(sessionMachineUiStateAtom)\r\n\r\n\tconst handleNewSession = () => {\r\n\t\tsetSelectedId(null)\r\n\t}\r\n\r\n\tconst handleSelectSession = (id: string) => {\r\n\t\tsetSelectedId(id)\r\n\t\tvscode.postMessage({ type: \"agentManager.selectSession\", sessionId: id })\r\n\t}\r\n\r\n\tconst handleRefresh = () => {\r\n\t\tif (isRefreshing) return // Prevent multiple clicks while loading\r\n\t\tsetIsRefreshing(true)\r\n\t\tvscode.postMessage({ type: \"agentManager.refreshRemoteSessions\" })\r\n\t}\r\n\r\n\tconst isNewAgentSelected = selectedId === null && !pendingSession\r\n\r\n\treturn (\r\n\t\t<div className=\"am-sidebar\">\r\n\t\t\t<div className=\"am-sidebar-header\">\r\n\t\t\t\t<span>{t(\"sidebar.title\")}</span>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div\r\n\t\t\t\tclassName={`am-new-agent-item ${isNewAgentSelected ? \"am-selected\" : \"\"}`}\r\n\t\t\t\tonClick={handleNewSession}\r\n\t\t\t\trole=\"button\"\r\n\t\t\t\ttabIndex={0}\r\n\t\t\t\tonKeyDown={(e) => e.key === \"Enter\" && handleNewSession()}>\r\n\t\t\t\t<Plus size={16} />\r\n\t\t\t\t<span>{t(\"sidebar.newAgent\")}</span>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"am-sidebar-section-header\">\r\n\t\t\t\t<span>{t(\"sidebar.sessionsSection\")}</span>\r\n\t\t\t\t<button\r\n\t\t\t\t\tclassName=\"am-icon-btn\"\r\n\t\t\t\t\tonClick={handleRefresh}\r\n\t\t\t\t\tdisabled={isRefreshing}\r\n\t\t\t\t\ttitle={t(\"sidebar.refresh\")}>\r\n\t\t\t\t\t{isRefreshing ? <Loader2 size={14} className=\"am-spinning\" /> : <RefreshCw size={14} />}\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"am-session-list\">\r\n\t\t\t\t{/* Show pending session at the top */}\r\n\t\t\t\t{pendingSession && (\r\n\t\t\t\t\t<PendingSessionItem\r\n\t\t\t\t\t\tpendingSession={pendingSession}\r\n\t\t\t\t\t\tisSelected={selectedId === null}\r\n\t\t\t\t\t\tonSelect={() => setSelectedId(null)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t{sessions.length === 0 && !pendingSession ? (\r\n\t\t\t\t\t<div className=\"am-no-sessions\">\r\n\t\t\t\t\t\t<p>{t(\"sidebar.emptyState\")}</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t) : (\r\n\t\t\t\t\tsessions.map((session) => (\r\n\t\t\t\t\t\t<SessionItem\r\n\t\t\t\t\t\t\tkey={session.sessionId}\r\n\t\t\t\t\t\t\tsession={session}\r\n\t\t\t\t\t\t\tisSelected={selectedId === session.sessionId}\r\n\t\t\t\t\t\t\tuiState={machineUiState[session.sessionId]}\r\n\t\t\t\t\t\t\tonSelect={() => handleSelectSession(session.sessionId)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t))\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nfunction PendingSessionItem({\r\n\tpendingSession,\r\n\tisSelected,\r\n\tonSelect,\r\n}: {\r\n\tpendingSession: { label: string; startTime: number }\r\n\tisSelected: boolean\r\n\tonSelect: () => void\r\n}) {\r\n\tconst { t } = useTranslation(\"agentManager\")\r\n\r\n\treturn (\r\n\t\t<div className={`am-session-item pending ${isSelected ? \"am-selected\" : \"\"}`} onClick={onSelect}>\r\n\t\t\t<div className=\"am-status-icon creating\" title={t(\"status.creating\")}>\r\n\t\t\t\t<Loader2 size={14} className=\"am-spinning\" />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"am-session-content\">\r\n\t\t\t\t<div className=\"am-session-label\">{pendingSession.label}</div>\r\n\t\t\t\t<div className=\"am-session-meta\">{t(\"status.creating\")}</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nfunction SessionItem({\r\n\tsession,\r\n\tisSelected,\r\n\tuiState,\r\n\tonSelect,\r\n}: {\r\n\tsession: AgentSession\r\n\tisSelected: boolean\r\n\tuiState: { showSpinner: boolean; isActive: boolean } | undefined\r\n\tonSelect: () => void\r\n}) {\r\n\tconst { t } = useTranslation(\"agentManager\")\r\n\tconst timeLabels = useMemo(() => createRelativeTimeLabels(t), [t])\r\n\tconst [showShareConfirm, setShowShareConfirm] = useState(false)\r\n\tconst [isHovered, setIsHovered] = useState(false)\r\n\r\n\tconst showSpinner = uiState?.showSpinner ?? false\r\n\tconst isActive = uiState?.isActive ?? false\r\n\tconst isWorktree = session.parallelMode?.enabled\r\n\tconst branchName = session.parallelMode?.branch\r\n\tconst isCompleted = session.status === \"done\"\r\n\r\n\tconst handleShareClick = (e: React.MouseEvent) => {\r\n\t\te.stopPropagation()\r\n\t\tsetShowShareConfirm(true)\r\n\t}\r\n\r\n\tconst handleShareConfirm = (e: React.MouseEvent) => {\r\n\t\te.stopPropagation()\r\n\t\tsetShowShareConfirm(false)\r\n\t\tsetIsHovered(false)\r\n\t\tvscode.postMessage({ type: \"agentManager.sessionShare\", sessionId: session.sessionId })\r\n\t}\r\n\r\n\tconst handleShareCancel = (e: React.MouseEvent) => {\r\n\t\te.stopPropagation()\r\n\t\tsetShowShareConfirm(false)\r\n\t\tsetIsHovered(false)\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`am-session-item ${isSelected ? \"am-selected\" : \"\"}`}\r\n\t\t\tonClick={onSelect}\r\n\t\t\tonMouseEnter={() => setIsHovered(true)}\r\n\t\t\tonMouseLeave={() => !showShareConfirm && setIsHovered(false)}>\r\n\t\t\t{session.status === \"creating\" && (\r\n\t\t\t\t<div className=\"am-status-icon creating\" title={t(\"status.creating\")}>\r\n\t\t\t\t\t<Loader2 size={14} className=\"am-spinning\" />\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t\t{showSpinner && (\r\n\t\t\t\t<div className=\"am-status-icon running\" title={t(\"status.running\")}>\r\n\t\t\t\t\t<Loader2 size={14} className=\"am-spinning\" />\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t\t<div className=\"am-session-content\">\r\n\t\t\t\t<div className=\"am-session-label\">{session.label}</div>\r\n\t\t\t\t<div className=\"am-session-meta\">\r\n\t\t\t\t\t{session.status === \"creating\" && isActive\r\n\t\t\t\t\t\t? t(\"status.creating\")\r\n\t\t\t\t\t\t: formatRelativeTime(session.startTime, timeLabels)}\r\n\t\t\t\t\t{isWorktree && (\r\n\t\t\t\t\t\t<span className=\"am-worktree-indicator\" title={branchName || t(\"sidebar.worktree\")}>\r\n\t\t\t\t\t\t\t<GitBranch size={10} />\r\n\t\t\t\t\t\t\t{branchName ? (\r\n\t\t\t\t\t\t\t\t<span className=\"am-branch-name\">\r\n\t\t\t\t\t\t\t\t\t{branchName.length > 20 ? branchName.slice(0, 20) + \"...\" : branchName}\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t<span>{t(\"sidebar.worktree\")}</span>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t{!isWorktree && (\r\n\t\t\t\t\t\t<span className=\"am-workspace-indicator\" title={t(\"sidebar.local\")}>\r\n\t\t\t\t\t\t\t<Folder size={10} />\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t\t{isWorktree && isCompleted && <div className=\"am-ready-to-merge\">{t(\"sidebar.readyToMerge\")}</div>}\r\n\t\t\t</div>\r\n\t\t\t{(isHovered || showShareConfirm) && (\r\n\t\t\t\t<button\r\n\t\t\t\t\tclassName=\"w-5 h-5 border-none bg-transparent rounded-[3px] cursor-pointer flex items-center justify-center -mt-0.5 hover:bg-vscode-toolbar-hoverBackground\"\r\n\t\t\t\t\tonClick={handleShareClick}\r\n\t\t\t\t\ttitle={t(\"sidebar.shareSession\")}\r\n\t\t\t\t\taria-label={t(\"sidebar.shareSession\")}>\r\n\t\t\t\t\t<Share2 size={14} />\r\n\t\t\t\t</button>\r\n\t\t\t)}\r\n\t\t\t{showShareConfirm && (\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"absolute top-full left-2 right-2 mt-1 p-3 bg-vscode-dropdown-background border border-vscode-dropdown-border rounded z-[100] shadow-[0_4px_12px_rgba(0,0,0,0.3)]\"\r\n\t\t\t\t\tonClick={(e) => e.stopPropagation()}>\r\n\t\t\t\t\t<div className=\"text-sm mb-2\">{t(\"sidebar.shareConfirmMessage\")}</div>\r\n\t\t\t\t\t<div className=\"flex gap-2\">\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclassName=\"px-3 py-1 rounded-sm text-xs cursor-pointer border border-transparent transition-colors duration-150 bg-vscode-button-background text-vscode-button-foreground hover:bg-vscode-button-hoverBackground\"\r\n\t\t\t\t\t\t\tonClick={handleShareConfirm}>\r\n\t\t\t\t\t\t\t{t(\"sidebar.shareConfirmYes\")}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclassName=\"px-3 py-1 rounded-sm text-xs cursor-pointer border border-transparent transition-colors duration-150 bg-vscode-button-secondaryBackground text-vscode-button-secondaryForeground hover:bg-vscode-button-secondaryHoverBackground\"\r\n\t\t\t\t\t\t\tonClick={handleShareCancel}>\r\n\t\t\t\t\t\t\t{t(\"sidebar.shareConfirmNo\")}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t)\r\n}\r\n",
    "import React from \"react\"\r\nimport ReactMarkdown from \"react-markdown\"\r\nimport remarkGfm from \"remark-gfm\"\r\n\r\ninterface SimpleMarkdownProps {\r\n\tcontent: string\r\n}\r\n\r\nexport const SimpleMarkdown: React.FC<SimpleMarkdownProps> = ({ content }) => {\r\n\treturn (\r\n\t\t<div className=\"am-markdown-content\">\r\n\t\t\t<ReactMarkdown remarkPlugins={[remarkGfm]}>{content}</ReactMarkdown>\r\n\t\t</div>\r\n\t)\r\n}\r\n",
    "import React from \"react\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { ClipboardCopy } from \"lucide-react\"\r\n\r\nimport { StandardTooltip } from \"../../../components/ui\"\r\nimport type { SuggestionItem } from \"@roo-code/types\"\r\n\r\ninterface FollowUpSuggestionsProps {\r\n\tsuggestions: SuggestionItem[]\r\n\tonSuggestionClick: (suggestion: SuggestionItem) => void\r\n\tonCopyToInput?: (suggestion: SuggestionItem) => void\r\n}\r\n\r\n/**\r\n * Displays clickable suggestion buttons for follow-up questions in the agent manager.\r\n * Simplified version of the main sidebar's FollowUpSuggest component without auto-approval features.\r\n */\r\nexport function FollowUpSuggestions({ suggestions, onSuggestionClick, onCopyToInput }: FollowUpSuggestionsProps) {\r\n\tconst { t } = useTranslation(\"agentManager\")\r\n\r\n\tif (!suggestions?.length) {\r\n\t\treturn null\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"am-followup-suggestions\">\r\n\t\t\t{suggestions.map((suggestion, index) => (\r\n\t\t\t\t<div key={`${suggestion.answer}-${index}`} className=\"am-followup-suggestion-wrapper\">\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\tonClick={() => onSuggestionClick(suggestion)}\r\n\t\t\t\t\t\tclassName=\"am-followup-suggestion-btn\"\r\n\t\t\t\t\t\taria-label={suggestion.answer}>\r\n\t\t\t\t\t\t{suggestion.answer}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t{onCopyToInput && (\r\n\t\t\t\t\t\t<StandardTooltip content={t(\"chat:followUpSuggest.copyToInput\")}>\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\tclassName=\"am-followup-copy-btn\"\r\n\t\t\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\t\t\te.stopPropagation()\r\n\t\t\t\t\t\t\t\t\tonCopyToInput(suggestion)\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\taria-label={t(\"chat:followUpSuggest.copyToInput\")}>\r\n\t\t\t\t\t\t\t\t<ClipboardCopy size={16} />\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</StandardTooltip>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t))}\r\n\t\t</div>\r\n\t)\r\n}\r\n",
    "import { memo, useState, useMemo } from \"react\"\r\nimport { ChevronDown, Copy, Check, Loader2 } from \"lucide-react\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { COMMAND_OUTPUT_STRING } from \"@roo/combineCommandSequences\"\r\nimport { cn } from \"../../../lib/utils\"\r\n\r\ntype CommandStatus = \"pending\" | \"running\" | \"success\" | \"error\"\r\n\r\ninterface CommandExecutionBlockProps {\r\n\ttext: string\r\n\tisRunning?: boolean\r\n\tisLast?: boolean\r\n\texitCode?: number\r\n\tterminalStatus?: string\r\n}\r\n\r\n/**\r\n * Parses the combined command+output text into separate parts.\r\n * The format is: \"command\\nOutput:\\noutput_text\"\r\n */\r\nfunction parseCommandAndOutput(text: string | undefined): { command: string; output: string } {\r\n\tif (!text) {\r\n\t\treturn { command: \"\", output: \"\" }\r\n\t}\r\n\r\n\tconst index = text.indexOf(COMMAND_OUTPUT_STRING)\r\n\r\n\tif (index === -1) {\r\n\t\treturn { command: text, output: \"\" }\r\n\t}\r\n\r\n\tlet output = text.slice(index + COMMAND_OUTPUT_STRING.length)\r\n\r\n\t// `combineCommandSequences` adds \"\\nOutput:\" before output; real output often starts with a newline.\r\n\toutput = output.replace(/^\\n/, \"\")\r\n\r\n\t// Clean up output - remove leading \"command_output\" lines that may appear from message parsing\r\n\tconst lines = output.split(\"\\n\")\r\n\tconst cleanedLines = lines.filter((line) => line.trim() !== \"command_output\")\r\n\toutput = cleanedLines.join(\"\\n\").replace(/\\n+$/, \"\")\r\n\r\n\treturn {\r\n\t\tcommand: text.slice(0, index).trim(),\r\n\t\toutput,\r\n\t}\r\n}\r\n\r\n/**\r\n * Strip terminal escape sequences and non-printable control characters.\r\n * This prevents \"blank\" outputs caused by ANSI control codes.\r\n */\r\nfunction sanitizeOutput(raw: string): string {\r\n\tif (!raw) return \"\"\r\n\r\n\t// OSC: ESC ] ... BEL  OR  ESC ] ... ESC \\\r\n\t// eslint-disable-next-line no-control-regex\r\n\tconst withoutOsc = raw.replace(/\\u001B\\][^\\u0007]*(?:\\u0007|\\u001B\\\\)/g, \"\")\r\n\t// CSI: ESC [ ... command\r\n\t// eslint-disable-next-line no-control-regex\r\n\tconst withoutCsi = withoutOsc.replace(/\\u001B\\[[0-?]*[ -/]*[@-~]/g, \"\")\r\n\t// Other stray ESC sequences\r\n\t// eslint-disable-next-line no-control-regex\r\n\tconst withoutEsc = withoutCsi.replace(/\\u001B./g, \"\")\r\n\r\n\t// Remove control chars except \\t, \\n, \\r\r\n\t// eslint-disable-next-line no-control-regex\r\n\treturn withoutEsc.replace(/[\\u0000-\\u0008\\u000B\\u000C\\u000E-\\u001F\\u007F]/g, \"\")\r\n}\r\n\r\nexport const CommandExecutionBlock = memo(\r\n\t({ text, isRunning = false, isLast = false, exitCode, terminalStatus }: CommandExecutionBlockProps) => {\r\n\t\tconst { t } = useTranslation(\"agentManager\")\r\n\t\tconst { command, output: rawOutput } = useMemo(() => parseCommandAndOutput(text), [text])\r\n\t\tconst [isExpanded, setIsExpanded] = useState(true)\r\n\t\tconst [copied, setCopied] = useState(false)\r\n\r\n\t\tconst output = useMemo(() => sanitizeOutput(rawOutput), [rawOutput])\r\n\t\tconst hasOutput = useMemo(() => /\\S/.test(output), [output])\r\n\t\tconst hasOutputMarker = useMemo(() => text.indexOf(COMMAND_OUTPUT_STRING) !== -1, [text])\r\n\t\tconst isCompleted = exitCode !== undefined || terminalStatus === \"timeout\" || terminalStatus === \"exited\"\r\n\r\n\t\t// Determine status - deterministic based on exit code\r\n\t\tconst status: CommandStatus = useMemo(() => {\r\n\t\t\t// Running: has output marker but no output yet, only for the most recent command\r\n\t\t\tif (!isCompleted && (isRunning || (hasOutputMarker && isLast)) && !hasOutput) {\r\n\t\t\t\treturn \"running\"\r\n\t\t\t}\r\n\t\t\t// Error: timeout or non-zero exit code\r\n\t\t\tif (terminalStatus === \"timeout\" || (exitCode !== undefined && exitCode !== 0)) {\r\n\t\t\t\treturn \"error\"\r\n\t\t\t}\r\n\t\t\t// Success: zero exit code, has output, or has output marker (executed but no visible output)\r\n\t\t\tif (exitCode === 0 || hasOutput || hasOutputMarker) {\r\n\t\t\t\treturn \"success\"\r\n\t\t\t}\r\n\t\t\t// Pending: waiting for approval/execution\r\n\t\t\treturn \"pending\"\r\n\t\t}, [isCompleted, isRunning, hasOutputMarker, isLast, hasOutput, terminalStatus, exitCode])\r\n\r\n\t\tconst isError = status === \"error\"\r\n\r\n\t\tconst handleCopy = async () => {\r\n\t\t\ttry {\r\n\t\t\t\tawait navigator.clipboard.writeText(command)\r\n\t\t\t\tsetCopied(true)\r\n\t\t\t\tsetTimeout(() => setCopied(false), 2000)\r\n\t\t\t} catch {\r\n\t\t\t\t// Clipboard API may fail in some contexts\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"bg-vscode-editor-background border border-vscode-panel-border rounded-sm font-mono text-sm\">\r\n\t\t\t\t{/* Header with status and command */}\r\n\t\t\t\t<div className=\"flex items-center justify-between gap-2 px-2 py-1.5\">\r\n\t\t\t\t\t<div className=\"flex items-center gap-2 min-w-0 flex-1\">\r\n\t\t\t\t\t\t<StatusIndicator status={status} />\r\n\t\t\t\t\t\t<pre className=\"overflow-x-auto whitespace-pre m-0 p-0 flex-1 min-w-0\">{command}</pre>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"flex items-center gap-1 flex-shrink-0\">\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tonClick={handleCopy}\r\n\t\t\t\t\t\t\tclassName=\"p-1 text-vscode-descriptionForeground hover:text-vscode-foreground transition-colors rounded hover:bg-vscode-toolbar-hoverBackground\"\r\n\t\t\t\t\t\t\ttitle={t(\"messages.copyCommand\")}>\r\n\t\t\t\t\t\t\t{copied ? <Check size={14} /> : <Copy size={14} />}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t{hasOutput && (\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={() => setIsExpanded(!isExpanded)}\r\n\t\t\t\t\t\t\t\tclassName=\"p-1 text-vscode-descriptionForeground hover:text-vscode-foreground transition-colors rounded hover:bg-vscode-toolbar-hoverBackground\"\r\n\t\t\t\t\t\t\t\ttitle={isExpanded ? t(\"messages.collapseOutput\") : t(\"messages.expandOutput\")}>\r\n\t\t\t\t\t\t\t\t<ChevronDown\r\n\t\t\t\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\t\t\t\"size-4 transition-transform duration-200\",\r\n\t\t\t\t\t\t\t\t\t\tisExpanded && \"rotate-180\",\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{/* Output */}\r\n\t\t\t\t{hasOutput && (\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\"overflow-hidden transition-all duration-200 border-t border-vscode-panel-border\",\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\"max-h-0 border-t-0\": !isExpanded,\r\n\t\t\t\t\t\t\t\t\"max-h-[500px] overflow-y-auto\": isExpanded,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t)}>\r\n\t\t\t\t\t\t<div className=\"p-2 bg-vscode-editor-background\">\r\n\t\t\t\t\t\t\t<pre\r\n\t\t\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\t\t\"overflow-x-auto whitespace-pre m-0 p-0 text-xs\",\r\n\t\t\t\t\t\t\t\t\tisError ? \"text-red-400\" : \"text-vscode-descriptionForeground\",\r\n\t\t\t\t\t\t\t\t)}>\r\n\t\t\t\t\t\t\t\t{output}\r\n\t\t\t\t\t\t\t</pre>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t)\r\n\t},\r\n)\r\n\r\nCommandExecutionBlock.displayName = \"CommandExecutionBlock\"\r\n\r\n/**\r\n * Status indicator dot/spinner\r\n */\r\nfunction StatusIndicator({ status }: { status: CommandStatus }) {\r\n\tswitch (status) {\r\n\t\tcase \"pending\":\r\n\t\t\treturn <div className=\"size-2 rounded-full bg-yellow-500/70 flex-shrink-0\" />\r\n\t\tcase \"running\":\r\n\t\t\treturn <Loader2 size={10} className=\"animate-spin text-blue-400 flex-shrink-0\" />\r\n\t\tcase \"success\":\r\n\t\t\treturn <div className=\"size-2 rounded-full bg-green-500 flex-shrink-0\" />\r\n\t\tcase \"error\":\r\n\t\t\treturn <div className=\"size-2 rounded-full bg-red-500 flex-shrink-0\" />\r\n\t}\r\n}\r\n",
    "import React, { useEffect, useRef, useCallback, useMemo } from \"react\"\r\nimport { useAtomValue, useSetAtom } from \"jotai\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { Virtuoso, VirtuosoHandle } from \"react-virtuoso\"\r\nimport { sessionMessagesAtomFamily } from \"../state/atoms/messages\"\r\nimport { sessionInputAtomFamily } from \"../state/atoms/sessions\"\r\nimport {\r\n\tsessionMessageQueueAtomFamily,\r\n\tsessionSendingMessageIdAtomFamily,\r\n\tremoveFromQueueAtom,\r\n\tretryFailedMessageAtom,\r\n} from \"../state/atoms/messageQueue\"\r\nimport type { QueuedMessage } from \"../state/atoms/messageQueue\"\r\nimport type { ClineMessage, SuggestionItem, FollowUpData } from \"@roo-code/types\"\r\nimport { safeJsonParse } from \"@roo/safeJsonParse\"\r\nimport { combineCommandSequences } from \"@roo/combineCommandSequences\"\r\nimport { SimpleMarkdown } from \"./SimpleMarkdown\"\r\nimport { FollowUpSuggestions } from \"./FollowUpSuggestions\"\r\nimport { CommandExecutionBlock } from \"./CommandExecutionBlock\"\r\nimport { vscode } from \"../utils/vscode\"\r\nimport {\r\n\tMessageCircle,\r\n\tMessageCircleQuestion,\r\n\tArrowRightLeft,\r\n\tTerminalSquare,\r\n\tCheckCircle2,\r\n\tAlertCircle,\r\n\tUser,\r\n\tClock,\r\n\tLoader,\r\n} from \"lucide-react\"\r\nimport { cn } from \"../../../lib/utils\"\r\n\r\ninterface MessageListProps {\r\n\tsessionId: string\r\n}\r\n\r\n// Parse exit code from various formats (number, string, etc.)\r\nfunction parseExitCode(raw: unknown): number | undefined {\r\n\tif (typeof raw === \"number\") return raw\r\n\tif (typeof raw === \"string\" && raw.trim() && !Number.isNaN(Number(raw))) return Number(raw)\r\n\treturn undefined\r\n}\r\n\r\n// Extract execution metadata from command output message\r\nfunction extractCommandMetadata(msg: ClineMessage): { exitCode?: number; status?: string; isRunning?: boolean } | null {\r\n\tconst metadata = msg.metadata as Record<string, unknown> | undefined\r\n\tif (!metadata) return null\r\n\r\n\treturn {\r\n\t\texitCode: parseExitCode(metadata.exitCode),\r\n\t\tstatus: typeof metadata.status === \"string\" ? metadata.status : undefined,\r\n\t\tisRunning: msg.partial ?? false,\r\n\t}\r\n}\r\n\r\n/**\r\n * Displays messages for a session from Jotai state.\r\n */\r\nexport function MessageList({ sessionId }: MessageListProps) {\r\n\tconst { t } = useTranslation(\"agentManager\")\r\n\tconst messages = useAtomValue(sessionMessagesAtomFamily(sessionId))\r\n\tconst queue = useAtomValue(sessionMessageQueueAtomFamily(sessionId))\r\n\tconst sendingMessageId = useAtomValue(sessionSendingMessageIdAtomFamily(sessionId))\r\n\tconst setInputValue = useSetAtom(sessionInputAtomFamily(sessionId))\r\n\tconst retryFailedMessage = useSetAtom(retryFailedMessageAtom)\r\n\tconst removeFromQueue = useSetAtom(removeFromQueueAtom)\r\n\tconst virtuosoRef = useRef<VirtuosoHandle>(null)\r\n\r\n\t// Combine command and command_output messages into single entries\r\n\tconst combinedMessages = useMemo(() => combineCommandSequences(messages), [messages])\r\n\r\n\tconst commandExecutionByTs = useMemo(() => {\r\n\t\tconst info = new Map<number, { exitCode?: number; status?: string; isRunning?: boolean }>()\r\n\r\n\t\tfor (let i = 0; i < messages.length; i++) {\r\n\t\t\tconst msg = messages[i]\r\n\t\t\tif (msg.type !== \"ask\" || msg.ask !== \"command\") continue\r\n\r\n\t\t\tlet data: ReturnType<typeof extractCommandMetadata> = null\r\n\r\n\t\t\t// Find output messages following this command\r\n\t\t\tfor (let j = i + 1; j < messages.length; j++) {\r\n\t\t\t\tconst next = messages[j]\r\n\t\t\t\tif (next.type === \"ask\" && next.ask === \"command\") break\r\n\t\t\t\tif (next.ask !== \"command_output\" && next.say !== \"command_output\") continue\r\n\r\n\t\t\t\tdata = extractCommandMetadata(next)\r\n\t\t\t}\r\n\r\n\t\t\tif (data) info.set(msg.ts, data)\r\n\t\t}\r\n\r\n\t\treturn info\r\n\t}, [messages])\r\n\r\n\t// Auto-scroll to bottom when new messages arrive using Virtuoso API\r\n\tuseEffect(() => {\r\n\t\tif (combinedMessages.length > 0) {\r\n\t\t\tvirtuosoRef.current?.scrollToIndex({\r\n\t\t\t\tindex: combinedMessages.length - 1,\r\n\t\t\t\tbehavior: \"smooth\",\r\n\t\t\t})\r\n\t\t}\r\n\t}, [combinedMessages.length])\r\n\r\n\tconst handleSuggestionClick = useCallback(\r\n\t\t(suggestion: SuggestionItem) => {\r\n\t\t\tvscode.postMessage({\r\n\t\t\t\ttype: \"agentManager.sendMessage\",\r\n\t\t\t\tsessionId,\r\n\t\t\t\tcontent: suggestion.answer,\r\n\t\t\t})\r\n\t\t},\r\n\t\t[sessionId],\r\n\t)\r\n\r\n\tconst handleCopyToInput = useCallback(\r\n\t\t(suggestion: SuggestionItem) => {\r\n\t\t\tsetInputValue((current) => (current !== \"\" ? `${current} \\n${suggestion.answer}` : suggestion.answer))\r\n\t\t},\r\n\t\t[setInputValue],\r\n\t)\r\n\r\n\tconst handleRetryMessage = useCallback(\r\n\t\t(sessionId: string, messageId: string) => {\r\n\t\t\tretryFailedMessage({ sessionId, messageId })\r\n\t\t},\r\n\t\t[retryFailedMessage],\r\n\t)\r\n\r\n\tconst handleDiscardMessage = useCallback(\r\n\t\t(sessionId: string, messageId: string) => {\r\n\t\t\tremoveFromQueue({ sessionId, messageId })\r\n\t\t},\r\n\t\t[removeFromQueue],\r\n\t)\r\n\r\n\t// Combine messages and queued messages for virtualization\r\n\tconst allItems = useMemo(() => {\r\n\t\treturn [...combinedMessages, ...queue.map((q) => ({ type: \"queued\" as const, data: q }))]\r\n\t}, [combinedMessages, queue])\r\n\r\n\t// Item content renderer for Virtuoso\r\n\tconst itemContent = useCallback(\r\n\t\t(index: number, item: ClineMessage | { type: \"queued\"; data: QueuedMessage }) => {\r\n\t\t\t// Check if this is a queued message\r\n\t\t\tif (\"type\" in item && item.type === \"queued\") {\r\n\t\t\t\tconst queuedMsg = item.data\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<QueuedMessageItem\r\n\t\t\t\t\t\tkey={`queued-${queuedMsg.id}`}\r\n\t\t\t\t\t\tqueuedMessage={queuedMsg}\r\n\t\t\t\t\t\tisSending={sendingMessageId === queuedMsg.id}\r\n\t\t\t\t\t\tonRetry={handleRetryMessage}\r\n\t\t\t\t\t\tonDiscard={handleDiscardMessage}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)\r\n\t\t\t}\r\n\r\n\t\t\t// Regular message\r\n\t\t\tconst msg = item as ClineMessage\r\n\t\t\t// isLastCombinedMessage: true for the last regular message, excluding queued user messages\r\n\t\t\tconst isLastCombinedMessage = index === combinedMessages.length - 1\r\n\t\t\treturn (\r\n\t\t\t\t<MessageItem\r\n\t\t\t\t\tkey={msg.ts || index}\r\n\t\t\t\t\tmessage={msg}\r\n\t\t\t\t\tisLast={isLastCombinedMessage}\r\n\t\t\t\t\tcommandExecutionByTs={commandExecutionByTs}\r\n\t\t\t\t\tonSuggestionClick={handleSuggestionClick}\r\n\t\t\t\t\tonCopyToInput={handleCopyToInput}\r\n\t\t\t\t/>\r\n\t\t\t)\r\n\t\t},\r\n\t\t[\r\n\t\t\tcombinedMessages.length,\r\n\t\t\tcommandExecutionByTs,\r\n\t\t\thandleSuggestionClick,\r\n\t\t\thandleCopyToInput,\r\n\t\t\tsendingMessageId,\r\n\t\t\thandleRetryMessage,\r\n\t\t\thandleDiscardMessage,\r\n\t\t],\r\n\t)\r\n\r\n\tif (messages.length === 0 && queue.length === 0) {\r\n\t\treturn (\r\n\t\t\t<div className=\"am-messages-empty\">\r\n\t\t\t\t<MessageCircle className=\"w-12 h-12 mx-auto mb-4 opacity-20\" />\r\n\t\t\t\t<p>{t(\"messages.waiting\")}</p>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"am-messages-container\">\r\n\t\t\t<Virtuoso\r\n\t\t\t\tref={virtuosoRef}\r\n\t\t\t\tdata={allItems}\r\n\t\t\t\titemContent={itemContent}\r\n\t\t\t\tfollowOutput=\"smooth\"\r\n\t\t\t\tincreaseViewportBy={{ top: 400, bottom: 400 }}\r\n\t\t\t\tclassName=\"am-messages-list\"\r\n\t\t\t/>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\ninterface FollowUpMetadata {\r\n\tquestion?: string\r\n\tsuggest?: SuggestionItem[]\r\n}\r\n\r\nfunction extractFollowUpData(message: ClineMessage): { question: string; suggestions?: SuggestionItem[] } | null {\r\n\tconst messageText = message.text || (message as { content?: string }).content || \"\"\r\n\tconst metadata = (message.metadata as FollowUpMetadata | undefined) ?? {}\r\n\tconst parsedData = safeJsonParse<FollowUpData>(messageText)\r\n\r\n\tconst question = metadata.question || parsedData?.question || messageText\r\n\tconst suggestions = metadata.suggest || parsedData?.suggest\r\n\r\n\tif (!question) return null\r\n\treturn { question, suggestions }\r\n}\r\n\r\ninterface MessageItemProps {\r\n\tmessage: ClineMessage\r\n\tisLast: boolean\r\n\tcommandExecutionByTs: Map<number, { exitCode?: number; status?: string; isRunning?: boolean }>\r\n\tonSuggestionClick?: (suggestion: SuggestionItem) => void\r\n\tonCopyToInput?: (suggestion: SuggestionItem) => void\r\n}\r\n\r\nfunction MessageItem({ message, isLast, commandExecutionByTs, onSuggestionClick, onCopyToInput }: MessageItemProps) {\r\n\tconst { t } = useTranslation(\"agentManager\")\r\n\r\n\t// --- 1. Determine Message Style & Content ---\r\n\t// Note: CLI JSON output uses \"content\" instead of \"text\" for message body\r\n\tconst messageText = message.text || (message as any).content || \"\"\r\n\r\n\tlet icon = <MessageCircle size={16} />\r\n\tlet title = t(\"messages.kiloSaid\")\r\n\tlet content: React.ReactNode = null\r\n\tlet extraInfo: React.ReactNode = null\r\n\tlet suggestions: SuggestionItem[] | undefined\r\n\r\n\t// --- SAY ---\r\n\tif (message.type === \"say\") {\r\n\t\tswitch (message.say) {\r\n\t\t\tcase \"api_req_started\": {\r\n\t\t\t\ticon = <ArrowRightLeft size={16} className=\"opacity-70\" />\r\n\t\t\t\ttitle = t(\"messages.apiRequest\")\r\n\t\t\t\tconst info = safeJsonParse<{ cost?: number }>(messageText)\r\n\t\t\t\tif (info?.cost !== undefined) {\r\n\t\t\t\t\textraInfo = <span className=\"am-message-cost\">${info.cost.toFixed(4)}</span>\r\n\t\t\t\t}\r\n\t\t\t\t// Don't show content for API req started, just header\r\n\t\t\t\tcontent = null\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tcase \"text\": {\r\n\t\t\t\ticon = <MessageCircle size={16} />\r\n\t\t\t\ttitle = t(\"messages.kiloSaid\")\r\n\t\t\t\tcontent = <SimpleMarkdown content={messageText} />\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tcase \"user_feedback\": {\r\n\t\t\t\ticon = <User size={16} />\r\n\t\t\t\ttitle = t(\"messages.youSaid\")\r\n\t\t\t\tcontent = <SimpleMarkdown content={messageText} />\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tcase \"completion_result\": {\r\n\t\t\t\ticon = <CheckCircle2 size={16} className=\"text-green-500\" />\r\n\t\t\t\ttitle = t(\"messages.taskCompleted\")\r\n\t\t\t\tcontent = <SimpleMarkdown content={messageText} />\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tcase \"error\": {\r\n\t\t\t\ticon = <AlertCircle size={16} className=\"text-red-500\" />\r\n\t\t\t\ttitle = t(\"messages.error\")\r\n\t\t\t\tcontent = <SimpleMarkdown content={messageText} />\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tcase \"api_req_finished\":\r\n\t\t\tcase \"checkpoint_saved\":\r\n\t\t\tcase \"command_output\":\r\n\t\t\t\treturn null // Skip internal messages (command_output is combined with command)\r\n\t\t\tdefault:\r\n\t\t\t\tcontent = <SimpleMarkdown content={messageText} />\r\n\t\t}\r\n\t}\r\n\r\n\t// --- ASK ---\r\n\tif (message.type === \"ask\") {\r\n\t\tswitch (message.ask) {\r\n\t\t\tcase \"followup\": {\r\n\t\t\t\ticon = <MessageCircleQuestion size={16} />\r\n\t\t\t\ttitle = t(\"messages.question\")\r\n\t\t\t\tconst followUpData = extractFollowUpData(message)\r\n\t\t\t\tsuggestions = followUpData?.suggestions\r\n\t\t\t\tcontent = (\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<SimpleMarkdown content={followUpData?.question || messageText} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tcase \"command\": {\r\n\t\t\t\ticon = <TerminalSquare size={16} />\r\n\t\t\t\ttitle = t(\"messages.command\")\r\n\t\t\t\tconst execInfo = commandExecutionByTs.get(message.ts)\r\n\t\t\t\tcontent = (\r\n\t\t\t\t\t<CommandExecutionBlock\r\n\t\t\t\t\t\ttext={messageText}\r\n\t\t\t\t\t\tisRunning={execInfo?.isRunning ?? message.partial}\r\n\t\t\t\t\t\tisLast={isLast}\r\n\t\t\t\t\t\texitCode={execInfo?.exitCode}\r\n\t\t\t\t\t\tterminalStatus={execInfo?.status}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tcase \"command_output\": {\r\n\t\t\t\t// Skip standalone command_output - combined with command message\r\n\t\t\t\treturn null\r\n\t\t\t}\r\n\t\t\tcase \"tool\": {\r\n\t\t\t\t// Tool info can be in metadata (from CLI) or parsed from text\r\n\t\t\t\tconst metadata = message.metadata as { tool?: string; path?: string; todos?: unknown[] } | undefined\r\n\t\t\t\tconst toolInfo = metadata?.tool ? metadata : safeJsonParse<{ tool: string; path?: string }>(messageText)\r\n\t\t\t\t// Skip updateTodoList - it's displayed in the header via TodoListDisplay\r\n\t\t\t\tif (toolInfo?.tool === \"updateTodoList\") {\r\n\t\t\t\t\treturn null\r\n\t\t\t\t}\r\n\t\t\t\ticon = <TerminalSquare size={16} />\r\n\t\t\t\ttitle = t(\"messages.tool\")\r\n\t\t\t\t// Try to parse tool use for better display\r\n\t\t\t\tif (toolInfo) {\r\n\t\t\t\t\tconst toolDetails = toolInfo.path ? `(${toolInfo.path})` : \"\"\r\n\t\t\t\t\tcontent = (\r\n\t\t\t\t\t\t<SimpleMarkdown\r\n\t\t\t\t\t\t\tcontent={t(\"messages.usingTool\", { tool: toolInfo.tool, details: toolDetails })}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontent = <SimpleMarkdown content={messageText} />\r\n\t\t\t\t}\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tdefault:\r\n\t\t\t\tcontent = <SimpleMarkdown content={messageText} />\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`am-message-item ${message.type === \"say\" && message.say === \"api_req_started\" ? \"am-api-req\" : \"\"}`}>\r\n\t\t\t<div className=\"am-message-icon\">{icon}</div>\r\n\t\t\t<div className=\"am-message-content-wrapper\">\r\n\t\t\t\t<div className=\"am-message-header\">\r\n\t\t\t\t\t<span className=\"am-message-author\">{title}</span>\r\n\t\t\t\t\t<span className=\"am-message-ts\">{new Date(message.ts).toLocaleTimeString()}</span>\r\n\t\t\t\t\t{extraInfo}\r\n\t\t\t\t</div>\r\n\t\t\t\t{content && <div className=\"am-message-body\">{content}</div>}\r\n\t\t\t\t{suggestions && suggestions.length > 0 && onSuggestionClick && (\r\n\t\t\t\t\t<FollowUpSuggestions\r\n\t\t\t\t\t\tsuggestions={suggestions}\r\n\t\t\t\t\t\tonSuggestionClick={onSuggestionClick}\r\n\t\t\t\t\t\tonCopyToInput={onCopyToInput}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\ninterface QueuedMessageItemProps {\r\n\tqueuedMessage: QueuedMessage\r\n\tisSending: boolean\r\n\tonRetry: (sessionId: string, messageId: string) => void\r\n\tonDiscard: (sessionId: string, messageId: string) => void\r\n}\r\n\r\nfunction QueuedMessageItem({ queuedMessage, isSending: _isSending, onRetry, onDiscard }: QueuedMessageItemProps) {\r\n\tconst { t } = useTranslation(\"agentManager\")\r\n\r\n\tlet icon = <Clock size={16} className=\"opacity-70\" />\r\n\tlet statusText = t(\"chatInput.messageSending\")\r\n\tlet statusColor = \"text-vscode-descriptionForeground\"\r\n\r\n\tif (queuedMessage.status === \"sending\") {\r\n\t\ticon = <Loader size={16} className=\"animate-spin opacity-70\" />\r\n\t\tstatusText = t(\"chatInput.messageSending\")\r\n\t\tstatusColor = \"text-vscode-descriptionForeground\"\r\n\t} else if (queuedMessage.status === \"failed\") {\r\n\t\ticon = <AlertCircle size={16} className=\"text-vscode-errorForeground\" />\r\n\t\tstatusText = queuedMessage.error || \"Failed to send message\"\r\n\t\tstatusColor = \"text-vscode-errorForeground\"\r\n\t} else {\r\n\t\ticon = <Clock size={16} className=\"opacity-70\" />\r\n\t\tstatusText = t(\"chatInput.messageSending\")\r\n\t\tstatusColor = \"text-vscode-descriptionForeground\"\r\n\t}\r\n\r\n\tconst handleRetry = () => {\r\n\t\tonRetry(queuedMessage.sessionId, queuedMessage.id)\r\n\t}\r\n\r\n\tconst handleDiscard = () => {\r\n\t\tonDiscard(queuedMessage.sessionId, queuedMessage.id)\r\n\t}\r\n\r\n\tconst canRetry = queuedMessage.retryCount < queuedMessage.maxRetries\r\n\r\n\treturn (\r\n\t\t<div className={cn(\"am-message-item\", queuedMessage.status === \"failed\" && \"opacity-75\")}>\r\n\t\t\t<div className=\"am-message-icon\">{icon}</div>\r\n\t\t\t<div className=\"am-message-content-wrapper\">\r\n\t\t\t\t<div className=\"am-message-header\">\r\n\t\t\t\t\t<span className=\"am-message-author text-vscode-descriptionForeground\">{t(\"messages.youSaid\")}</span>\r\n\t\t\t\t\t<span className={cn(\"am-message-ts text-xs\", statusColor)}>{statusText}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"am-message-body\">\r\n\t\t\t\t\t<SimpleMarkdown content={queuedMessage.content} />\r\n\t\t\t\t</div>\r\n\t\t\t\t{queuedMessage.status === \"failed\" && (\r\n\t\t\t\t\t<div className=\"mt-2 space-y-2\">\r\n\t\t\t\t\t\t{queuedMessage.error && (\r\n\t\t\t\t\t\t\t<p className=\"text-xs text-vscode-errorForeground\">Error: {queuedMessage.error}</p>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t{queuedMessage.retryCount > 0 && (\r\n\t\t\t\t\t\t\t<p className=\"text-xs text-vscode-descriptionForeground\">\r\n\t\t\t\t\t\t\t\tRetry attempt {queuedMessage.retryCount} of {queuedMessage.maxRetries}\r\n\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t<div className=\"flex gap-2\">\r\n\t\t\t\t\t\t\t{canRetry && (\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\tonClick={handleRetry}\r\n\t\t\t\t\t\t\t\t\tclassName=\"text-xs px-2 py-1 rounded bg-vscode-button-background hover:bg-vscode-button-hoverBackground text-vscode-button-foreground\">\r\n\t\t\t\t\t\t\t\t\tRetry\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={handleDiscard}\r\n\t\t\t\t\t\t\t\tclassName=\"text-xs px-2 py-1 rounded bg-vscode-errorBackground hover:opacity-80 text-vscode-errorForeground\">\r\n\t\t\t\t\t\t\t\tDiscard\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}\r\n",
    "import { cn } from \"../../../lib/utils\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { Check, ChevronDown, ChevronUp, Circle, Loader2 } from \"lucide-react\"\r\nimport { useState, useRef, useEffect } from \"react\"\r\nimport type { TodoStats } from \"../state/atoms/todos\"\r\n\r\ninterface AgentTodoListProps {\r\n\tstats: TodoStats\r\n\tisIntegrated?: boolean\r\n}\r\n\r\nfunction TodoIcon({ status, size = \"sm\" }: { status: string; size?: \"sm\" | \"xs\" }) {\r\n\tconst iconSize = size === \"xs\" ? \"w-3 h-3\" : \"w-3.5 h-3.5\"\r\n\tconst checkSize = size === \"xs\" ? \"w-2 h-2\" : \"w-2.5 h-2.5\"\r\n\r\n\tswitch (status) {\r\n\t\tcase \"completed\":\r\n\t\t\treturn (\r\n\t\t\t\t<div className={cn(\"flex items-center justify-center rounded-full bg-green-500/20\", iconSize)}>\r\n\t\t\t\t\t<Check className={cn(\"text-green-400\", checkSize)} strokeWidth={3} />\r\n\t\t\t\t</div>\r\n\t\t\t)\r\n\t\tcase \"in_progress\":\r\n\t\t\treturn <Loader2 className={cn(\"text-vscode-charts-yellow animate-spin\", iconSize)} />\r\n\t\tdefault:\r\n\t\t\treturn <Circle className={cn(\"text-vscode-descriptionForeground/40\", iconSize)} strokeWidth={2} />\r\n\t}\r\n}\r\n\r\nexport function AgentTodoList({ stats, isIntegrated = false }: AgentTodoListProps) {\r\n\tconst { t } = useTranslation(\"chat\")\r\n\tconst [isExpanded, setIsExpanded] = useState(false)\r\n\tconst listRef = useRef<HTMLDivElement>(null)\r\n\r\n\tconst { todos, completedCount, totalCount, currentTodo, allCompleted, progressPercent } = stats\r\n\r\n\t// Auto-scroll to in-progress item when expanded\r\n\tuseEffect(() => {\r\n\t\tif (!isExpanded || !listRef.current) return\r\n\t\tconst inProgressIdx = todos.findIndex((t) => t.status === \"in_progress\")\r\n\t\tif (inProgressIdx === -1) return\r\n\t\tconst items = listRef.current.querySelectorAll(\"[data-todo-item]\")\r\n\t\tconst target = items[inProgressIdx] as HTMLElement\r\n\t\tif (target) {\r\n\t\t\ttarget.scrollIntoView({ behavior: \"smooth\", block: \"center\" })\r\n\t\t}\r\n\t}, [isExpanded, todos])\r\n\r\n\tif (totalCount <= 0) return null\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={cn(\r\n\t\t\t\t\"overflow-hidden transition-all duration-200\",\r\n\t\t\t\t// When integrated, parent handles outer border; just add bottom separator\r\n\t\t\t\tisIntegrated\r\n\t\t\t\t\t? \"border-b border-vscode-input-border/50\"\r\n\t\t\t\t\t: \"rounded-t-md border-x border-t border-vscode-input-border\",\r\n\t\t\t\t\"bg-vscode-input-background\",\r\n\t\t\t)}>\r\n\t\t\t{/* Header - compact single line */}\r\n\t\t\t<button\r\n\t\t\t\ttype=\"button\"\r\n\t\t\t\tonClick={() => setIsExpanded(!isExpanded)}\r\n\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\"w-full flex items-center gap-2 px-3 py-1.5\",\r\n\t\t\t\t\t\"hover:bg-vscode-list-hoverBackground/30 transition-colors\",\r\n\t\t\t\t\t\"focus:outline-none\",\r\n\t\t\t\t\t\"cursor-pointer\",\r\n\t\t\t\t)}>\r\n\t\t\t\t{/* Progress ring - smaller */}\r\n\t\t\t\t<div className=\"relative flex-shrink-0\">\r\n\t\t\t\t\t<svg className=\"w-4 h-4 -rotate-90\" viewBox=\"0 0 16 16\">\r\n\t\t\t\t\t\t<circle\r\n\t\t\t\t\t\t\tcx=\"8\"\r\n\t\t\t\t\t\t\tcy=\"8\"\r\n\t\t\t\t\t\t\tr=\"6\"\r\n\t\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\t\tstrokeWidth=\"2\"\r\n\t\t\t\t\t\t\tclassName=\"text-vscode-input-border/40\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<circle\r\n\t\t\t\t\t\t\tcx=\"8\"\r\n\t\t\t\t\t\t\tcy=\"8\"\r\n\t\t\t\t\t\t\tr=\"6\"\r\n\t\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\t\tstrokeWidth=\"2\"\r\n\t\t\t\t\t\t\tstrokeDasharray={`${progressPercent * 0.377} 100`}\r\n\t\t\t\t\t\t\tstrokeLinecap=\"round\"\r\n\t\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\t\"transition-all duration-300\",\r\n\t\t\t\t\t\t\t\tallCompleted ? \"text-green-400\" : \"text-vscode-charts-yellow\",\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t\t{allCompleted && (\r\n\t\t\t\t\t\t<Check className=\"absolute inset-0 m-auto w-2 h-2 text-green-400\" strokeWidth={3} />\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{/* Current task text */}\r\n\t\t\t\t<span\r\n\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\"flex-1 text-xs truncate text-left\",\r\n\t\t\t\t\t\tallCompleted ? \"text-green-400\" : \"text-vscode-foreground\",\r\n\t\t\t\t\t)}>\r\n\t\t\t\t\t{allCompleted\r\n\t\t\t\t\t\t? t(\"todo.complete\", { total: completedCount })\r\n\t\t\t\t\t\t: currentTodo?.content || t(\"todo.partial\", { completed: completedCount, total: totalCount })}\r\n\t\t\t\t</span>\r\n\r\n\t\t\t\t{/* Counter */}\r\n\t\t\t\t<span className=\"flex-shrink-0 text-[10px] text-vscode-descriptionForeground/70 tabular-nums\">\r\n\t\t\t\t\t{completedCount}/{totalCount}\r\n\t\t\t\t</span>\r\n\r\n\t\t\t\t{/* Chevron */}\r\n\t\t\t\t{isExpanded ? (\r\n\t\t\t\t\t<ChevronDown className=\"w-3 h-3 text-vscode-descriptionForeground/50\" />\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<ChevronUp className=\"w-3 h-3 text-vscode-descriptionForeground/50\" />\r\n\t\t\t\t)}\r\n\t\t\t</button>\r\n\r\n\t\t\t{/* Expanded list - compact */}\r\n\t\t\t{isExpanded && (\r\n\t\t\t\t<div ref={listRef} className=\"max-h-[140px] overflow-y-auto border-t border-vscode-input-border/50\">\r\n\t\t\t\t\t<div className=\"py-1 px-1\">\r\n\t\t\t\t\t\t{todos.map((todo, idx) => (\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tkey={todo.id || idx}\r\n\t\t\t\t\t\t\t\tdata-todo-item\r\n\t\t\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\t\t\"flex items-center gap-2 py-0.5 px-2 rounded transition-colors\",\r\n\t\t\t\t\t\t\t\t\ttodo.status === \"in_progress\" && \"bg-vscode-charts-yellow/10\",\r\n\t\t\t\t\t\t\t\t)}>\r\n\t\t\t\t\t\t\t\t<TodoIcon status={todo.status} size=\"xs\" />\r\n\t\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\t\t\t\"text-xs truncate\",\r\n\t\t\t\t\t\t\t\t\t\ttodo.status === \"in_progress\" && \"text-vscode-charts-yellow\",\r\n\t\t\t\t\t\t\t\t\t\ttodo.status === \"completed\" &&\r\n\t\t\t\t\t\t\t\t\t\t\t\"line-through text-vscode-descriptionForeground/50\",\r\n\t\t\t\t\t\t\t\t\t\ttodo.status === \"pending\" && \"text-vscode-descriptionForeground\",\r\n\t\t\t\t\t\t\t\t\t)}>\r\n\t\t\t\t\t\t\t\t\t{todo.content}\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t)\r\n}\r\n",
    "import React, { useState, useRef, useEffect } from \"react\"\r\nimport { useAtom, useAtomValue, useSetAtom } from \"jotai\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { vscode } from \"../utils/vscode\"\r\nimport { GitBranch, SendHorizontal, Square } from \"lucide-react\"\r\nimport DynamicTextArea from \"react-textarea-autosize\"\r\nimport { cn } from \"../../../lib/utils\"\r\nimport { StandardTooltip } from \"../../../components/ui\"\r\nimport { sessionInputAtomFamily } from \"../state/atoms/sessions\"\r\nimport { sessionTodoStatsAtomFamily } from \"../state/atoms/todos\"\r\nimport { AgentTodoList } from \"./AgentTodoList\"\r\nimport { addToQueueAtom } from \"../state/atoms/messageQueue\"\r\n\r\ninterface ChatInputProps {\r\n\tsessionId: string\r\n\tsessionLabel?: string\r\n\tisActive?: boolean\r\n\tshowCancel?: boolean\r\n\tshowFinishToBranch?: boolean\r\n\tworktreeBranchName?: string\r\n\tsessionStatus?: \"creating\" | \"running\" | \"done\" | \"error\" | \"stopped\"\r\n}\r\n\r\nexport const ChatInput: React.FC<ChatInputProps> = ({\r\n\tsessionId,\r\n\tsessionLabel,\r\n\tisActive = false,\r\n\tshowCancel = false,\r\n\tshowFinishToBranch = false,\r\n\tworktreeBranchName,\r\n\tsessionStatus,\r\n}) => {\r\n\tconst { t } = useTranslation(\"agentManager\")\r\n\tconst [messageText, setMessageText] = useAtom(sessionInputAtomFamily(sessionId))\r\n\tconst todoStats = useAtomValue(sessionTodoStatsAtomFamily(sessionId))\r\n\tconst [isFocused, setIsFocused] = useState(false)\r\n\tconst textareaRef = useRef<HTMLTextAreaElement>(null)\r\n\tconst addToQueue = useSetAtom(addToQueueAtom)\r\n\r\n\t// Auto-focus the textarea when the session changes (user selects a different session)\r\n\tuseEffect(() => {\r\n\t\ttextareaRef.current?.focus()\r\n\t}, [sessionId])\r\n\r\n\tconst trimmedMessage = messageText.trim()\r\n\tconst isEmpty = trimmedMessage.length === 0\r\n\tconst isSessionCompleted = sessionStatus === \"done\" || sessionStatus === \"error\" || sessionStatus === \"stopped\"\r\n\r\n\t// Send is disabled when empty\r\n\t// Note: Users CAN queue multiple messages while one is sending (for running sessions)\r\n\t// Note: Users CAN send messages to completed sessions (to resume them)\r\n\tconst sendDisabled = isEmpty\r\n\r\n\tconst handleSend = () => {\r\n\t\tif (isEmpty) return\r\n\r\n\t\tif (isSessionCompleted) {\r\n\t\t\t// Resume a completed session with a new message (sent directly, not queued)\r\n\t\t\tvscode.postMessage({\r\n\t\t\t\ttype: \"agentManager.resumeSession\",\r\n\t\t\t\tsessionId,\r\n\t\t\t\tsessionLabel,\r\n\t\t\t\tcontent: trimmedMessage,\r\n\t\t\t})\r\n\t\t\tsetMessageText(\"\")\r\n\t\t} else {\r\n\t\t\t// For running sessions, queue the message instead of sending directly\r\n\t\t\tconst queuedMsg = addToQueue({ sessionId, content: trimmedMessage })\r\n\r\n\t\t\tif (queuedMsg) {\r\n\t\t\t\t// Notify the extension that a message has been queued\r\n\t\t\t\tvscode.postMessage({\r\n\t\t\t\t\ttype: \"agentManager.messageQueued\",\r\n\t\t\t\t\tsessionId,\r\n\t\t\t\t\tmessageId: queuedMsg.id,\r\n\t\t\t\t\tsessionLabel,\r\n\t\t\t\t\tcontent: trimmedMessage,\r\n\t\t\t\t})\r\n\r\n\t\t\t\tsetMessageText(\"\")\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleCancel = () => {\r\n\t\tvscode.postMessage({\r\n\t\t\ttype: \"agentManager.cancelSession\",\r\n\t\t\tsessionId,\r\n\t\t})\r\n\t}\r\n\r\n\tconst handleFinishToBranch = () => {\r\n\t\tvscode.postMessage({\r\n\t\t\ttype: \"agentManager.finishWorktreeSession\",\r\n\t\t\tsessionId,\r\n\t\t})\r\n\t}\r\n\r\n\tconst handleKeyDown = (e: React.KeyboardEvent) => {\r\n\t\tif (e.key === \"Enter\" && !e.shiftKey && !e.nativeEvent.isComposing) {\r\n\t\t\te.preventDefault()\r\n\t\t\thandleSend()\r\n\t\t}\r\n\t}\r\n\r\n\tconst hasTodos = todoStats.totalCount > 0\r\n\r\n\treturn (\r\n\t\t<div className=\"am-chat-input-container\">\r\n\t\t\t{/* Unified wrapper when todos present - handles border and focus state */}\r\n\t\t\t<div\r\n\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\"relative flex-1 flex flex-col min-h-0 overflow-hidden rounded\",\r\n\t\t\t\t\thasTodos && [\r\n\t\t\t\t\t\t\"border bg-vscode-input-background\",\r\n\t\t\t\t\t\tisFocused\r\n\t\t\t\t\t\t\t? \"border-vscode-focusBorder outline outline-vscode-focusBorder\"\r\n\t\t\t\t\t\t\t: \"border-vscode-input-border\",\r\n\t\t\t\t\t],\r\n\t\t\t\t)}>\r\n\t\t\t\t{/* Todo list above input */}\r\n\t\t\t\t{hasTodos && <AgentTodoList stats={todoStats} isIntegrated />}\r\n\t\t\t\t<div className={cn(\"relative\", \"flex-1\", \"flex\", \"flex-col-reverse\", \"min-h-0\", \"overflow-hidden\")}>\r\n\t\t\t\t\t<DynamicTextArea\r\n\t\t\t\t\t\tref={textareaRef}\r\n\t\t\t\t\t\tvalue={messageText}\r\n\t\t\t\t\t\tonChange={(e) => setMessageText(e.target.value)}\r\n\t\t\t\t\t\tonKeyDown={handleKeyDown}\r\n\t\t\t\t\t\tonFocus={() => setIsFocused(true)}\r\n\t\t\t\t\t\tonBlur={() => setIsFocused(false)}\r\n\t\t\t\t\t\taria-label={t(\"chatInput.ariaLabel\")}\r\n\t\t\t\t\t\tplaceholder={t(\"chatInput.placeholderTypeTask\")}\r\n\t\t\t\t\t\tminRows={3}\r\n\t\t\t\t\t\tmaxRows={15}\r\n\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\"w-full\",\r\n\t\t\t\t\t\t\t\"text-vscode-input-foreground\",\r\n\t\t\t\t\t\t\t\"font-vscode-font-family\",\r\n\t\t\t\t\t\t\t\"text-vscode-editor-font-size\",\r\n\t\t\t\t\t\t\t\"leading-vscode-editor-line-height\",\r\n\t\t\t\t\t\t\t\"cursor-text\",\r\n\t\t\t\t\t\t\t\"!pt-3 !pl-3 pr-9\",\r\n\t\t\t\t\t\t\t// Only show border when no todos (standalone mode)\r\n\t\t\t\t\t\t\t!hasTodos && [\r\n\t\t\t\t\t\t\t\tisFocused\r\n\t\t\t\t\t\t\t\t\t? \"border border-vscode-focusBorder outline outline-vscode-focusBorder\"\r\n\t\t\t\t\t\t\t\t\t: \"border border-vscode-input-border\",\r\n\t\t\t\t\t\t\t\t\"rounded\",\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\"bg-vscode-input-background\",\r\n\t\t\t\t\t\t\t\"transition-background-color duration-150 ease-in-out\",\r\n\t\t\t\t\t\t\t\"will-change-background-color\",\r\n\t\t\t\t\t\t\t\"min-h-[90px]\",\r\n\t\t\t\t\t\t\t\"box-border\",\r\n\t\t\t\t\t\t\t\"resize-none\",\r\n\t\t\t\t\t\t\t\"overflow-x-hidden\",\r\n\t\t\t\t\t\t\t\"overflow-y-auto\",\r\n\t\t\t\t\t\t\t\"!pb-10\",\r\n\t\t\t\t\t\t\t\"flex-none flex-grow\",\r\n\t\t\t\t\t\t\t\"z-[2]\",\r\n\t\t\t\t\t\t\t\"scrollbar-none\",\r\n\t\t\t\t\t\t\t\"scrollbar-hide\",\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t{/* Transparent overlay at bottom */}\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"absolute bottom-[1px] left-2 right-2 h-10 bg-gradient-to-t from-[var(--vscode-input-background)] via-[var(--vscode-input-background)] to-transparent pointer-events-none z-[2]\"\r\n\t\t\t\t\t\taria-hidden=\"true\"\r\n\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t{/* Floating Actions */}\r\n\t\t\t\t\t<div className=\"absolute bottom-2 right-2 z-30 flex gap-1\">\r\n\t\t\t\t\t\t{showFinishToBranch && (\r\n\t\t\t\t\t\t\t<StandardTooltip\r\n\t\t\t\t\t\t\t\tcontent={\r\n\t\t\t\t\t\t\t\t\tworktreeBranchName\r\n\t\t\t\t\t\t\t\t\t\t? t(\"chatInput.finishToBranchTitle\", { branch: worktreeBranchName })\r\n\t\t\t\t\t\t\t\t\t\t: t(\"chatInput.finishToBranchTitleNoBranch\")\r\n\t\t\t\t\t\t\t\t}>\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\taria-label={\r\n\t\t\t\t\t\t\t\t\t\tworktreeBranchName\r\n\t\t\t\t\t\t\t\t\t\t\t? t(\"chatInput.finishToBranchTitle\", { branch: worktreeBranchName })\r\n\t\t\t\t\t\t\t\t\t\t\t: t(\"chatInput.finishToBranchTitleNoBranch\")\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tonClick={handleFinishToBranch}\r\n\t\t\t\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\t\t\t\"relative inline-flex items-center justify-center\",\r\n\t\t\t\t\t\t\t\t\t\t\"bg-transparent border-none p-1.5\",\r\n\t\t\t\t\t\t\t\t\t\t\"rounded-md min-w-[28px] min-h-[28px]\",\r\n\t\t\t\t\t\t\t\t\t\t\"opacity-60 hover:opacity-100 text-vscode-descriptionForeground hover:text-vscode-foreground\",\r\n\t\t\t\t\t\t\t\t\t\t\"transition-all duration-150\",\r\n\t\t\t\t\t\t\t\t\t\t\"hover:bg-[rgba(255,255,255,0.03)] hover:border-[rgba(255,255,255,0.15)]\",\r\n\t\t\t\t\t\t\t\t\t\t\"focus:outline-none focus-visible:ring-1 focus-visible:ring-vscode-focusBorder\",\r\n\t\t\t\t\t\t\t\t\t\t\"active:bg-[rgba(255,255,255,0.1)]\",\r\n\t\t\t\t\t\t\t\t\t\t\"cursor-pointer\",\r\n\t\t\t\t\t\t\t\t\t)}>\r\n\t\t\t\t\t\t\t\t\t<GitBranch size={14} />\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t</StandardTooltip>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t{isActive && showCancel && (\r\n\t\t\t\t\t\t\t<StandardTooltip content={t(\"chatInput.cancelTitle\")}>\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\taria-label={t(\"chatInput.cancelTitle\")}\r\n\t\t\t\t\t\t\t\t\tonClick={handleCancel}\r\n\t\t\t\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\t\t\t\"relative inline-flex items-center justify-center\",\r\n\t\t\t\t\t\t\t\t\t\t\"bg-transparent border-none p-1.5\",\r\n\t\t\t\t\t\t\t\t\t\t\"rounded-md min-w-[28px] min-h-[28px]\",\r\n\t\t\t\t\t\t\t\t\t\t\"opacity-60 hover:opacity-100 text-vscode-errorForeground\",\r\n\t\t\t\t\t\t\t\t\t\t\"transition-all duration-150\",\r\n\t\t\t\t\t\t\t\t\t\t\"hover:bg-[rgba(255,255,255,0.03)] hover:border-[rgba(255,255,255,0.15)]\",\r\n\t\t\t\t\t\t\t\t\t\t\"focus:outline-none focus-visible:ring-1 focus-visible:ring-vscode-focusBorder\",\r\n\t\t\t\t\t\t\t\t\t\t\"active:bg-[rgba(255,255,255,0.1)]\",\r\n\t\t\t\t\t\t\t\t\t\t\"cursor-pointer\",\r\n\t\t\t\t\t\t\t\t\t)}>\r\n\t\t\t\t\t\t\t\t\t<Square size={14} fill=\"currentColor\" />\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t</StandardTooltip>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t<StandardTooltip content={t(\"chatInput.sendTitle\")}>\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\taria-label={t(\"chatInput.sendTitle\")}\r\n\t\t\t\t\t\t\t\tdisabled={sendDisabled}\r\n\t\t\t\t\t\t\t\tonClick={handleSend}\r\n\t\t\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\t\t\"relative inline-flex items-center justify-center\",\r\n\t\t\t\t\t\t\t\t\t\"bg-transparent border-none p-1.5\",\r\n\t\t\t\t\t\t\t\t\t\"rounded-md min-w-[28px] min-h-[28px]\",\r\n\t\t\t\t\t\t\t\t\t\"opacity-60 hover:opacity-100 text-vscode-descriptionForeground hover:text-vscode-foreground\",\r\n\t\t\t\t\t\t\t\t\t\"transition-all duration-150\",\r\n\t\t\t\t\t\t\t\t\t\"hover:bg-[rgba(255,255,255,0.03)] hover:border-[rgba(255,255,255,0.15)]\",\r\n\t\t\t\t\t\t\t\t\t\"focus:outline-none focus-visible:ring-1 focus-visible:ring-vscode-focusBorder\",\r\n\t\t\t\t\t\t\t\t\t\"active:bg-[rgba(255,255,255,0.1)]\",\r\n\t\t\t\t\t\t\t\t\t!sendDisabled && \"cursor-pointer\",\r\n\t\t\t\t\t\t\t\t\tsendDisabled &&\r\n\t\t\t\t\t\t\t\t\t\t\"opacity-40 cursor-not-allowed grayscale-[30%] hover:bg-transparent hover:border-[rgba(255,255,255,0.08)] active:bg-transparent\",\r\n\t\t\t\t\t\t\t\t)}>\r\n\t\t\t\t\t\t\t\t{/* rtl support */}\r\n\t\t\t\t\t\t\t\t<SendHorizontal className=\"w-4 h-4 rtl:-scale-x-100\" />\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</StandardTooltip>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Hint Text inside input */}\r\n\t\t\t\t\t{!messageText && (\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclassName=\"absolute left-3 right-[70px] z-30 flex items-center h-8 overflow-hidden text-ellipsis whitespace-nowrap\"\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\tbottom: \"0.25rem\",\r\n\t\t\t\t\t\t\t\tcolor: \"var(--vscode-descriptionForeground)\",\r\n\t\t\t\t\t\t\t\topacity: 0.7,\r\n\t\t\t\t\t\t\t\tfontSize: \"11px\",\r\n\t\t\t\t\t\t\t\tuserSelect: \"none\",\r\n\t\t\t\t\t\t\t\tpointerEvents: \"none\",\r\n\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t{t(\"chatInput.hint\")}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}\r\n",
    "import { useEffect, useCallback } from \"react\"\r\nimport { useAtomValue } from \"jotai\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { GitBranch, Check } from \"lucide-react\"\r\nimport { branchesAtom, currentBranchAtom } from \"../state/atoms/branches\"\r\nimport {\r\n\tCommand,\r\n\tCommandInput,\r\n\tCommandList,\r\n\tCommandEmpty,\r\n\tCommandGroup,\r\n\tCommandItem,\r\n\tCommandSeparator,\r\n} from \"@/components/ui/command\"\r\n\r\ninterface BranchPickerProps {\r\n\tselectedBranch: string | null\r\n\tonSelect: (branch: string) => void\r\n\tonClose: () => void\r\n}\r\n\r\n/**\r\n * Branch picker component using cmdk for keyboard-navigable searchable list\r\n * with \"Your branches\" (current) and \"Other branches\" sections\r\n */\r\nexport function BranchPicker({ selectedBranch, onSelect, onClose }: BranchPickerProps) {\r\n\tconst { t } = useTranslation(\"agentManager\")\r\n\tconst branches = useAtomValue(branchesAtom)\r\n\tconst currentBranch = useAtomValue(currentBranchAtom)\r\n\r\n\tconst yourBranches = currentBranch && branches.includes(currentBranch) ? [currentBranch] : []\r\n\tconst otherBranches = branches.filter((b) => b !== currentBranch)\r\n\r\n\tconst handleSelect = useCallback(\r\n\t\t(branch: string) => {\r\n\t\t\tonSelect(branch)\r\n\t\t\tonClose()\r\n\t\t},\r\n\t\t[onSelect, onClose],\r\n\t)\r\n\r\n\tuseEffect(() => {\r\n\t\tconst handleKeyDown = (e: KeyboardEvent) => {\r\n\t\t\tif (e.key === \"Escape\") {\r\n\t\t\t\tonClose()\r\n\t\t\t}\r\n\t\t}\r\n\t\tdocument.addEventListener(\"keydown\", handleKeyDown)\r\n\t\treturn () => document.removeEventListener(\"keydown\", handleKeyDown)\r\n\t}, [onClose])\r\n\r\n\tconst handleBackdropClick = (e: React.MouseEvent) => {\r\n\t\tif (e.target === e.currentTarget) {\r\n\t\t\tonClose()\r\n\t\t}\r\n\t}\r\n\r\n\tif (branches.length === 0) {\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"fixed inset-0 bg-black/50 flex items-start justify-center pt-20 z-50\"\r\n\t\t\t\tonClick={handleBackdropClick}>\r\n\t\t\t\t<div className=\"bg-vscode-editor-background border border-vscode-editorWidget-border rounded-md shadow-lg w-96 p-4 text-center text-vscode-descriptionForeground\">\r\n\t\t\t\t\t<GitBranch size={24} className=\"mx-auto mb-2 opacity-50\" />\r\n\t\t\t\t\t{t(\"sessionDetail.noBranches\")}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"fixed inset-0 bg-black/50 flex items-start justify-center pt-20 z-50\"\r\n\t\t\tonClick={handleBackdropClick}>\r\n\t\t\t<Command className=\"bg-vscode-editor-background border border-vscode-editorWidget-border rounded-md shadow-lg w-96 max-h-96 flex flex-col overflow-hidden\">\r\n\t\t\t\t<CommandInput placeholder={t(\"sessionDetail.searchBranches\")} autoFocus />\r\n\t\t\t\t<CommandList>\r\n\t\t\t\t\t<CommandEmpty>{t(\"sessionDetail.noMatchingBranches\")}</CommandEmpty>\r\n\r\n\t\t\t\t\t{yourBranches.length > 0 && (\r\n\t\t\t\t\t\t<CommandGroup heading={t(\"sessionDetail.yourBranches\")}>\r\n\t\t\t\t\t\t\t{yourBranches.map((branch) => (\r\n\t\t\t\t\t\t\t\t<CommandItem key={branch} value={branch} onSelect={() => handleSelect(branch)}>\r\n\t\t\t\t\t\t\t\t\t<GitBranch size={12} className=\"flex-shrink-0\" />\r\n\t\t\t\t\t\t\t\t\t<span className=\"truncate flex-1\">{branch}</span>\r\n\t\t\t\t\t\t\t\t\t{selectedBranch === branch && <Check size={12} className=\"ml-auto\" />}\r\n\t\t\t\t\t\t\t\t</CommandItem>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</CommandGroup>\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t{yourBranches.length > 0 && otherBranches.length > 0 && <CommandSeparator />}\r\n\r\n\t\t\t\t\t{otherBranches.length > 0 && (\r\n\t\t\t\t\t\t<CommandGroup heading={t(\"sessionDetail.otherBranches\")}>\r\n\t\t\t\t\t\t\t{otherBranches.map((branch) => (\r\n\t\t\t\t\t\t\t\t<CommandItem key={branch} value={branch} onSelect={() => handleSelect(branch)}>\r\n\t\t\t\t\t\t\t\t\t<GitBranch size={12} className=\"flex-shrink-0\" />\r\n\t\t\t\t\t\t\t\t\t<span className=\"truncate flex-1\">{branch}</span>\r\n\t\t\t\t\t\t\t\t\t{selectedBranch === branch && <Check size={12} className=\"ml-auto\" />}\r\n\t\t\t\t\t\t\t\t</CommandItem>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</CommandGroup>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</CommandList>\r\n\t\t\t</Command>\r\n\t\t</div>\r\n\t)\r\n}\r\n",
    "import React from \"react\"\r\n\r\nexport const KiloLogo = () => {\r\n\treturn (\r\n\t\t<svg\r\n\t\t\tid=\"Layer_2\"\r\n\t\t\tdata-name=\"Layer 2\"\r\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\tviewBox=\"0 0 100 100\"\r\n\t\t\twidth=\"100%\"\r\n\t\t\theight=\"100%\"\r\n\t\t\tstyle={{ display: \"block\" }}>\r\n\t\t\t<g id=\"Kilo_Code_Branding\" data-name=\"Kilo Code Branding\">\r\n\t\t\t\t<path\r\n\t\t\t\t\tid=\"Logo_Outline_-_White\"\r\n\t\t\t\t\tdata-name=\"Logo Outline - White\"\r\n\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\td=\"M0,0v100h100V0H0ZM92.5925926,92.5925926H7.4074074V7.4074074h85.1851852v85.1851852ZM61.1111044,71.9096084h9.2592593v7.4074074h-11.6402116l-5.026455-5.026455v-11.6402116h7.4074074v9.2592593ZM77.7777711,71.9096084h-7.4074074v-9.2592593h-9.2592593v-7.4074074h11.6402116l5.026455,5.026455v11.6402116ZM46.2962963,61.1114207h-7.4074074v-7.4074074h7.4074074v7.4074074ZM22.2222222,53.7040133h7.4074074v16.6666667h16.6666667v7.4074074h-19.047619l-5.026455-5.026455v-19.047619ZM77.7777711,38.8888889v7.4074074h-24.0740741v-7.4074074h8.2781918v-9.2592593h-8.2781918v-7.4074074h10.6591442l5.026455,5.026455v11.6402116h8.3884749ZM29.6296296,30.5555556h9.2592593l7.4074074,7.4074074v8.3333333h-7.4074074v-8.3333333h-9.2592593v8.3333333h-7.4074074v-24.0740741h7.4074074v8.3333333ZM46.2962963,30.5555556h-7.4074074v-8.3333333h7.4074074v8.3333333Z\"\r\n\t\t\t\t/>\r\n\t\t\t</g>\r\n\t\t</svg>\r\n\t)\r\n}\r\n",
    "import React, { useState, useEffect, useMemo, useRef } from \"react\"\r\nimport { useAtom, useAtomValue } from \"jotai\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport {\r\n\tselectedSessionAtom,\r\n\tstartSessionFailedCounterAtom,\r\n\tpendingSessionAtom,\r\n\tpreferredRunModeAtom,\r\n\tversionCountAtom,\r\n\tgenerateVersionLabels,\r\n\tVERSION_COUNT_OPTIONS,\r\n\ttype RunMode,\r\n\ttype VersionCount,\r\n} from \"../state/atoms/sessions\"\r\nimport { sessionMachineUiStateAtom, selectedSessionMachineStateAtom } from \"../state/atoms/stateMachine\"\r\nimport { MessageList } from \"./MessageList\"\r\nimport { ChatInput } from \"./ChatInput\"\r\nimport { BranchPicker } from \"./BranchPicker\"\r\nimport { vscode } from \"../utils/vscode\"\r\nimport { formatRelativeTime, createRelativeTimeLabels } from \"../utils/timeUtils\"\r\nimport {\r\n\tLoader2,\r\n\tSendHorizontal,\r\n\tGitBranch,\r\n\tFolder,\r\n\tChevronDown,\r\n\tAlertCircle,\r\n\tZap,\r\n\tLayers,\r\n\tX,\r\n\tTerminal,\r\n} from \"lucide-react\"\r\nimport DynamicTextArea from \"react-textarea-autosize\"\r\nimport { cn } from \"../../../lib/utils\"\r\nimport { StandardTooltip } from \"../../../components/ui\"\r\nimport { KiloLogo } from \"./KiloLogo\"\r\n\r\nexport function SessionDetail() {\r\n\tconst { t } = useTranslation(\"agentManager\")\r\n\tconst selectedSession = useAtomValue(selectedSessionAtom)\r\n\tconst pendingSession = useAtomValue(pendingSessionAtom)\r\n\tconst machineUiState = useAtomValue(sessionMachineUiStateAtom)\r\n\tconst selectedSessionState = useAtomValue(selectedSessionMachineStateAtom)\r\n\tconst prevSessionStateRef = useRef<{ id: string; status: string } | undefined>(undefined)\r\n\r\n\t// Hooks must be called unconditionally before any early returns\r\n\tconst timeLabels = useMemo(() => createRelativeTimeLabels(t), [t])\r\n\r\n\t// Auto-cancel session when it ends (as if user clicked the red cancel button)\r\n\t// Only send cancel once when transitioning from \"running\" to a terminal state\r\n\t// Track both sessionId and status to avoid spurious cancels on session switches\r\n\tuseEffect(() => {\r\n\t\tif (!selectedSession) return\r\n\r\n\t\tconst prevState = prevSessionStateRef.current\r\n\t\tconst currentState = { id: selectedSession.sessionId, status: selectedSession.status }\r\n\r\n\t\t// Update the ref for next render\r\n\t\tprevSessionStateRef.current = currentState\r\n\r\n\t\t// Only send cancel if same session transitioned from running to terminal state\r\n\t\tif (prevState?.id === currentState.id && prevState.status === \"running\" && currentState.status !== \"running\") {\r\n\t\t\tvscode.postMessage({\r\n\t\t\t\ttype: \"agentManager.cancelSession\",\r\n\t\t\t\tsessionId: selectedSession.sessionId,\r\n\t\t\t})\r\n\t\t}\r\n\t}, [selectedSession])\r\n\r\n\t// Show pending session view only when no other session is selected\r\n\tif (pendingSession && !selectedSession) {\r\n\t\treturn <PendingSessionView pendingSession={pendingSession} />\r\n\t}\r\n\r\n\tif (!selectedSession) {\r\n\t\treturn <NewAgentForm />\r\n\t}\r\n\r\n\t// Use state machine UI state as the single source of truth for activity/spinner\r\n\tconst sessionUiState = machineUiState[selectedSession.sessionId]\r\n\tconst isActive = sessionUiState?.isActive ?? false\r\n\tconst showSpinner = sessionUiState?.showSpinner ?? false\r\n\tconst isWorktree = selectedSession.parallelMode?.enabled\r\n\tconst branchName = selectedSession.parallelMode?.branch\r\n\tconst isProvisionalSession = selectedSession.sessionId.startsWith(\"provisional-\")\r\n\r\n\t// Determine if \"Finish to Branch\" button should be shown\r\n\t// Simplified logic: show when session is a worktree session and running\r\n\t// Users should be able to finish at any point while the session is active\r\n\tconst isSessionRunning = selectedSession.status === \"running\"\r\n\tconst canFinishWorktree = !!isWorktree && isSessionRunning\r\n\r\n\treturn (\r\n\t\t<div className=\"am-session-detail\">\r\n\t\t\t<div className=\"am-detail-header\">\r\n\t\t\t\t<div className=\"am-header-info\">\r\n\t\t\t\t\t<div className=\"am-header-title\" title={selectedSession.prompt}>\r\n\t\t\t\t\t\t{selectedSession.label}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"am-header-meta\">\r\n\t\t\t\t\t\t{showSpinner && (\r\n\t\t\t\t\t\t\t<div style={{ display: \"flex\", alignItems: \"center\", gap: 4 }}>\r\n\t\t\t\t\t\t\t\t<Loader2 size={12} className=\"am-spinning\" />\r\n\t\t\t\t\t\t\t\t<span>\r\n\t\t\t\t\t\t\t\t\t{selectedSessionState === \"creating\" ? t(\"status.creating\") : t(\"status.running\")}\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t<span>{formatRelativeTime(selectedSession.startTime, timeLabels)}</span>\r\n\t\t\t\t\t\t{isWorktree ? (\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"am-worktree-badge\"\r\n\t\t\t\t\t\t\t\tstyle={{ display: \"flex\", alignItems: \"center\", gap: 4 }}\r\n\t\t\t\t\t\t\t\ttitle={branchName || t(\"sessionDetail.runningInWorktree\")}>\r\n\t\t\t\t\t\t\t\t<GitBranch size={12} />\r\n\t\t\t\t\t\t\t\t<span>{branchName || t(\"sidebar.worktree\")}</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"am-local-badge\"\r\n\t\t\t\t\t\t\t\tstyle={{ display: \"flex\", alignItems: \"center\", gap: 4 }}\r\n\t\t\t\t\t\t\t\ttitle={t(\"sessionDetail.runningLocally\")}>\r\n\t\t\t\t\t\t\t\t<Folder size={12} />\r\n\t\t\t\t\t\t\t\t<span>{t(\"sessionDetail.runModeLocal\")}</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"am-header-actions\">\r\n\t\t\t\t\t{!isProvisionalSession && (\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclassName=\"am-icon-btn\"\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tvscode.postMessage({\r\n\t\t\t\t\t\t\t\t\ttype: \"agentManager.showTerminal\",\r\n\t\t\t\t\t\t\t\t\tsessionId: selectedSession.sessionId,\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\taria-label={t(\"sessionDetail.openTerminal\")}\r\n\t\t\t\t\t\t\ttitle={t(\"sessionDetail.openTerminal\")}>\r\n\t\t\t\t\t\t\t<Terminal size={14} />\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t{selectedSession.status === \"error\" && selectedSession.error && (\r\n\t\t\t\t<div className=\"am-session-error-banner\" role=\"alert\">\r\n\t\t\t\t\t<AlertCircle size={16} />\r\n\t\t\t\t\t<span>{selectedSession.error}</span>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\r\n\t\t\t{isActive && (\r\n\t\t\t\t<div className=\"am-full-auto-banner\">\r\n\t\t\t\t\t<Zap size={14} />\r\n\t\t\t\t\t<span>{t(\"sessionDetail.autoModeWarning\")}</span>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\r\n\t\t\t<MessageList sessionId={selectedSession.sessionId} />\r\n\r\n\t\t\t<ChatInput\r\n\t\t\t\tsessionId={selectedSession.sessionId}\r\n\t\t\t\tsessionLabel={selectedSession.label}\r\n\t\t\t\tisActive={isActive}\r\n\t\t\t\tshowCancel={isActive}\r\n\t\t\t\tshowFinishToBranch={canFinishWorktree}\r\n\t\t\t\tworktreeBranchName={branchName}\r\n\t\t\t\tsessionStatus={selectedSession.status}\r\n\t\t\t/>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\n/**\r\n * View shown while a session is being created (waiting for CLI's session_created event)\r\n */\r\nfunction PendingSessionView({\r\n\tpendingSession,\r\n}: {\r\n\tpendingSession: { label: string; prompt: string; startTime: number }\r\n}) {\r\n\tconst { t } = useTranslation(\"agentManager\")\r\n\r\n\tconst handleCancel = () => {\r\n\t\tvscode.postMessage({ type: \"agentManager.cancelPendingSession\" })\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"am-session-detail\">\r\n\t\t\t<div className=\"am-detail-header\">\r\n\t\t\t\t<div className=\"am-header-info\">\r\n\t\t\t\t\t<div className=\"am-header-title\" title={pendingSession.prompt}>\r\n\t\t\t\t\t\t{pendingSession.label}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"am-header-meta\">\r\n\t\t\t\t\t\t<div style={{ display: \"flex\", alignItems: \"center\", gap: 4 }}>\r\n\t\t\t\t\t\t\t<Loader2 size={12} className=\"am-spinning\" />\r\n\t\t\t\t\t\t\t<span>{t(\"status.creating\")}</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"am-header-actions\">\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tclassName=\"am-icon-btn\"\r\n\t\t\t\t\t\tonClick={handleCancel}\r\n\t\t\t\t\t\taria-label={t(\"sessionDetail.cancelCreating\")}\r\n\t\t\t\t\t\ttitle={t(\"sessionDetail.cancelCreating\")}>\r\n\t\t\t\t\t\t<X size={14} />\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"am-center-form\">\r\n\t\t\t\t<Loader2 size={48} className=\"am-spinning\" style={{ opacity: 0.5 }} />\r\n\t\t\t\t<h2 style={{ marginTop: 16 }}>{t(\"sessionDetail.creatingSession\")}</h2>\r\n\t\t\t\t<p>{t(\"sessionDetail.waitingForCli\")}</p>\r\n\t\t\t\t<button className=\"am-cancel-btn\" onClick={handleCancel} style={{ marginTop: 16 }}>\r\n\t\t\t\t\t{t(\"sessionDetail.cancelButton\")}\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nfunction NewAgentForm() {\r\n\tconst { t } = useTranslation(\"agentManager\")\r\n\tconst [promptText, setPromptText] = useState(\"\")\r\n\tconst [runMode, setRunMode] = useAtom(preferredRunModeAtom)\r\n\tconst [versionCount, setVersionCount] = useAtom(versionCountAtom)\r\n\tconst [isStarting, setIsStarting] = useState(false)\r\n\tconst [isFocused, setIsFocused] = useState(false)\r\n\tconst [isDropdownOpen, setIsDropdownOpen] = useState(false)\r\n\tconst [isVersionDropdownOpen, setIsVersionDropdownOpen] = useState(false)\r\n\tconst [selectedBranch, setSelectedBranch] = useState<string | null>(null)\r\n\tconst [isBranchPickerOpen, setIsBranchPickerOpen] = useState(false)\r\n\tconst dropdownRef = useRef<HTMLDivElement>(null)\r\n\tconst versionDropdownRef = useRef<HTMLDivElement>(null)\r\n\tconst startSessionFailedCounter = useAtomValue(startSessionFailedCounterAtom)\r\n\r\n\t// Multi-version mode forces worktree mode\r\n\tconst isMultiVersion = versionCount > 1\r\n\tconst effectiveRunMode = isMultiVersion ? \"worktree\" : runMode\r\n\r\n\t// Reset loading state when session start fails (e.g., no workspace folder)\r\n\tuseEffect(() => {\r\n\t\tif (startSessionFailedCounter > 0) {\r\n\t\t\tsetIsStarting(false)\r\n\t\t}\r\n\t}, [startSessionFailedCounter])\r\n\r\n\t// Request branches on mount and when switching to worktree mode\r\n\tuseEffect(() => {\r\n\t\tvscode.postMessage({ type: \"agentManager.listBranches\" })\r\n\t}, [])\r\n\r\n\t// Also request when switching to worktree mode\r\n\tuseEffect(() => {\r\n\t\tif (effectiveRunMode === \"worktree\") {\r\n\t\t\tvscode.postMessage({ type: \"agentManager.listBranches\" })\r\n\t\t}\r\n\t}, [effectiveRunMode])\r\n\r\n\t// Close dropdowns when clicking outside\r\n\tuseEffect(() => {\r\n\t\tconst handleClickOutside = (event: MouseEvent) => {\r\n\t\t\tif (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\r\n\t\t\t\tsetIsDropdownOpen(false)\r\n\t\t\t}\r\n\t\t\tif (versionDropdownRef.current && !versionDropdownRef.current.contains(event.target as Node)) {\r\n\t\t\t\tsetIsVersionDropdownOpen(false)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isDropdownOpen || isVersionDropdownOpen) {\r\n\t\t\tdocument.addEventListener(\"mousedown\", handleClickOutside)\r\n\t\t}\r\n\r\n\t\treturn () => {\r\n\t\t\tdocument.removeEventListener(\"mousedown\", handleClickOutside)\r\n\t\t}\r\n\t}, [isDropdownOpen, isVersionDropdownOpen])\r\n\r\n\tconst trimmedPrompt = promptText.trim()\r\n\tconst isEmpty = trimmedPrompt.length === 0\r\n\r\n\tconst handleStart = () => {\r\n\t\tif (isEmpty || isStarting) return\r\n\r\n\t\tsetIsStarting(true)\r\n\r\n\t\t// Generate labels for multi-version mode\r\n\t\tconst labels = isMultiVersion ? generateVersionLabels(trimmedPrompt.slice(0, 50), versionCount) : undefined\r\n\r\n\t\tvscode.postMessage({\r\n\t\t\ttype: \"agentManager.startSession\",\r\n\t\t\tprompt: trimmedPrompt,\r\n\t\t\tparallelMode: effectiveRunMode === \"worktree\",\r\n\t\t\tversions: versionCount,\r\n\t\t\tlabels,\r\n\t\t\texistingBranch: selectedBranch || undefined,\r\n\t\t})\r\n\t}\r\n\r\n\tconst handleKeyDown = (e: React.KeyboardEvent) => {\r\n\t\tif (e.key === \"Enter\" && !e.shiftKey && !e.nativeEvent.isComposing) {\r\n\t\t\te.preventDefault()\r\n\t\t\thandleStart()\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleSelectMode = (mode: RunMode) => {\r\n\t\tsetRunMode(mode)\r\n\t\tsetIsDropdownOpen(false)\r\n\t}\r\n\r\n\tconst handleSelectVersionCount = (count: VersionCount) => {\r\n\t\tsetVersionCount(count)\r\n\t\tsetIsVersionDropdownOpen(false)\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"am-center-form\">\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"text-[var(--vscode-editor-foreground)]\"\r\n\t\t\t\tstyle={{ width: 48, height: 48, margin: \"0 auto 16px auto\" }}>\r\n\t\t\t\t<KiloLogo />\r\n\t\t\t</div>\r\n\t\t\t<div style={{ width: \"100%\", maxWidth: \"100%\", minWidth: \"280px\" }}>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\"relative\",\r\n\t\t\t\t\t\t\"flex\",\r\n\t\t\t\t\t\t\"flex-col-reverse\",\r\n\t\t\t\t\t\t\"min-h-0\",\r\n\t\t\t\t\t\t\"overflow-visible\", // Allow dropdown to overflow\r\n\t\t\t\t\t\t\"rounded\",\r\n\t\t\t\t\t)}>\r\n\t\t\t\t\t<DynamicTextArea\r\n\t\t\t\t\t\tautoFocus\r\n\t\t\t\t\t\tvalue={promptText}\r\n\t\t\t\t\t\tonChange={(e) => setPromptText(e.target.value)}\r\n\t\t\t\t\t\tonKeyDown={handleKeyDown}\r\n\t\t\t\t\t\tonFocus={() => setIsFocused(true)}\r\n\t\t\t\t\t\tonBlur={() => setIsFocused(false)}\r\n\t\t\t\t\t\taria-label={t(\"sessionDetail.startNewAgent\")}\r\n\t\t\t\t\t\tdisabled={isStarting}\r\n\t\t\t\t\t\tplaceholder={t(\"sessionDetail.placeholderTask\")}\r\n\t\t\t\t\t\tminRows={5}\r\n\t\t\t\t\t\tmaxRows={12}\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\tpaddingTop: \"12px\",\r\n\t\t\t\t\t\t\tpaddingBottom: \"40px\",\r\n\t\t\t\t\t\t\tpaddingLeft: \"16px\",\r\n\t\t\t\t\t\t\tpaddingRight: \"36px\",\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\"w-full\",\r\n\t\t\t\t\t\t\t\"text-vscode-input-foreground\",\r\n\t\t\t\t\t\t\t\"font-vscode-font-family\",\r\n\t\t\t\t\t\t\t\"text-vscode-editor-font-size\",\r\n\t\t\t\t\t\t\t\"leading-vscode-editor-line-height\",\r\n\t\t\t\t\t\t\t\"cursor-text\",\r\n\t\t\t\t\t\t\t// Padding handled by style prop now\r\n\t\t\t\t\t\t\tisFocused\r\n\t\t\t\t\t\t\t\t? \"border border-vscode-focusBorder outline outline-vscode-focusBorder\"\r\n\t\t\t\t\t\t\t\t: \"border border-vscode-input-border\",\r\n\t\t\t\t\t\t\t\"bg-vscode-input-background\",\r\n\t\t\t\t\t\t\t\"transition-background-color duration-150 ease-in-out\",\r\n\t\t\t\t\t\t\t\"will-change-background-color\",\r\n\t\t\t\t\t\t\t\"box-border\",\r\n\t\t\t\t\t\t\t\"rounded\",\r\n\t\t\t\t\t\t\t\"resize-none\",\r\n\t\t\t\t\t\t\t\"overflow-x-hidden\",\r\n\t\t\t\t\t\t\t\"overflow-y-auto\",\r\n\t\t\t\t\t\t\t\"flex-none flex-grow\",\r\n\t\t\t\t\t\t\t\"z-[2]\",\r\n\t\t\t\t\t\t\t\"scrollbar-none\",\r\n\t\t\t\t\t\t\t\"scrollbar-hide\",\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"absolute bottom-[1px] left-2 right-2 h-10 bg-gradient-to-t from-[var(--vscode-input-background)] via-[var(--vscode-input-background)] to-transparent pointer-events-none z-[2]\"\r\n\t\t\t\t\t\taria-hidden=\"true\"\r\n\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t<div className=\"absolute bottom-2 right-2 z-30 flex items-center gap-2\">\r\n\t\t\t\t\t\t<div ref={dropdownRef} className=\"am-run-mode-dropdown-inline relative\">\r\n\t\t\t\t\t\t\t<StandardTooltip\r\n\t\t\t\t\t\t\t\tcontent={\r\n\t\t\t\t\t\t\t\t\tisMultiVersion\r\n\t\t\t\t\t\t\t\t\t\t? t(\"sessionDetail.versionsHelperText\", { count: versionCount })\r\n\t\t\t\t\t\t\t\t\t\t: effectiveRunMode === \"local\"\r\n\t\t\t\t\t\t\t\t\t\t\t? t(\"sessionDetail.runModeLocal\")\r\n\t\t\t\t\t\t\t\t\t\t\t: t(\"sessionDetail.runModeWorktree\")\r\n\t\t\t\t\t\t\t\t}>\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\tclassName={cn(\"am-run-mode-trigger-inline\", isMultiVersion && \"am-locked\")}\r\n\t\t\t\t\t\t\t\t\tonClick={() => !isMultiVersion && setIsDropdownOpen(!isDropdownOpen)}\r\n\t\t\t\t\t\t\t\t\tdisabled={isStarting || isMultiVersion}\r\n\t\t\t\t\t\t\t\t\ttype=\"button\">\r\n\t\t\t\t\t\t\t\t\t{effectiveRunMode === \"local\" ? <Folder size={14} /> : <GitBranch size={14} />}\r\n\t\t\t\t\t\t\t\t\t{!isMultiVersion && (\r\n\t\t\t\t\t\t\t\t\t\t<ChevronDown\r\n\t\t\t\t\t\t\t\t\t\t\tsize={10}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\"am-chevron\", isDropdownOpen && \"am-open\")}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t</StandardTooltip>\r\n\t\t\t\t\t\t\t{isDropdownOpen && !isMultiVersion && (\r\n\t\t\t\t\t\t\t\t<div className=\"am-run-mode-menu-inline\">\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\t\t\t\t\"am-run-mode-option-inline\",\r\n\t\t\t\t\t\t\t\t\t\t\trunMode === \"local\" && \"am-selected\",\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => handleSelectMode(\"local\")}\r\n\t\t\t\t\t\t\t\t\t\ttype=\"button\">\r\n\t\t\t\t\t\t\t\t\t\t<Folder size={12} />\r\n\t\t\t\t\t\t\t\t\t\t<span>{t(\"sessionDetail.runModeLocal\")}</span>\r\n\t\t\t\t\t\t\t\t\t\t{runMode === \"local\" && <span className=\"am-checkmark\"></span>}\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\t\t\t\t\"am-run-mode-option-inline\",\r\n\t\t\t\t\t\t\t\t\t\t\trunMode === \"worktree\" && \"am-selected\",\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => handleSelectMode(\"worktree\")}\r\n\t\t\t\t\t\t\t\t\t\ttype=\"button\">\r\n\t\t\t\t\t\t\t\t\t\t<GitBranch size={12} />\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"am-run-mode-label\">{t(\"sessionDetail.runModeWorktree\")}</span>\r\n\t\t\t\t\t\t\t\t\t\t{runMode === \"worktree\" && <span className=\"am-checkmark\"></span>}\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div ref={versionDropdownRef} className=\"am-run-mode-dropdown-inline relative\">\r\n\t\t\t\t\t\t\t<StandardTooltip content={t(\"sessionDetail.versionsTooltip\")}>\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\tclassName=\"am-run-mode-trigger-inline\"\r\n\t\t\t\t\t\t\t\t\tonClick={() => setIsVersionDropdownOpen(!isVersionDropdownOpen)}\r\n\t\t\t\t\t\t\t\t\tdisabled={isStarting}\r\n\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\ttitle={t(\"sessionDetail.versions\")}>\r\n\t\t\t\t\t\t\t\t\t<Layers size={14} />\r\n\t\t\t\t\t\t\t\t\t<span className=\"am-version-count\">{versionCount}</span>\r\n\t\t\t\t\t\t\t\t\t<ChevronDown\r\n\t\t\t\t\t\t\t\t\t\tsize={10}\r\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\"am-chevron\", isVersionDropdownOpen && \"am-open\")}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t</StandardTooltip>\r\n\t\t\t\t\t\t\t{isVersionDropdownOpen && (\r\n\t\t\t\t\t\t\t\t<div className=\"am-run-mode-menu-inline\">\r\n\t\t\t\t\t\t\t\t\t{VERSION_COUNT_OPTIONS.map((count) => (\r\n\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\tkey={count}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\"am-run-mode-option-inline\",\r\n\t\t\t\t\t\t\t\t\t\t\t\tversionCount === count && \"am-selected\",\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleSelectVersionCount(count)}\r\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span>{t(\"sessionDetail.versionCount\", { count })}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t{versionCount === count && <span className=\"am-checkmark\"></span>}\r\n\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t{effectiveRunMode === \"worktree\" && !isMultiVersion && (\r\n\t\t\t\t\t\t\t<StandardTooltip content={t(\"sessionDetail.branchPickerTooltip\")}>\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\tclassName=\"am-run-mode-trigger-inline\"\r\n\t\t\t\t\t\t\t\t\tonClick={() => setIsBranchPickerOpen(true)}\r\n\t\t\t\t\t\t\t\t\tdisabled={isStarting}\r\n\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\ttitle={t(\"sessionDetail.selectBranch\")}>\r\n\t\t\t\t\t\t\t\t\t<GitBranch size={14} />\r\n\t\t\t\t\t\t\t\t\t<span className=\"truncate max-w-[80px] text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t{selectedBranch || t(\"sessionDetail.selectBranch\")}\r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t<ChevronDown size={10} className=\"am-chevron\" />\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t</StandardTooltip>\r\n\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t\t\"relative inline-flex items-center justify-center\",\r\n\t\t\t\t\t\t\t\t\"bg-transparent border-none p-1.5\",\r\n\t\t\t\t\t\t\t\t\"rounded-md min-w-[28px] min-h-[28px]\",\r\n\t\t\t\t\t\t\t\t\"opacity-60 hover:opacity-100 text-vscode-descriptionForeground hover:text-vscode-foreground\",\r\n\t\t\t\t\t\t\t\t\"transition-all duration-150\",\r\n\t\t\t\t\t\t\t\t\"hover:bg-[rgba(255,255,255,0.03)] hover:border-[rgba(255,255,255,0.15)]\",\r\n\t\t\t\t\t\t\t\t\"focus:outline-none focus-visible:ring-1 focus-visible:ring-vscode-focusBorder\",\r\n\t\t\t\t\t\t\t\t\"active:bg-[rgba(255,255,255,0.1)]\",\r\n\t\t\t\t\t\t\t\t!isEmpty && !isStarting && \"cursor-pointer\",\r\n\t\t\t\t\t\t\t\t(isEmpty || isStarting) &&\r\n\t\t\t\t\t\t\t\t\t\"opacity-40 cursor-not-allowed grayscale-[30%] hover:bg-transparent hover:border-[rgba(255,255,255,0.08)] active:bg-transparent\",\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\tonClick={handleStart}\r\n\t\t\t\t\t\t\tdisabled={isEmpty || isStarting}\r\n\t\t\t\t\t\t\taria-label={isStarting ? t(\"sessionDetail.starting\") : t(\"sessionDetail.startAriaLabel\")}\r\n\t\t\t\t\t\t\ttitle={\r\n\t\t\t\t\t\t\t\tisMultiVersion\r\n\t\t\t\t\t\t\t\t\t? t(\"sessionDetail.launchVersions\", { count: versionCount })\r\n\t\t\t\t\t\t\t\t\t: t(\"sessionDetail.startAgent\")\r\n\t\t\t\t\t\t\t}>\r\n\t\t\t\t\t\t\t{isStarting ? <Loader2 size={16} className=\"am-spinning\" /> : <SendHorizontal size={16} />}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Hint Text inside input */}\r\n\t\t\t\t\t{!promptText && (\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclassName=\"absolute left-3 right-[140px] z-30 flex items-center h-8 overflow-hidden text-ellipsis whitespace-nowrap\"\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\tbottom: \"0.25rem\",\r\n\t\t\t\t\t\t\t\tcolor: \"var(--vscode-descriptionForeground)\",\r\n\t\t\t\t\t\t\t\topacity: 0.7,\r\n\t\t\t\t\t\t\t\tfontSize: \"11px\",\r\n\t\t\t\t\t\t\t\tuserSelect: \"none\",\r\n\t\t\t\t\t\t\t\tpointerEvents: \"none\",\r\n\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t{t(\"sessionDetail.keyboardHint\")}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t{isBranchPickerOpen && (\r\n\t\t\t\t<BranchPicker\r\n\t\t\t\t\tselectedBranch={selectedBranch}\r\n\t\t\t\t\tonSelect={setSelectedBranch}\r\n\t\t\t\t\tonClose={() => setIsBranchPickerOpen(false)}\r\n\t\t\t\t/>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t)\r\n}\r\n",
    "import React from \"react\"\r\nimport { Provider, useAtomValue } from \"jotai\"\r\nimport { useAgentManagerMessages } from \"../state/hooks\"\r\nimport { useMessageQueueProcessor } from \"../state/hooks/useMessageQueueProcessor\"\r\nimport { selectedSessionIdAtom } from \"../state/atoms/sessions\"\r\nimport { SessionSidebar } from \"./SessionSidebar\"\r\nimport { SessionDetail } from \"./SessionDetail\"\r\nimport { TooltipProvider } from \"../../../components/ui/tooltip\"\r\nimport { STANDARD_TOOLTIP_DELAY } from \"../../../components/ui/standard-tooltip\"\r\nimport \"./AgentManagerApp.css\"\r\n\r\n/**\r\n * Root component for the Agent Manager webview.\r\n * Wraps everything in Jotai Provider and sets up message handling.\r\n */\r\nexport function AgentManagerApp() {\r\n\treturn (\r\n\t\t<Provider>\r\n\t\t\t<TooltipProvider delayDuration={STANDARD_TOOLTIP_DELAY}>\r\n\t\t\t\t<AgentManagerContent />\r\n\t\t\t</TooltipProvider>\r\n\t\t</Provider>\r\n\t)\r\n}\r\n\r\nfunction AgentManagerContent() {\r\n\t// Bridge VS Code IPC messages to Jotai state\r\n\tuseAgentManagerMessages()\r\n\r\n\t// Get the currently selected session\r\n\tconst selectedSessionId = useAtomValue(selectedSessionIdAtom)\r\n\r\n\t// Process the message queue for the selected session\r\n\t// Hook must always be called, but will skip processing if no session selected\r\n\tuseMessageQueueProcessor(selectedSessionId)\r\n\r\n\treturn (\r\n\t\t<div className=\"agent-manager-container\">\r\n\t\t\t<SessionSidebar />\r\n\t\t\t<SessionDetail />\r\n\t\t</div>\r\n\t)\r\n}\r\n",
    "import React from \"react\"\r\nimport { createRoot } from \"react-dom/client\"\r\nimport { I18nextProvider } from \"react-i18next\"\r\nimport i18next, { loadTranslations } from \"../../i18n/setup\"\r\nimport ErrorBoundary from \"../../components/ErrorBoundary\"\r\nimport { AgentManagerApp } from \"./components/AgentManagerApp\"\r\nimport \"../../../node_modules/@vscode/codicons/dist/codicon.css\"\r\nimport \"../../index.css\"\r\n\r\n// Initialize i18n translations\r\nloadTranslations()\r\n\r\n// Mount the Agent Manager React app\r\nconst container = document.getElementById(\"root\")\r\nif (container) {\r\n\tconst root = createRoot(container)\r\n\troot.render(\r\n\t\t<React.StrictMode>\r\n\t\t\t<I18nextProvider i18n={i18next}>\r\n\t\t\t\t<div className=\"am-app-wrapper\">\r\n\t\t\t\t\t<ErrorBoundary>\r\n\t\t\t\t\t\t<AgentManagerApp />\r\n\t\t\t\t\t</ErrorBoundary>\r\n\t\t\t\t</div>\r\n\t\t\t</I18nextProvider>\r\n\t\t</React.StrictMode>,\r\n\t)\r\n}\r\n\r\n// Notify extension that webview is ready\r\nimport { vscode } from \"./utils/vscode\"\r\nvscode.postMessage({ type: \"agentManager.webviewReady\" })\r\n"
  ],
  "names": [
    "I18nextProvider",
    "i18n",
    "defaultNS",
    "children",
    "value",
    "useMemo",
    "createElement",
    "I18nContext",
    "__iconNode",
    "ArrowRightLeft",
    "createLucideIcon",
    "CircleAlert",
    "CircleCheck",
    "Circle",
    "Layers",
    "Loader",
    "RefreshCw",
    "Terminal",
    "hasInitialValue",
    "atom",
    "isActuallyWritableAtom",
    "isAtomStateInitialized",
    "atomState",
    "returnAtomValue",
    "__vite_import_meta_env__",
    "promiseStateMap",
    "isPendingPromise",
    "_a",
    "isPromiseLike",
    "abortPromise",
    "promise",
    "promiseState",
    "fn",
    "registerAbortHandler",
    "abortHandler",
    "settle",
    "p",
    "addPendingPromiseToDependency",
    "dependencyAtomState",
    "cleanup",
    "getMountedOrPendingDependents",
    "mountedMap",
    "dependents",
    "a",
    "atomWithPendingPromise",
    "atomRead",
    "_store",
    "params",
    "atomWrite",
    "atomOnInit",
    "store",
    "atomOnMount",
    "setAtom",
    "ensureAtomState",
    "buildingBlocks",
    "getInternalBuildingBlocks",
    "atomStateMap",
    "storeHooks",
    "atomOnInit2",
    "flushCallbacks",
    "changedAtoms",
    "mountCallbacks",
    "unmountCallbacks",
    "recomputeInvalidatedAtoms2",
    "errors",
    "call",
    "e",
    "callbacks",
    "add",
    "recomputeInvalidatedAtoms",
    "invalidatedAtoms",
    "ensureAtomState2",
    "readAtomState2",
    "mountDependencies2",
    "topSortedReversed",
    "visiting",
    "visited",
    "stack",
    "aState",
    "d",
    "i",
    "hasChangedDeps",
    "dep",
    "storeMutationSet",
    "readAtomState",
    "_b",
    "atomRead2",
    "flushCallbacks2",
    "writeAtomState2",
    "n",
    "isSync",
    "mountDependenciesIfAsync",
    "getter",
    "_a2",
    "aState2",
    "setAtomStateValueOrPromise",
    "controller",
    "setSelf",
    "options",
    "args",
    "prevEpochNumber",
    "valueOrPromise",
    "error",
    "invalidateDependents",
    "dState",
    "writeAtomState",
    "atomWrite2",
    "invalidateDependents2",
    "setter",
    "args2",
    "v",
    "mountDependencies",
    "mountAtom2",
    "unmountAtom2",
    "mounted",
    "aMounted",
    "mountAtom",
    "atomOnMount2",
    "processOnMount",
    "onUnmount",
    "unmountAtom",
    "hasPrevValue",
    "prevValue",
    "storeGet",
    "storeSet",
    "storeSub",
    "listener",
    "listeners",
    "buildingBlockMap",
    "buildStore",
    "buildArgs",
    "storeGet2",
    "storeSet2",
    "storeSub2",
    "keyCount",
    "read",
    "write",
    "key",
    "config",
    "defaultRead",
    "defaultWrite",
    "get",
    "set",
    "arg",
    "createStore",
    "INTERNAL_buildStoreRev2",
    "defaultStore",
    "getDefaultStore",
    "StoreContext",
    "createContext",
    "useStore",
    "useContext",
    "Provider",
    "storeRef",
    "useRef",
    "x",
    "attachPromiseStatus",
    "use",
    "React",
    "continuablePromiseMap",
    "createContinuablePromise",
    "getValue",
    "continuablePromise",
    "resolve",
    "reject",
    "curr",
    "onFulfilled",
    "me",
    "onRejected",
    "onAbort",
    "nextValue",
    "INTERNAL_registerAbortHandler",
    "useAtomValue",
    "delay",
    "promiseStatus",
    "valueFromReducer",
    "storeFromReducer",
    "atomFromReducer",
    "rerender",
    "useReducer",
    "prev",
    "useEffect",
    "unsub",
    "value2",
    "useDebugValue",
    "useSetAtom",
    "useCallback",
    "useAtom",
    "atomFamily",
    "initializeAtom",
    "areEqual",
    "shouldRemove",
    "atoms",
    "createAtom",
    "param",
    "item",
    "newAtom",
    "notifyListeners",
    "type",
    "callback",
    "createdAt",
    "isPromiseLike$3",
    "createJSONStorage",
    "getStringStorage",
    "lastStr",
    "lastValue",
    "storage",
    "initialValue",
    "parse",
    "str2",
    "str",
    "newValue",
    "createHandleSubscribe",
    "subscriber2",
    "subscriber",
    "storageEventCallback",
    "SessionState",
    "createInitialContext",
    "createSessionStateMachine",
    "state",
    "context",
    "event",
    "nextState",
    "contextUpdate",
    "transition",
    "currentState",
    "transitionFromIdle",
    "transitionFromCreating",
    "transitionFromStreaming",
    "transitionFromWaitingApproval",
    "transitionFromWaitingInput",
    "transitionFromCompleted",
    "transitionFromPaused",
    "transitionFromError",
    "transitionFromStopped",
    "newContext",
    "sessionsMapAtom",
    "sessionOrderAtom",
    "selectedSessionIdAtom",
    "remoteSessionsAtom",
    "isRefreshingRemoteSessionsAtom",
    "pendingSessionAtom",
    "startSessionFailedCounterAtom",
    "sessionInputAtomFamily",
    "_sessionId",
    "preferredRunModeAtom",
    "MAX_VERSION_COUNT",
    "VERSION_COUNT_OPTIONS",
    "_",
    "versionCountAtom",
    "generateVersionLabels",
    "baseLabel",
    "count",
    "sessionsArrayAtom",
    "map",
    "id",
    "s",
    "toAgentSession",
    "remote",
    "createdTime",
    "updatedTime",
    "mergedSessionsAtom",
    "localSessions",
    "remoteSessions",
    "localSessionIds",
    "remoteAsDisplay",
    "rs",
    "selectedSessionAtom",
    "localSession",
    "remoteSession",
    "upsertSessionAtom",
    "session",
    "current",
    "order",
    "isNewSession",
    "removeSessionAtom",
    "sessionId",
    "rest",
    "remaining",
    "payload",
    "_get",
    "sessions",
    "sessionStateMachines",
    "getOrCreateMachine",
    "machine",
    "sessionMachineStateAtom",
    "sessionMachineUiStateAtom",
    "sendSessionEventAtom",
    "currentStates",
    "currentUiStates",
    "cleanupSessionMachineAtom",
    "_set",
    "selectedSessionMachineStateAtom",
    "uiStates",
    "sessionMessagesAtomFamily",
    "sessionMessageVersionsAtomFamily",
    "messages",
    "updateSessionMessagesAtom",
    "versions",
    "reconciled",
    "reconcileMessages",
    "newVersions",
    "m",
    "getContentLength",
    "previous",
    "msg",
    "isNew",
    "becameComplete",
    "messageToEvent",
    "message",
    "idx",
    "newMessages",
    "_c",
    "incoming",
    "currentMap",
    "incomingMsg",
    "existing",
    "currentLen",
    "partial",
    "sessionTodosAtomFamily",
    "computeTodoStats",
    "todos",
    "completedCount",
    "t",
    "totalCount",
    "inProgressTodo",
    "nextPendingTodo",
    "currentTodo",
    "allCompleted",
    "progressPercent",
    "sessionTodoStatsAtomFamily",
    "updateSessionTodosAtom",
    "branchesAtom",
    "currentBranchAtom",
    "updateBranchesAtom",
    "branches",
    "currentBranch",
    "extractTodosFromMessages",
    "metadata",
    "mapToStateMachineEvent",
    "eventType",
    "useAgentManagerMessages",
    "updateSessionMessages",
    "updateSessionTodos",
    "updateBranches",
    "upsertSession",
    "removeSession",
    "setSelectedSessionId",
    "setStartSessionFailedCounter",
    "setRemoteSessions",
    "setPendingSession",
    "setIsRefreshingRemoteSessions",
    "sendSessionEvent",
    "cleanupSessionMachine",
    "sessionOrder",
    "hasInitializedSelection",
    "knownSessionsRef",
    "handleMessage",
    "extensionSessionIds",
    "c",
    "pendingSession",
    "generateId",
    "sessionMessageQueueAtomFamily",
    "sessionSendingMessageIdAtomFamily",
    "addToQueueAtom",
    "content",
    "queue",
    "newMessage",
    "updateMessageStatusAtom",
    "messageId",
    "status",
    "updated",
    "removeFromQueueAtom",
    "filtered",
    "retryFailedMessageAtom",
    "setSendingMessageAtom",
    "vsCodeApi",
    "getVSCodeApi",
    "vscode",
    "useMessageQueueProcessor",
    "sendingMessageId",
    "updateStatus",
    "removeFromQueue",
    "setSendingMessage",
    "sendNextMessage",
    "eventSessionId",
    "queuedMsg",
    "formatRelativeTime",
    "timestamp",
    "labels",
    "diff",
    "seconds",
    "minutes",
    "hours",
    "days",
    "weeks",
    "createRelativeTimeLabels",
    "SessionSidebar",
    "useTranslation",
    "selectedId",
    "setSelectedId",
    "isRefreshing",
    "setIsRefreshing",
    "machineUiState",
    "handleNewSession",
    "handleSelectSession",
    "handleRefresh",
    "isNewAgentSelected",
    "jsxs",
    "jsx",
    "Plus",
    "Loader2",
    "PendingSessionItem",
    "SessionItem",
    "isSelected",
    "onSelect",
    "uiState",
    "timeLabels",
    "showShareConfirm",
    "setShowShareConfirm",
    "useState",
    "isHovered",
    "setIsHovered",
    "showSpinner",
    "isActive",
    "isWorktree",
    "branchName",
    "isCompleted",
    "handleShareClick",
    "handleShareConfirm",
    "handleShareCancel",
    "GitBranch",
    "Folder",
    "Share2",
    "SimpleMarkdown",
    "ReactMarkdown",
    "remarkGfm",
    "FollowUpSuggestions",
    "suggestions",
    "onSuggestionClick",
    "onCopyToInput",
    "suggestion",
    "index",
    "StandardTooltip",
    "ClipboardCopy",
    "parseCommandAndOutput",
    "text",
    "COMMAND_OUTPUT_STRING",
    "output",
    "line",
    "sanitizeOutput",
    "raw",
    "CommandExecutionBlock",
    "memo",
    "isRunning",
    "isLast",
    "exitCode",
    "terminalStatus",
    "command",
    "rawOutput",
    "isExpanded",
    "setIsExpanded",
    "copied",
    "setCopied",
    "hasOutput",
    "hasOutputMarker",
    "isError",
    "handleCopy",
    "StatusIndicator",
    "Check",
    "Copy",
    "ChevronDown",
    "cn",
    "parseExitCode",
    "extractCommandMetadata",
    "MessageList",
    "setInputValue",
    "retryFailedMessage",
    "virtuosoRef",
    "combinedMessages",
    "combineCommandSequences",
    "commandExecutionByTs",
    "info",
    "data",
    "j",
    "next",
    "handleSuggestionClick",
    "handleCopyToInput",
    "handleRetryMessage",
    "handleDiscardMessage",
    "allItems",
    "q",
    "itemContent",
    "QueuedMessageItem",
    "isLastCombinedMessage",
    "MessageItem",
    "MessageCircle",
    "Virtuoso",
    "extractFollowUpData",
    "messageText",
    "parsedData",
    "safeJsonParse",
    "question",
    "icon",
    "title",
    "extraInfo",
    "User",
    "CheckCircle2",
    "AlertCircle",
    "MessageCircleQuestion",
    "followUpData",
    "TerminalSquare",
    "execInfo",
    "toolInfo",
    "toolDetails",
    "queuedMessage",
    "_isSending",
    "onRetry",
    "onDiscard",
    "Clock",
    "statusText",
    "statusColor",
    "handleRetry",
    "handleDiscard",
    "canRetry",
    "TodoIcon",
    "size",
    "iconSize",
    "checkSize",
    "AgentTodoList",
    "stats",
    "isIntegrated",
    "listRef",
    "inProgressIdx",
    "target",
    "ChevronUp",
    "todo",
    "ChatInput",
    "sessionLabel",
    "showCancel",
    "showFinishToBranch",
    "worktreeBranchName",
    "sessionStatus",
    "setMessageText",
    "todoStats",
    "isFocused",
    "setIsFocused",
    "textareaRef",
    "addToQueue",
    "trimmedMessage",
    "isEmpty",
    "isSessionCompleted",
    "sendDisabled",
    "handleSend",
    "handleCancel",
    "handleFinishToBranch",
    "handleKeyDown",
    "hasTodos",
    "DynamicTextArea",
    "Square",
    "SendHorizontal",
    "BranchPicker",
    "selectedBranch",
    "onClose",
    "yourBranches",
    "otherBranches",
    "b",
    "handleSelect",
    "branch",
    "handleBackdropClick",
    "Command",
    "CommandInput",
    "CommandList",
    "CommandEmpty",
    "CommandGroup",
    "CommandItem",
    "CommandSeparator",
    "KiloLogo",
    "SessionDetail",
    "selectedSession",
    "selectedSessionState",
    "prevSessionStateRef",
    "prevState",
    "PendingSessionView",
    "NewAgentForm",
    "sessionUiState",
    "isProvisionalSession",
    "isSessionRunning",
    "canFinishWorktree",
    "Zap",
    "X",
    "promptText",
    "setPromptText",
    "runMode",
    "setRunMode",
    "versionCount",
    "setVersionCount",
    "isStarting",
    "setIsStarting",
    "isDropdownOpen",
    "setIsDropdownOpen",
    "isVersionDropdownOpen",
    "setIsVersionDropdownOpen",
    "setSelectedBranch",
    "isBranchPickerOpen",
    "setIsBranchPickerOpen",
    "dropdownRef",
    "versionDropdownRef",
    "startSessionFailedCounter",
    "isMultiVersion",
    "effectiveRunMode",
    "handleClickOutside",
    "trimmedPrompt",
    "handleStart",
    "handleSelectMode",
    "mode",
    "handleSelectVersionCount",
    "AgentManagerApp",
    "TooltipProvider",
    "STANDARD_TOOLTIP_DELAY",
    "AgentManagerContent",
    "selectedSessionId",
    "loadTranslations",
    "container",
    "createRoot",
    "i18next",
    "ErrorBoundary"
  ],
  "mappings": "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",
  "x_google_ignoreList": [
    0,
    1,
    2,
    3,
    4,
    5,
    6,
    7,
    8,
    9,
    10,
    11,
    12
  ],
  "sourceRoot": ""
}