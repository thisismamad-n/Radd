import{r as x,I as lt,c as K,R as je,u as B,j as n,S as Q,b as Y,C as dt,e as X,f as N,a as Te,g as ut,h as mt,i as pt,k as ht,l as ft,m as Ee,n as ze,o as gt,X as xt,T as vt,p as bt,q as yt,d as wt,s as _t,E as kt}from"./chunk-D16GF57l.js";import{P as St,L as q,G as U,F as ne,S as jt,M as Nt,r as Mt,C as At,a as ge,c as Ct,b as xe,K as It,s as ve,d as Be,U as Tt,e as Et,i as qe,f as zt,g as Oe,Z as Bt}from"./chunk-BAst9BU6.js";import"./mermaid-bundle.js";function Dt({i18n:e,defaultNS:t,children:s}){const o=x.useMemo(()=>({i18n:e,defaultNS:t}),[e,t]);return x.createElement(lt.Provider,{value:o},s)}/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],Ft=K("arrow-right-left",Rt);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ne=K("circle-alert",Lt);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Ot=K("circle-check",qt);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Wt=K("circle",Pt);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Ut=K("layers",Vt);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],Ht=K("loader",$t);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Qt=K("refresh-cw",Kt);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],Jt=K("terminal",Zt),V={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function Pe(e){return"init"in e}function be(e){return!!e.write}function De(e){return"v"in e||"e"in e}function oe(e){if("e"in e)throw e.e;if((V?"production":void 0)!=="production"&&!("v"in e))throw new Error("[Bug] atom state is not initialized");return e.v}const ae=new WeakMap;function We(e){var t;return re(e)&&!!((t=ae.get(e))!=null&&t[0])}function Gt(e){const t=ae.get(e);t!=null&&t[0]&&(t[0]=!1,t[1].forEach(s=>s()))}function ye(e,t){let s=ae.get(e);if(!s){s=[!0,new Set],ae.set(e,s);const o=()=>{s[0]=!1};e.then(o,o)}s[1].add(t)}function re(e){return typeof(e==null?void 0:e.then)=="function"}function Ve(e,t,s){if(!s.p.has(e)){s.p.add(e);const o=()=>s.p.delete(e);t.then(o,o)}}function Ue(e,t,s){var o;const a=new Set;for(const r of((o=s.get(e))==null?void 0:o.t)||[])s.has(r)&&a.add(r);for(const r of t.p)a.add(r);return a}const Xt=(e,t,...s)=>t.read(...s),Yt=(e,t,...s)=>t.write(...s),es=(e,t)=>{var s;return(s=t.unstable_onInit)==null?void 0:s.call(t,e)},ts=(e,t,s)=>{var o;return(o=t.onMount)==null?void 0:o.call(t,s)},ss=(e,t)=>{var s;const o=z(e),a=o[0],r=o[6],l=o[9];if((V?"production":void 0)!=="production"&&!t)throw new Error("Atom is undefined or null");let i=a.get(t);return i||(i={d:new Map,p:new Set,n:0},a.set(t,i),(s=r.i)==null||s.call(r,t),l==null||l(e,t)),i},ns=e=>{const t=z(e),s=t[1],o=t[3],a=t[4],r=t[5],l=t[6],i=t[13],c=[],u=d=>{try{d()}catch(p){c.push(p)}};do{l.f&&u(l.f);const d=new Set,p=d.add.bind(d);o.forEach(m=>{var h;return(h=s.get(m))==null?void 0:h.l.forEach(p)}),o.clear(),r.forEach(p),r.clear(),a.forEach(p),a.clear(),d.forEach(u),o.size&&i(e)}while(o.size||r.size||a.size);if(c.length)throw new AggregateError(c)},os=e=>{const t=z(e),s=t[1],o=t[2],a=t[3],r=t[11],l=t[14],i=t[17],c=[],u=new WeakSet,d=new WeakSet,p=Array.from(a);for(;p.length;){const m=p[p.length-1],h=r(e,m);if(d.has(m)){p.pop();continue}if(u.has(m)){if(o.get(m)===h.n)c.push([m,h]);else if((V?"production":void 0)!=="production"&&o.has(m))throw new Error("[Bug] invalidated atom exists");d.add(m),p.pop();continue}u.add(m);for(const b of Ue(m,h,s))u.has(b)||p.push(b)}for(let m=c.length-1;m>=0;--m){const[h,b]=c[m];let k=!1;for(const v of b.d.keys())if(v!==h&&a.has(v)){k=!0;break}k&&(l(e,h),i(e,h)),o.delete(h)}},we=new WeakSet,as=(e,t)=>{var s,o;const a=z(e),r=a[1],l=a[2],i=a[3],c=a[6],u=a[7],d=a[11],p=a[12],m=a[13],h=a[14],b=a[16],k=a[17],v=d(e,t);if(De(v)&&(r.has(t)&&l.get(t)!==v.n||Array.from(v.d).every(([S,W])=>h(e,S).n===W)))return v;v.d.clear();let y=!0;function g(){r.has(t)&&(k(e,t),m(e),p(e))}function j(S){var W;if(S===t){const se=d(e,S);if(!De(se))if(Pe(S))ie(e,S,S.init);else throw new Error("no atom init");return oe(se)}const J=h(e,S);try{return oe(J)}finally{v.d.set(S,J.n),We(v.v)&&Ve(t,v.v,J),(W=r.get(S))==null||W.t.add(t),y||g()}}let _,M;const I={get signal(){return _||(_=new AbortController),_.signal},get setSelf(){return(V?"production":void 0)!=="production"&&!be(t)&&console.warn("setSelf function cannot be used with read-only atom"),!M&&be(t)&&(M=(...S)=>{if((V?"production":void 0)!=="production"&&y&&console.warn("setSelf function cannot be called in sync"),!y)try{return b(e,t,...S)}finally{m(e),p(e)}}),M}},D=v.n;try{(V?"production":void 0)!=="production"&&we.delete(e);const S=u(e,t,j,I);return(V?"production":void 0)!=="production"&&we.has(e)&&console.warn("Detected store mutation during atom read. This is not supported."),ie(e,t,S),re(S)&&(ye(S,()=>_==null?void 0:_.abort()),S.then(g,g)),(s=c.r)==null||s.call(c,t),v}catch(S){return delete v.v,v.e=S,++v.n,v}finally{y=!1,D!==v.n&&l.get(t)===D&&(l.set(t,v.n),i.add(t),(o=c.c)==null||o.call(c,t))}},rs=(e,t)=>{const s=z(e),o=s[1],a=s[2],r=s[11],l=[t];for(;l.length;){const i=l.pop(),c=r(e,i);for(const u of Ue(i,c,o)){const d=r(e,u);a.set(u,d.n),l.push(u)}}},$e=(e,t,...s)=>{const o=z(e),a=o[3],r=o[6],l=o[8],i=o[11],c=o[12],u=o[13],d=o[14],p=o[15],m=o[17];let h=!0;const b=v=>oe(d(e,v)),k=(v,...y)=>{var g;const j=i(e,v);try{if(v===t){if(!Pe(v))throw new Error("atom not writable");(V?"production":void 0)!=="production"&&we.add(e);const _=j.n,M=y[0];ie(e,v,M),m(e,v),_!==j.n&&(a.add(v),(g=r.c)==null||g.call(r,v),p(e,v));return}else return $e(e,v,...y)}finally{h||(u(e),c(e))}};try{return l(e,t,b,k,...s)}finally{h=!1}},is=(e,t)=>{var s;const o=z(e),a=o[1],r=o[3],l=o[6],i=o[11],c=o[15],u=o[18],d=o[19],p=i(e,t),m=a.get(t);if(m&&!We(p.v)){for(const[h,b]of p.d)if(!m.d.has(h)){const k=i(e,h);u(e,h).t.add(t),m.d.add(h),b!==k.n&&(r.add(h),(s=l.c)==null||s.call(l,h),c(e,h))}for(const h of m.d||[])if(!p.d.has(h)){m.d.delete(h);const b=d(e,h);b==null||b.t.delete(t)}}},He=(e,t)=>{var s;const o=z(e),a=o[1],r=o[4],l=o[6],i=o[10],c=o[11],u=o[12],d=o[13],p=o[14],m=o[16],h=c(e,t);let b=a.get(t);if(!b){p(e,t);for(const k of h.d.keys())He(e,k).t.add(t);if(b={l:new Set,d:new Set(h.d.keys()),t:new Set},a.set(t,b),(s=l.m)==null||s.call(l,t),be(t)){const k=()=>{let v=!0;const y=(...g)=>{try{return m(e,t,...g)}finally{v||(d(e),u(e))}};try{const g=i(e,t,y);g&&(b.u=()=>{v=!0;try{g()}finally{v=!1}})}finally{v=!1}};r.add(k)}}return b},cs=(e,t)=>{var s;const o=z(e),a=o[1],r=o[5],l=o[6],i=o[11],c=o[19],u=i(e,t);let d=a.get(t);if(d&&!d.l.size&&!Array.from(d.t).some(p=>{var m;return(m=a.get(p))==null?void 0:m.d.has(t)})){d.u&&r.add(d.u),d=void 0,a.delete(t),(s=l.u)==null||s.call(l,t);for(const p of u.d.keys()){const m=c(e,p);m==null||m.t.delete(t)}return}return d},ie=(e,t,s)=>{const o=z(e)[11],a=o(e,t),r="v"in a,l=a.v;if(re(s))for(const i of a.d.keys())Ve(t,s,o(e,i));a.v=s,delete a.e,(!r||!Object.is(l,a.v))&&(++a.n,re(l)&&Gt(l))},ls=(e,t)=>{const s=z(e)[14];return oe(s(e,t))},ds=(e,t,...s)=>{const o=z(e),a=o[12],r=o[13],l=o[16];try{return l(e,t,...s)}finally{r(e),a(e)}},us=(e,t,s)=>{const o=z(e),a=o[12],r=o[18],l=o[19],c=r(e,t).l;return c.add(s),a(e),()=>{c.delete(s),l(e,t),a(e)}},Ke=new WeakMap,z=e=>{const t=Ke.get(e);if((V?"production":void 0)!=="production"&&!t)throw new Error("Store must be created by buildStore to read its building blocks");return t};function ms(...e){const t={get(o){const a=z(t)[21];return a(t,o)},set(o,...a){const r=z(t)[22];return r(t,o,...a)},sub(o,a){const r=z(t)[23];return r(t,o,a)}},s=[new WeakMap,new WeakMap,new WeakMap,new Set,new Set,new Set,{},Xt,Yt,es,ts,ss,ns,os,as,rs,$e,is,He,cs,ie,ls,ds,us,void 0].map((o,a)=>e[a]||o);return Ke.set(t,Object.freeze(s)),t}const Qe={};let ps=0;function w(e,t){const s=`atom${++ps}`,o={toString(){return(Qe?"production":void 0)!=="production"&&this.debugLabel?s+":"+this.debugLabel:s}};return typeof e=="function"?o.read=e:(o.init=e,o.read=hs,o.write=fs),t&&(o.write=t),o}function hs(e){return e(this)}function fs(e,t,s){return t(this,typeof s=="function"?s(e(this)):s)}function Ze(){return ms()}let G;function gs(){return G||(G=Ze(),(Qe?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=G),globalThis.__JOTAI_DEFAULT_STORE__!==G&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),G}const xs={},_e=x.createContext(void 0);function Je(e){return x.useContext(_e)||gs()}function vs({children:e,store:t}){const s=x.useRef(null);return t?x.createElement(_e.Provider,{value:t},e):(s.current===null&&(s.current=Ze()),x.createElement(_e.Provider,{value:s.current},e))}const ke=e=>typeof(e==null?void 0:e.then)=="function",Se=e=>{e.status||(e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}))},bs=je.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(Se(e),e)}),pe=new WeakMap,Re=(e,t)=>{let s=pe.get(e);return s||(s=new Promise((o,a)=>{let r=e;const l=u=>d=>{r===u&&o(d)},i=u=>d=>{r===u&&a(d)},c=()=>{try{const u=t();ke(u)?(pe.set(u,s),r=u,u.then(l(u),i(u)),ye(u,c)):o(u)}catch(u){a(u)}};e.then(l(e),i(e)),ye(e,c)}),pe.set(e,s)),s};function T(e,t){const{delay:s,unstable_promiseStatus:o=!je.use}={},a=Je(),[[r,l,i],c]=x.useReducer(d=>{const p=a.get(e);return Object.is(d[0],p)&&d[1]===a&&d[2]===e?d:[p,a,e]},void 0,()=>[a.get(e),a,e]);let u=r;if((l!==a||i!==e)&&(c(),u=a.get(e)),x.useEffect(()=>{const d=a.sub(e,()=>{if(o)try{const p=a.get(e);ke(p)&&Se(Re(p,()=>a.get(e)))}catch{}if(typeof s=="number"){setTimeout(c,s);return}c()});return c(),d},[a,e,s,o]),x.useDebugValue(u),ke(u)){const d=Re(u,()=>a.get(e));return o&&Se(d),bs(d)}return u}function C(e,t){const s=Je();return x.useCallback((...a)=>{if((xs?"production":void 0)!=="production"&&!("write"in e))throw new Error("not writable atom");return s.set(e,...a)},[s,e])}function ce(e,t){return[T(e),C(e)]}const ys={};function F(e,t){let s=null;const o=new Map,a=new Set,r=i=>{let c;if(c=o.get(i),c!==void 0)if(s!=null&&s(c[1],i))r.remove(i);else return c[0];const u=e(i);return o.set(i,[u,Date.now()]),l("CREATE",i,u),u},l=(i,c,u)=>{for(const d of a)d({type:i,param:c,atom:u})};return r.unstable_listen=i=>(a.add(i),()=>{a.delete(i)}),r.getParams=()=>o.keys(),r.remove=i=>{{if(!o.has(i))return;const[c]=o.get(i);o.delete(i),l("REMOVE",i,c)}},r.setShouldRemove=i=>{if(s=i,!!s)for(const[c,[u,d]]of o)s(d,c)&&(o.delete(c),l("REMOVE",c,u))},r}const ws=e=>typeof(e==null?void 0:e.then)=="function";function _s(e=()=>{try{return window.localStorage}catch(s){(ys?"production":void 0)!=="production"&&typeof window<"u"&&console.warn(s);return}},t){var s;let o,a;const r={getItem:(c,u)=>{var d,p;const m=b=>{if(b=b||"",o!==b){try{a=JSON.parse(b,t==null?void 0:t.reviver)}catch{return u}o=b}return a},h=(p=(d=e())==null?void 0:d.getItem(c))!=null?p:null;return ws(h)?h.then(m):m(h)},setItem:(c,u)=>{var d;return(d=e())==null?void 0:d.setItem(c,JSON.stringify(u,void 0))},removeItem:c=>{var u;return(u=e())==null?void 0:u.removeItem(c)}},l=c=>(u,d,p)=>c(u,m=>{let h;try{h=JSON.parse(m||"")}catch{h=p}d(h)});let i;try{i=(s=e())==null?void 0:s.subscribe}catch{}return!i&&typeof window<"u"&&typeof window.addEventListener=="function"&&window.Storage&&(i=(c,u)=>{if(!(e()instanceof window.Storage))return()=>{};const d=p=>{p.storageArea===e()&&p.key===c&&u(p.newValue)};return window.addEventListener("storage",d),()=>{window.removeEventListener("storage",d)}}),i&&(r.subscribe=l(i)),r}_s();const f={idle:"idle",creating:"creating",streaming:"streaming",waiting_approval:"waiting_approval",waiting_input:"waiting_input",completed:"completed",paused:"paused",error:"error",stopped:"stopped"};function Fe(){return{sessionId:void 0,errorMessage:void 0,sawApiReqStarted:!1,sawSessionCreated:!1}}function ks(){let e=f.idle,t=Fe();return{getState:()=>e,send:i=>{const{nextState:c,contextUpdate:u}=Ss(e,i,t);e=c,u&&(t={...t,...u})},getUiState:()=>({showSpinner:e===f.creating||e===f.streaming,showCancelButton:e===f.creating||e===f.streaming||e===f.waiting_approval||e===f.waiting_input,isActive:e===f.creating||e===f.streaming||e===f.waiting_approval||e===f.waiting_input}),getContext:()=>({...t}),reset:()=>{e=f.idle,t=Fe()}}}function Ss(e,t,s){switch(e){case f.idle:return js(t);case f.creating:return Ns(t,s);case f.streaming:return Ms(t);case f.waiting_approval:return As(t);case f.waiting_input:return Cs(t);case f.completed:return Is(t);case f.paused:return Ts(t);case f.error:return Es(t);case f.stopped:return zs(t);default:return{nextState:e}}}function js(e){switch(e.type){case"start_session":return{nextState:f.creating};case"session_created":return{nextState:f.streaming,contextUpdate:{sawSessionCreated:!0,sessionId:e.sessionId}};case"api_req_started":return{nextState:f.streaming,contextUpdate:{sawApiReqStarted:!0}};default:return{nextState:f.idle}}}function Ns(e,t){switch(e.type){case"session_created":{const s={sawSessionCreated:!0,sessionId:e.sessionId};return t.sawApiReqStarted?{nextState:f.streaming,contextUpdate:s}:{nextState:f.creating,contextUpdate:s}}case"api_req_started":{const s={sawApiReqStarted:!0};return t.sawSessionCreated?{nextState:f.streaming,contextUpdate:s}:{nextState:f.creating,contextUpdate:s}}case"process_error":return{nextState:f.error,contextUpdate:{errorMessage:e.error}};case"cancel_session":return{nextState:f.stopped};default:return{nextState:f.creating}}}function Ms(e){switch(e.type){case"say_text":return{nextState:f.streaming};case"api_req_started":return{nextState:f.streaming};case"ask_tool":case"ask_command":case"ask_browser_action_launch":case"ask_use_mcp_server":return e.partial?{nextState:f.streaming}:{nextState:f.waiting_approval};case"ask_followup":return{nextState:f.waiting_input};case"ask_completion_result":return{nextState:f.completed};case"ask_api_req_failed":case"ask_mistake_limit_reached":case"ask_invalid_model":case"ask_payment_required_prompt":return{nextState:f.error};case"ask_resume_task":return{nextState:f.paused};case"cancel_session":return{nextState:f.stopped};default:return{nextState:f.streaming}}}function As(e){switch(e.type){case"approve_action":case"reject_action":case"api_req_started":return{nextState:f.streaming};case"cancel_session":return{nextState:f.stopped};default:return{nextState:f.waiting_approval}}}function Cs(e){switch(e.type){case"api_req_started":return{nextState:f.streaming};case"send_message":return{nextState:f.streaming};case"cancel_session":return{nextState:f.stopped};default:return{nextState:f.waiting_input}}}function Is(e){switch(e.type){case"api_req_started":return{nextState:f.streaming};case"send_message":return{nextState:f.streaming};case"start_session":return{nextState:f.creating};default:return{nextState:f.completed}}}function Ts(e){switch(e.type){case"api_req_started":return{nextState:f.streaming};case"cancel_session":return{nextState:f.stopped};default:return{nextState:f.paused}}}function Es(e){switch(e.type){case"api_req_started":return{nextState:f.streaming};case"retry":return{nextState:f.streaming};case"cancel_session":return{nextState:f.stopped};default:return{nextState:f.error}}}function zs(e){switch(e.type){case"api_req_started":return{nextState:f.streaming};case"start_session":return{nextState:f.creating};default:return{nextState:f.stopped}}}const $=w({}),Z=w([]),O=w(null),ue=w([]),le=w(!1),Me=w(null),Ge=w(0),Xe=F(e=>w("")),Bs=w("local"),Ds=4,Rs=Array.from({length:Ds},(e,t)=>t+1),Fs=w(1);function Ls(e,t){return t===1?[e]:Array.from({length:t},(s,o)=>`${e} (v${o+1})`)}const qs=w(e=>{const t=e($);return e(Z).map(o=>t[o]).filter(o=>o!==void 0)});function Ye(e){const t=e.created_at?new Date(e.created_at).getTime():0,s=e.updated_at?new Date(e.updated_at).getTime():0;return{sessionId:e.session_id,label:e.title||"Untitled",prompt:"",status:"done",startTime:Number.isNaN(t)?0:t,endTime:Number.isNaN(s)?0:s,source:"remote",gitUrl:e.git_url}}const Os=w(e=>{const t=e(qs),s=e(ue),o=new Set(t.filter(r=>r.sessionId).map(r=>r.sessionId)),a=s.filter(r=>!o.has(r.session_id)).map(Ye);return[...t,...a]}),Ps=w(e=>{const t=e(O);if(!t)return null;const s=e($)[t];if(s)return s;const a=e(ue).find(r=>r.session_id===t);return a?Ye(a):null}),Ws=w(null,(e,t,s)=>{const o=e($),a=e(Z),r=!a.includes(s.sessionId);t($,{...o,[s.sessionId]:s}),r&&(t(Z,[s.sessionId,...a]),e(O)===null&&t(O,s.sessionId))}),Vs=w(null,(e,t,s)=>{const o=e($),{[s]:a,...r}=o;if(t($,r),t(Z,e(Z).filter(l=>l!==s)),e(O)===s){const l=e(Z);t(O,l[0]||null)}});w(null,(e,t,s)=>{const o=e($),a=o[s.sessionId];a&&t($,{...o,[s.sessionId]:{...a,status:s.status,exitCode:s.exitCode,error:s.error,endTime:s.status!=="running"?Date.now():a.endTime}})});w(null,(e,t,s)=>{t(ue,s),t(le,!1)});const de=new Map;function Us(e){let t=de.get(e);return t||(t=ks(),de.set(e,t)),t}const ee=w({}),P=w({}),et=w(null,(e,t,s)=>{const{sessionId:o,event:a}=s,r=Us(o);r.send(a);const l=e(ee),i=e(P);t(ee,{...l,[o]:r.getState()}),t(P,{...i,[o]:r.getUiState()})});w(null,(e,t,s)=>{const o=de.get(s);if(o){o.reset();const a=e(ee),r=e(P);t(ee,{...a,[s]:o.getState()}),t(P,{...r,[s]:o.getUiState()})}});const $s=w(null,(e,t,s)=>{de.delete(s)}),Hs=w(e=>{const t=e(O);return t?e(ee)[t]??null:null});w(e=>{const t=e(O);return t?e(P)[t]??null:null});w(e=>{const t=e(P);return s=>{var o;return((o=t[s])==null?void 0:o.showSpinner)??!1}});w(e=>{const t=e(P);return s=>{var o;return((o=t[s])==null?void 0:o.showCancelButton)??!1}});w(e=>{const t=e(P);return s=>{var o;return((o=t[s])==null?void 0:o.isActive)??!1}});const H=F(e=>w([])),te=F(e=>w(new Map));F(e=>w(t=>{const s=t(H(e));return s[s.length-1]||null}));F(e=>w(t=>t(H(e)).length>0));const Ks=w(null,(e,t,s)=>{const{sessionId:o,messages:a}=s,r=e(H(o)),l=e(te(o)),i=Qs(r,a,l);t(H(o),i);const c=new Map;i.forEach(d=>c.set(d.ts,Ae(d))),t(te(o),c);const u=new Map(r.map(d=>[d.ts,d]));for(const d of i){const p=u.get(d.ts),m=!p,h=(p==null?void 0:p.partial)&&!d.partial;if(!m&&!h)continue;const b=Zs(d);b&&t(et,{sessionId:o,event:b})}});w(null,(e,t,s)=>{const{sessionId:o,message:a}=s,r=e(H(o)),l=r.findIndex(d=>d.ts===a.ts);if(l===-1)return;const i=[...r];i[l]=a,t(H(o),i);const c=e(te(o)),u=new Map(c);u.set(a.ts,Ae(a)),t(te(o),u)});w(null,(e,t,s)=>{t(H(s),[]),t(te(s),new Map)});function Ae(e){var t,s,o;return(((t=e.text)==null?void 0:t.length)||0)+(((s=e.say)==null?void 0:s.length)||0)+(((o=e.ask)==null?void 0:o.length)||0)}function Qs(e,t,s){const o=new Map(e.map(a=>[a.ts,a]));return t.map(a=>{const r=o.get(a.ts);if(!r)return a;if(!r.partial&&a.partial){const l=s.get(a.ts)||0;if(Ae(a)<=l)return r}return a})}function Zs(e){const t=e.partial??!1;if(e.type==="say"&&e.say)switch(e.say){case"api_req_started":return{type:"api_req_started"};case"text":case"command_output":case"user_feedback":case"user_feedback_diff":case"api_req_finished":case"api_req_retried":case"completion_result":case"shell_integration_warning":case"checkpoint_saved":return{type:"say_text",partial:t};default:return{type:"say_text",partial:t}}if(e.type==="ask"&&e.ask)switch(e.ask){case"tool":return{type:"ask_tool",partial:t};case"command":return{type:"ask_command",partial:t};case"browser_action_launch":return{type:"ask_browser_action_launch",partial:t};case"use_mcp_server":return{type:"ask_use_mcp_server",partial:t};case"followup":return{type:"ask_followup",partial:t};case"completion_result":return{type:"ask_completion_result"};case"api_req_failed":return{type:"ask_api_req_failed"};case"mistake_limit_reached":return{type:"ask_mistake_limit_reached"};case"invalid_model":return{type:"ask_invalid_model"};case"payment_required_prompt":return{type:"ask_payment_required_prompt"};case"resume_task":return{type:"ask_resume_task"};case"resume_completed_task":return{type:"ask_resume_task"};default:return null}return null}const tt=F(e=>w([]));function Js(e){const t=e.filter(c=>c.status==="completed").length,s=e.length,o=e.find(c=>c.status==="in_progress"),a=e.find(c=>c.status==="pending"),r=o||a,l=s>0&&t===s,i=s>0?t/s*100:0;return{todos:e,completedCount:t,totalCount:s,inProgressTodo:o,nextPendingTodo:a,currentTodo:r,allCompleted:l,progressPercent:i}}const Gs=F(e=>w(t=>{const s=t(tt(e));return Js(s)})),Xs=w(null,(e,t,s)=>{const{sessionId:o,todos:a}=s;t(tt(o),a)}),st=w([]),nt=w(void 0),Ys=w(null,(e,t,s)=>{const{branches:o,currentBranch:a}=s;t(st,o),t(nt,a)});function en(e){return e.filter(s=>s.type==="ask"&&s.ask==="tool"||s.type==="say"&&s.say==="user_edit_todos").map(s=>{const o=s.metadata;if((o==null?void 0:o.tool)==="updateTodoList"&&Array.isArray(o.todos))return{tool:"updateTodoList",todos:o.todos};try{return JSON.parse(s.text??"{}")}catch{return null}}).filter(s=>s&&s.tool==="updateTodoList"&&Array.isArray(s.todos)).map(s=>s.todos).pop()??[]}function tn(e,t){switch(e){case"api_req_started":return{type:"api_req_started"};case"ask_followup":return{type:"ask_followup",partial:t??!1};case"ask_tool":return{type:"ask_tool",partial:t??!1};case"ask_command":return{type:"ask_command",partial:t??!1};case"ask_browser_action_launch":return{type:"ask_browser_action_launch",partial:t??!1};case"ask_use_mcp_server":return{type:"ask_use_mcp_server",partial:t??!1};case"ask_completion_result":return{type:"ask_completion_result"};case"ask_resume_task":return{type:"ask_resume_task"};case"ask_api_req_failed":return{type:"ask_api_req_failed"};case"ask_mistake_limit_reached":return{type:"ask_mistake_limit_reached"};case"ask_invalid_model":return{type:"ask_invalid_model"};case"ask_payment_required_prompt":return{type:"ask_payment_required_prompt"};case"cancel_session":return{type:"cancel_session"};default:return null}}function sn(){const e=C(Ks),t=C(Xs),s=C(Ys),o=C(Ws),a=C(Vs),r=C(O),l=C(Ge),i=C(ue),c=C(Me),u=C(le),d=C(et),p=C($s),m=T(Z),h=x.useRef(!1),b=x.useRef(new Set);x.useEffect(()=>{function k(v){const y=v.data;switch(y.type){case"agentManager.chatMessages":{const{sessionId:g,messages:j}=y;e({sessionId:g,messages:j});const _=en(j);t({sessionId:g,todos:_});break}case"agentManager.state":{const{state:g}=y;for(const _ of g.sessions){const M=!b.current.has(_.sessionId);o(_),M&&(b.current.add(_.sessionId),(_.status==="creating"||_.status==="running")&&(d({sessionId:_.sessionId,event:{type:"start_session"}}),d({sessionId:_.sessionId,event:{type:"session_created",sessionId:_.sessionId}}),_.status==="running"&&d({sessionId:_.sessionId,event:{type:"api_req_started"}})))}const j=new Set(g.sessions.map(_=>_.sessionId));for(const _ of m)j.has(_)||(a(_),p(_),b.current.delete(_));!h.current&&g.selectedId!==void 0&&(r(g.selectedId),h.current=!0);break}case"agentManager.startSessionFailed":{l(g=>g+1),c(null);break}case"agentManager.remoteSessions":{const{sessions:g}=y;i(g),u(!1);break}case"agentManager.pendingSession":{const{pendingSession:g}=y;c(g);break}case"agentManager.stateEvent":{const{sessionId:g,eventType:j,partial:_}=y,M=tn(j,_);M&&d({sessionId:g,event:M});break}case"agentManager.branches":{const{branches:g,currentBranch:j}=y;s({branches:g,currentBranch:j});break}}}return window.addEventListener("message",k),()=>window.removeEventListener("message",k)},[e,t,s,o,a,r,l,i,c,u,d,p,m])}const nn=()=>crypto.randomUUID(),R=F(e=>w([])),me=F(e=>w(null));F(e=>w(t=>t(R(e)).length===0));F(e=>w(t=>t(R(e)).find(o=>o.status==="queued")||null));const on=w(null,(e,t,s)=>{const{sessionId:o,content:a}=s,r=e(R(o)),l={id:nn(),sessionId:o,content:a,status:"queued",timestamp:Date.now(),retryCount:0,maxRetries:3};return t(R(o),[...r,l]),l}),an=w(null,(e,t,s)=>{const{sessionId:o,messageId:a,status:r,error:l}=s,c=e(R(o)).map(u=>u.id===a?{...u,status:r,error:l||void 0}:u);t(R(o),c)}),ot=w(null,(e,t,s)=>{const{sessionId:o,messageId:a}=s,l=e(R(o)).filter(i=>i.id!==a);t(R(o),l)}),rn=w(null,(e,t,s)=>{const{sessionId:o,messageId:a}=s,l=e(R(o)).map(i=>i.id===a&&i.status==="failed"&&i.retryCount<i.maxRetries?{...i,status:"queued",error:void 0,retryCount:i.retryCount+1}:i);t(R(o),l)});w(null,(e,t,s)=>{t(R(s),[]),t(me(s),null)});const cn=w(null,(e,t,s)=>{const{sessionId:o,messageId:a}=s;t(me(o),a)});let he;function fe(){return he||(he=acquireVsCodeApi()),he}const E={postMessage:e=>fe().postMessage(e),getState:()=>fe().getState(),setState:e=>fe().setState(e)};function ln(e){const t=T(R(e||"")),s=T(me(e||"")),o=C(an),a=C(ot),r=C(cn),l=x.useCallback((i,c)=>{e&&(r({sessionId:e,messageId:i}),E.postMessage({type:"agentManager.messageQueued",sessionId:e,messageId:i,content:c}))},[e,r]);x.useEffect(()=>{if(!e)return;const i=c=>{if(c.data.type!=="agentManager.messageStatus")return;const{sessionId:u,messageId:d,status:p,error:m}=c.data;u===e&&((p==="sending"||p==="failed")&&o({sessionId:e,messageId:d,status:p,error:m}),p==="sent"&&(a({sessionId:e,messageId:d}),r({sessionId:e,messageId:null})),p==="failed"&&r({sessionId:e,messageId:null}))};return window.addEventListener("message",i),()=>window.removeEventListener("message",i)},[e,o,a,r]),x.useEffect(()=>{if(!e||s)return;const i=t.find(c=>c.status==="queued");i&&l(i.id,i.content)},[e,t,s,l])}function at(e,t){if(!e||isNaN(e))return"";const o=Date.now()-e,a=Math.floor(o/1e3),r=Math.floor(a/60),l=Math.floor(r/60),i=Math.floor(l/24);if(i>7){const c=Math.floor(i/7);return c===1?t.weekAgo:t.weeksAgo(c)}return i>0?i===1?t.dayAgo:t.daysAgo(i):l>0?l===1?t.hourAgo:t.hoursAgo(l):r>0?r===1?t.minuteAgo:t.minutesAgo(r):t.justNow}function rt(e){return{justNow:e("time.justNow"),minuteAgo:e("time.minuteAgo"),minutesAgo:t=>e("time.minutesAgo",{count:t}),hourAgo:e("time.hourAgo"),hoursAgo:t=>e("time.hoursAgo",{count:t}),dayAgo:e("time.dayAgo"),daysAgo:t=>e("time.daysAgo",{count:t}),weekAgo:e("time.weekAgo"),weeksAgo:t=>e("time.weeksAgo",{count:t})}}function dn(){const{t:e}=B("agentManager"),t=T(Os),s=T(Me),[o,a]=ce(O),r=T(le),l=C(le),i=T(P),c=()=>{a(null)},u=m=>{a(m),E.postMessage({type:"agentManager.selectSession",sessionId:m})},d=()=>{r||(l(!0),E.postMessage({type:"agentManager.refreshRemoteSessions"}))},p=o===null&&!s;return n.jsxs("div",{className:"am-sidebar",children:[n.jsx("div",{className:"am-sidebar-header",children:n.jsx("span",{children:e("sidebar.title")})}),n.jsxs("div",{className:`am-new-agent-item ${p?"am-selected":""}`,onClick:c,role:"button",tabIndex:0,onKeyDown:m=>m.key==="Enter"&&c(),children:[n.jsx(St,{size:16}),n.jsx("span",{children:e("sidebar.newAgent")})]}),n.jsxs("div",{className:"am-sidebar-section-header",children:[n.jsx("span",{children:e("sidebar.sessionsSection")}),n.jsx("button",{className:"am-icon-btn",onClick:d,disabled:r,title:e("sidebar.refresh"),children:r?n.jsx(q,{size:14,className:"am-spinning"}):n.jsx(Qt,{size:14})})]}),n.jsxs("div",{className:"am-session-list",children:[s&&n.jsx(un,{pendingSession:s,isSelected:o===null,onSelect:()=>a(null)}),t.length===0&&!s?n.jsx("div",{className:"am-no-sessions",children:n.jsx("p",{children:e("sidebar.emptyState")})}):t.map(m=>n.jsx(mn,{session:m,isSelected:o===m.sessionId,uiState:i[m.sessionId],onSelect:()=>u(m.sessionId)},m.sessionId))]})]})}function un({pendingSession:e,isSelected:t,onSelect:s}){const{t:o}=B("agentManager");return n.jsxs("div",{className:`am-session-item pending ${t?"am-selected":""}`,onClick:s,children:[n.jsx("div",{className:"am-status-icon creating",title:o("status.creating"),children:n.jsx(q,{size:14,className:"am-spinning"})}),n.jsxs("div",{className:"am-session-content",children:[n.jsx("div",{className:"am-session-label",children:e.label}),n.jsx("div",{className:"am-session-meta",children:o("status.creating")})]})]})}function mn({session:e,isSelected:t,uiState:s,onSelect:o}){var g,j;const{t:a}=B("agentManager"),r=x.useMemo(()=>rt(a),[a]),[l,i]=x.useState(!1),[c,u]=x.useState(!1),d=(s==null?void 0:s.showSpinner)??!1,p=(s==null?void 0:s.isActive)??!1,m=(g=e.parallelMode)==null?void 0:g.enabled,h=(j=e.parallelMode)==null?void 0:j.branch,b=e.status==="done",k=_=>{_.stopPropagation(),i(!0)},v=_=>{_.stopPropagation(),i(!1),u(!1),E.postMessage({type:"agentManager.sessionShare",sessionId:e.sessionId})},y=_=>{_.stopPropagation(),i(!1),u(!1)};return n.jsxs("div",{className:`am-session-item ${t?"am-selected":""}`,onClick:o,onMouseEnter:()=>u(!0),onMouseLeave:()=>!l&&u(!1),children:[e.status==="creating"&&n.jsx("div",{className:"am-status-icon creating",title:a("status.creating"),children:n.jsx(q,{size:14,className:"am-spinning"})}),d&&n.jsx("div",{className:"am-status-icon running",title:a("status.running"),children:n.jsx(q,{size:14,className:"am-spinning"})}),n.jsxs("div",{className:"am-session-content",children:[n.jsx("div",{className:"am-session-label",children:e.label}),n.jsxs("div",{className:"am-session-meta",children:[e.status==="creating"&&p?a("status.creating"):at(e.startTime,r),m&&n.jsxs("span",{className:"am-worktree-indicator",title:h||a("sidebar.worktree"),children:[n.jsx(U,{size:10}),h?n.jsx("span",{className:"am-branch-name",children:h.length>20?h.slice(0,20)+"...":h}):n.jsx("span",{children:a("sidebar.worktree")})]}),!m&&n.jsx("span",{className:"am-workspace-indicator",title:a("sidebar.local"),children:n.jsx(ne,{size:10})})]}),m&&b&&n.jsx("div",{className:"am-ready-to-merge",children:a("sidebar.readyToMerge")})]}),(c||l)&&n.jsx("button",{className:"w-5 h-5 border-none bg-transparent rounded-[3px] cursor-pointer flex items-center justify-center -mt-0.5 hover:bg-vscode-toolbar-hoverBackground",onClick:k,title:a("sidebar.shareSession"),"aria-label":a("sidebar.shareSession"),children:n.jsx(jt,{size:14})}),l&&n.jsxs("div",{className:"absolute top-full left-2 right-2 mt-1 p-3 bg-vscode-dropdown-background border border-vscode-dropdown-border rounded z-[100] shadow-[0_4px_12px_rgba(0,0,0,0.3)]",onClick:_=>_.stopPropagation(),children:[n.jsx("div",{className:"text-sm mb-2",children:a("sidebar.shareConfirmMessage")}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{className:"px-3 py-1 rounded-sm text-xs cursor-pointer border border-transparent transition-colors duration-150 bg-vscode-button-background text-vscode-button-foreground hover:bg-vscode-button-hoverBackground",onClick:v,children:a("sidebar.shareConfirmYes")}),n.jsx("button",{className:"px-3 py-1 rounded-sm text-xs cursor-pointer border border-transparent transition-colors duration-150 bg-vscode-button-secondaryBackground text-vscode-button-secondaryForeground hover:bg-vscode-button-secondaryHoverBackground",onClick:y,children:a("sidebar.shareConfirmNo")})]})]})]})}const L=({content:e})=>n.jsx("div",{className:"am-markdown-content",children:n.jsx(Nt,{remarkPlugins:[Mt],children:e})});function pn({suggestions:e,onSuggestionClick:t,onCopyToInput:s}){const{t:o}=B("agentManager");return e!=null&&e.length?n.jsx("div",{className:"am-followup-suggestions",children:e.map((a,r)=>n.jsxs("div",{className:"am-followup-suggestion-wrapper",children:[n.jsx("button",{type:"button",onClick:()=>t(a),className:"am-followup-suggestion-btn","aria-label":a.answer,children:a.answer}),s&&n.jsx(Q,{content:o("chat:followUpSuggest.copyToInput"),children:n.jsx("button",{type:"button",className:"am-followup-copy-btn",onClick:l=>{l.stopPropagation(),s(a)},"aria-label":o("chat:followUpSuggest.copyToInput"),children:n.jsx(At,{size:16})})})]},`${a.answer}-${r}`))}):null}function hn(e){if(!e)return{command:"",output:""};const t=e.indexOf(ge);if(t===-1)return{command:e,output:""};let s=e.slice(t+ge.length);return s=s.replace(/^\n/,""),s=s.split(`
`).filter(r=>r.trim()!=="command_output").join(`
`).replace(/\n+$/,""),{command:e.slice(0,t).trim(),output:s}}function fn(e){return e?e.replace(/\u001B\][^\u0007]*(?:\u0007|\u001B\\)/g,"").replace(/\u001B\[[0-?]*[ -/]*[@-~]/g,"").replace(/\u001B./g,"").replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\u007F]/g,""):""}const it=x.memo(({text:e,isRunning:t=!1,isLast:s=!1,exitCode:o,terminalStatus:a})=>{const{t:r}=B("agentManager"),{command:l,output:i}=x.useMemo(()=>hn(e),[e]),[c,u]=x.useState(!0),[d,p]=x.useState(!1),m=x.useMemo(()=>fn(i),[i]),h=x.useMemo(()=>/\S/.test(m),[m]),b=x.useMemo(()=>e.indexOf(ge)!==-1,[e]),k=o!==void 0||a==="timeout"||a==="exited",v=x.useMemo(()=>!k&&(t||b&&s)&&!h?"running":a==="timeout"||o!==void 0&&o!==0?"error":o===0||h||b?"success":"pending",[k,t,b,s,h,a,o]),y=v==="error",g=async()=>{try{await navigator.clipboard.writeText(l),p(!0),setTimeout(()=>p(!1),2e3)}catch{}};return n.jsxs("div",{className:"bg-vscode-editor-background border border-vscode-panel-border rounded-sm font-mono text-sm",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 px-2 py-1.5",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[n.jsx(gn,{status:v}),n.jsx("pre",{className:"overflow-x-auto whitespace-pre m-0 p-0 flex-1 min-w-0",children:l})]}),n.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[n.jsx("button",{onClick:g,className:"p-1 text-vscode-descriptionForeground hover:text-vscode-foreground transition-colors rounded hover:bg-vscode-toolbar-hoverBackground",title:r("messages.copyCommand"),children:d?n.jsx(Y,{size:14}):n.jsx(dt,{size:14})}),h&&n.jsx("button",{onClick:()=>u(!c),className:"p-1 text-vscode-descriptionForeground hover:text-vscode-foreground transition-colors rounded hover:bg-vscode-toolbar-hoverBackground",title:r(c?"messages.collapseOutput":"messages.expandOutput"),children:n.jsx(X,{className:N("size-4 transition-transform duration-200",c&&"rotate-180")})})]})]}),h&&n.jsx("div",{className:N("overflow-hidden transition-all duration-200 border-t border-vscode-panel-border",{"max-h-0 border-t-0":!c,"max-h-[500px] overflow-y-auto":c}),children:n.jsx("div",{className:"p-2 bg-vscode-editor-background",children:n.jsx("pre",{className:N("overflow-x-auto whitespace-pre m-0 p-0 text-xs",y?"text-red-400":"text-vscode-descriptionForeground"),children:m})})})]})});it.displayName="CommandExecutionBlock";function gn({status:e}){switch(e){case"pending":return n.jsx("div",{className:"size-2 rounded-full bg-yellow-500/70 flex-shrink-0"});case"running":return n.jsx(q,{size:10,className:"animate-spin text-blue-400 flex-shrink-0"});case"success":return n.jsx("div",{className:"size-2 rounded-full bg-green-500 flex-shrink-0"});case"error":return n.jsx("div",{className:"size-2 rounded-full bg-red-500 flex-shrink-0"})}}function xn(e){if(typeof e=="number")return e;if(typeof e=="string"&&e.trim()&&!Number.isNaN(Number(e)))return Number(e)}function vn(e){const t=e.metadata;return t?{exitCode:xn(t.exitCode),status:typeof t.status=="string"?t.status:void 0,isRunning:e.partial??!1}:null}function bn({sessionId:e}){const{t}=B("agentManager"),s=T(H(e)),o=T(R(e)),a=T(me(e)),r=C(Xe(e)),l=C(rn),i=C(ot),c=x.useRef(null),u=x.useMemo(()=>Ct(s),[s]),d=x.useMemo(()=>{const y=new Map;for(let g=0;g<s.length;g++){const j=s[g];if(j.type!=="ask"||j.ask!=="command")continue;let _=null;for(let M=g+1;M<s.length;M++){const I=s[M];if(I.type==="ask"&&I.ask==="command")break;I.ask!=="command_output"&&I.say!=="command_output"||(_=vn(I))}_&&y.set(j.ts,_)}return y},[s]);x.useEffect(()=>{var y;u.length>0&&((y=c.current)==null||y.scrollToIndex({index:u.length-1,behavior:"smooth"}))},[u.length]);const p=x.useCallback(y=>{E.postMessage({type:"agentManager.sendMessage",sessionId:e,content:y.answer})},[e]),m=x.useCallback(y=>{r(g=>g!==""?`${g} 
${y.answer}`:y.answer)},[r]),h=x.useCallback((y,g)=>{l({sessionId:y,messageId:g})},[l]),b=x.useCallback((y,g)=>{i({sessionId:y,messageId:g})},[i]),k=x.useMemo(()=>[...u,...o.map(y=>({type:"queued",data:y}))],[u,o]),v=x.useCallback((y,g)=>{if("type"in g&&g.type==="queued"){const M=g.data;return n.jsx(_n,{queuedMessage:M,isSending:a===M.id,onRetry:h,onDiscard:b},`queued-${M.id}`)}const j=g,_=y===u.length-1;return n.jsx(wn,{message:j,isLast:_,commandExecutionByTs:d,onSuggestionClick:p,onCopyToInput:m},j.ts||y)},[u.length,d,p,m,a,h,b]);return s.length===0&&o.length===0?n.jsxs("div",{className:"am-messages-empty",children:[n.jsx(xe,{className:"w-12 h-12 mx-auto mb-4 opacity-20"}),n.jsx("p",{children:t("messages.waiting")})]}):n.jsx("div",{className:"am-messages-container",children:n.jsx(It,{ref:c,data:k,itemContent:v,followOutput:"smooth",increaseViewportBy:{top:400,bottom:400},className:"am-messages-list"})})}function yn(e){const t=e.text||e.content||"",s=e.metadata??{},o=ve(t),a=s.question||(o==null?void 0:o.question)||t,r=s.suggest||(o==null?void 0:o.suggest);return a?{question:a,suggestions:r}:null}function wn({message:e,isLast:t,commandExecutionByTs:s,onSuggestionClick:o,onCopyToInput:a}){const{t:r}=B("agentManager"),l=e.text||e.content||"";let i=n.jsx(xe,{size:16}),c=r("messages.kiloSaid"),u=null,d=null,p;if(e.type==="say")switch(e.say){case"api_req_started":{i=n.jsx(Ft,{size:16,className:"opacity-70"}),c=r("messages.apiRequest");const m=ve(l);(m==null?void 0:m.cost)!==void 0&&(d=n.jsxs("span",{className:"am-message-cost",children:["$",m.cost.toFixed(4)]})),u=null;break}case"text":{i=n.jsx(xe,{size:16}),c=r("messages.kiloSaid"),u=n.jsx(L,{content:l});break}case"user_feedback":{i=n.jsx(Tt,{size:16}),c=r("messages.youSaid"),u=n.jsx(L,{content:l});break}case"completion_result":{i=n.jsx(Ot,{size:16,className:"text-green-500"}),c=r("messages.taskCompleted"),u=n.jsx(L,{content:l});break}case"error":{i=n.jsx(Ne,{size:16,className:"text-red-500"}),c=r("messages.error"),u=n.jsx(L,{content:l});break}case"api_req_finished":case"checkpoint_saved":case"command_output":return null;default:u=n.jsx(L,{content:l})}if(e.type==="ask")switch(e.ask){case"followup":{i=n.jsx(Et,{size:16}),c=r("messages.question");const m=yn(e);p=m==null?void 0:m.suggestions,u=n.jsx("div",{children:n.jsx(L,{content:(m==null?void 0:m.question)||l})});break}case"command":{i=n.jsx(Te,{size:16}),c=r("messages.command");const m=s.get(e.ts);u=n.jsx(it,{text:l,isRunning:(m==null?void 0:m.isRunning)??e.partial,isLast:t,exitCode:m==null?void 0:m.exitCode,terminalStatus:m==null?void 0:m.status});break}case"command_output":return null;case"tool":{const m=e.metadata,h=m!=null&&m.tool?m:ve(l);if((h==null?void 0:h.tool)==="updateTodoList")return null;if(i=n.jsx(Te,{size:16}),c=r("messages.tool"),h){const b=h.path?`(${h.path})`:"";u=n.jsx(L,{content:r("messages.usingTool",{tool:h.tool,details:b})})}else u=n.jsx(L,{content:l});break}default:u=n.jsx(L,{content:l})}return n.jsxs("div",{className:`am-message-item ${e.type==="say"&&e.say==="api_req_started"?"am-api-req":""}`,children:[n.jsx("div",{className:"am-message-icon",children:i}),n.jsxs("div",{className:"am-message-content-wrapper",children:[n.jsxs("div",{className:"am-message-header",children:[n.jsx("span",{className:"am-message-author",children:c}),n.jsx("span",{className:"am-message-ts",children:new Date(e.ts).toLocaleTimeString()}),d]}),u&&n.jsx("div",{className:"am-message-body",children:u}),p&&p.length>0&&o&&n.jsx(pn,{suggestions:p,onSuggestionClick:o,onCopyToInput:a})]})]})}function _n({queuedMessage:e,isSending:t,onRetry:s,onDiscard:o}){const{t:a}=B("agentManager");let r=n.jsx(Be,{size:16,className:"opacity-70"}),l=a("chatInput.messageSending"),i="text-vscode-descriptionForeground";e.status==="sending"?(r=n.jsx(Ht,{size:16,className:"animate-spin opacity-70"}),l=a("chatInput.messageSending"),i="text-vscode-descriptionForeground"):e.status==="failed"?(r=n.jsx(Ne,{size:16,className:"text-vscode-errorForeground"}),l=e.error||"Failed to send message",i="text-vscode-errorForeground"):(r=n.jsx(Be,{size:16,className:"opacity-70"}),l=a("chatInput.messageSending"),i="text-vscode-descriptionForeground");const c=()=>{s(e.sessionId,e.id)},u=()=>{o(e.sessionId,e.id)},d=e.retryCount<e.maxRetries;return n.jsxs("div",{className:N("am-message-item",e.status==="failed"&&"opacity-75"),children:[n.jsx("div",{className:"am-message-icon",children:r}),n.jsxs("div",{className:"am-message-content-wrapper",children:[n.jsxs("div",{className:"am-message-header",children:[n.jsx("span",{className:"am-message-author text-vscode-descriptionForeground",children:a("messages.youSaid")}),n.jsx("span",{className:N("am-message-ts text-xs",i),children:l})]}),n.jsx("div",{className:"am-message-body",children:n.jsx(L,{content:e.content})}),e.status==="failed"&&n.jsxs("div",{className:"mt-2 space-y-2",children:[e.error&&n.jsxs("p",{className:"text-xs text-vscode-errorForeground",children:["Error: ",e.error]}),e.retryCount>0&&n.jsxs("p",{className:"text-xs text-vscode-descriptionForeground",children:["Retry attempt ",e.retryCount," of ",e.maxRetries]}),n.jsxs("div",{className:"flex gap-2",children:[d&&n.jsx("button",{onClick:c,className:"text-xs px-2 py-1 rounded bg-vscode-button-background hover:bg-vscode-button-hoverBackground text-vscode-button-foreground",children:"Retry"}),n.jsx("button",{onClick:u,className:"text-xs px-2 py-1 rounded bg-vscode-errorBackground hover:opacity-80 text-vscode-errorForeground",children:"Discard"})]})]})]})]})}function kn({status:e,size:t="sm"}){const s=t==="xs"?"w-3 h-3":"w-3.5 h-3.5",o=t==="xs"?"w-2 h-2":"w-2.5 h-2.5";switch(e){case"completed":return n.jsx("div",{className:N("flex items-center justify-center rounded-full bg-green-500/20",s),children:n.jsx(Y,{className:N("text-green-400",o),strokeWidth:3})});case"in_progress":return n.jsx(q,{className:N("text-vscode-charts-yellow animate-spin",s)});default:return n.jsx(Wt,{className:N("text-vscode-descriptionForeground/40",s),strokeWidth:2})}}function Sn({stats:e,isIntegrated:t=!1}){const{t:s}=B("chat"),[o,a]=x.useState(!1),r=x.useRef(null),{todos:l,completedCount:i,totalCount:c,currentTodo:u,allCompleted:d,progressPercent:p}=e;return x.useEffect(()=>{if(!o||!r.current)return;const m=l.findIndex(k=>k.status==="in_progress");if(m===-1)return;const b=r.current.querySelectorAll("[data-todo-item]")[m];b&&b.scrollIntoView({behavior:"smooth",block:"center"})},[o,l]),c<=0?null:n.jsxs("div",{className:N("overflow-hidden transition-all duration-200",t?"border-b border-vscode-input-border/50":"rounded-t-md border-x border-t border-vscode-input-border","bg-vscode-input-background"),children:[n.jsxs("button",{type:"button",onClick:()=>a(!o),className:N("w-full flex items-center gap-2 px-3 py-1.5","hover:bg-vscode-list-hoverBackground/30 transition-colors","focus:outline-none","cursor-pointer"),children:[n.jsxs("div",{className:"relative flex-shrink-0",children:[n.jsxs("svg",{className:"w-4 h-4 -rotate-90",viewBox:"0 0 16 16",children:[n.jsx("circle",{cx:"8",cy:"8",r:"6",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-vscode-input-border/40"}),n.jsx("circle",{cx:"8",cy:"8",r:"6",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeDasharray:`${p*.377} 100`,strokeLinecap:"round",className:N("transition-all duration-300",d?"text-green-400":"text-vscode-charts-yellow")})]}),d&&n.jsx(Y,{className:"absolute inset-0 m-auto w-2 h-2 text-green-400",strokeWidth:3})]}),n.jsx("span",{className:N("flex-1 text-xs truncate text-left",d?"text-green-400":"text-vscode-foreground"),children:d?s("todo.complete",{total:i}):(u==null?void 0:u.content)||s("todo.partial",{completed:i,total:c})}),n.jsxs("span",{className:"flex-shrink-0 text-[10px] text-vscode-descriptionForeground/70 tabular-nums",children:[i,"/",c]}),o?n.jsx(X,{className:"w-3 h-3 text-vscode-descriptionForeground/50"}):n.jsx(ut,{className:"w-3 h-3 text-vscode-descriptionForeground/50"})]}),o&&n.jsx("div",{ref:r,className:"max-h-[140px] overflow-y-auto border-t border-vscode-input-border/50",children:n.jsx("div",{className:"py-1 px-1",children:l.map((m,h)=>n.jsxs("div",{"data-todo-item":!0,className:N("flex items-center gap-2 py-0.5 px-2 rounded transition-colors",m.status==="in_progress"&&"bg-vscode-charts-yellow/10"),children:[n.jsx(kn,{status:m.status,size:"xs"}),n.jsx("span",{className:N("text-xs truncate",m.status==="in_progress"&&"text-vscode-charts-yellow",m.status==="completed"&&"line-through text-vscode-descriptionForeground/50",m.status==="pending"&&"text-vscode-descriptionForeground"),children:m.content})]},m.id||h))})})]})}const jn=({sessionId:e,sessionLabel:t,isActive:s=!1,showCancel:o=!1,showFinishToBranch:a=!1,worktreeBranchName:r,sessionStatus:l})=>{const{t:i}=B("agentManager"),[c,u]=ce(Xe(e)),d=T(Gs(e)),[p,m]=x.useState(!1),h=x.useRef(null),b=C(on);x.useEffect(()=>{var S;(S=h.current)==null||S.focus()},[e]);const k=c.trim(),v=k.length===0,y=l==="done"||l==="error"||l==="stopped",g=v,j=()=>{if(!v)if(y)E.postMessage({type:"agentManager.resumeSession",sessionId:e,sessionLabel:t,content:k}),u("");else{const S=b({sessionId:e,content:k});S&&(E.postMessage({type:"agentManager.messageQueued",sessionId:e,messageId:S.id,sessionLabel:t,content:k}),u(""))}},_=()=>{E.postMessage({type:"agentManager.cancelSession",sessionId:e})},M=()=>{E.postMessage({type:"agentManager.finishWorktreeSession",sessionId:e})},I=S=>{S.key==="Enter"&&!S.shiftKey&&!S.nativeEvent.isComposing&&(S.preventDefault(),j())},D=d.totalCount>0;return n.jsx("div",{className:"am-chat-input-container",children:n.jsxs("div",{className:N("relative flex-1 flex flex-col min-h-0 overflow-hidden rounded",D&&["border bg-vscode-input-background",p?"border-vscode-focusBorder outline outline-vscode-focusBorder":"border-vscode-input-border"]),children:[D&&n.jsx(Sn,{stats:d,isIntegrated:!0}),n.jsxs("div",{className:N("relative","flex-1","flex","flex-col-reverse","min-h-0","overflow-hidden"),children:[n.jsx(qe,{ref:h,value:c,onChange:S=>u(S.target.value),onKeyDown:I,onFocus:()=>m(!0),onBlur:()=>m(!1),"aria-label":i("chatInput.ariaLabel"),placeholder:i("chatInput.placeholderTypeTask"),minRows:3,maxRows:15,className:N("w-full","text-vscode-input-foreground","font-vscode-font-family","text-vscode-editor-font-size","leading-vscode-editor-line-height","cursor-text","!pt-3 !pl-3 pr-9",!D&&[p?"border border-vscode-focusBorder outline outline-vscode-focusBorder":"border border-vscode-input-border","rounded"],"bg-vscode-input-background","transition-background-color duration-150 ease-in-out","will-change-background-color","min-h-[90px]","box-border","resize-none","overflow-x-hidden","overflow-y-auto","!pb-10","flex-none flex-grow","z-[2]","scrollbar-none","scrollbar-hide")}),n.jsx("div",{className:"absolute bottom-[1px] left-2 right-2 h-10 bg-gradient-to-t from-[var(--vscode-input-background)] via-[var(--vscode-input-background)] to-transparent pointer-events-none z-[2]","aria-hidden":"true"}),n.jsxs("div",{className:"absolute bottom-2 right-2 z-30 flex gap-1",children:[a&&n.jsx(Q,{content:r?i("chatInput.finishToBranchTitle",{branch:r}):i("chatInput.finishToBranchTitleNoBranch"),children:n.jsx("button",{"aria-label":r?i("chatInput.finishToBranchTitle",{branch:r}):i("chatInput.finishToBranchTitleNoBranch"),onClick:M,className:N("relative inline-flex items-center justify-center","bg-transparent border-none p-1.5","rounded-md min-w-[28px] min-h-[28px]","opacity-60 hover:opacity-100 text-vscode-descriptionForeground hover:text-vscode-foreground","transition-all duration-150","hover:bg-[rgba(255,255,255,0.03)] hover:border-[rgba(255,255,255,0.15)]","focus:outline-none focus-visible:ring-1 focus-visible:ring-vscode-focusBorder","active:bg-[rgba(255,255,255,0.1)]","cursor-pointer"),children:n.jsx(U,{size:14})})}),s&&o&&n.jsx(Q,{content:i("chatInput.cancelTitle"),children:n.jsx("button",{"aria-label":i("chatInput.cancelTitle"),onClick:_,className:N("relative inline-flex items-center justify-center","bg-transparent border-none p-1.5","rounded-md min-w-[28px] min-h-[28px]","opacity-60 hover:opacity-100 text-vscode-errorForeground","transition-all duration-150","hover:bg-[rgba(255,255,255,0.03)] hover:border-[rgba(255,255,255,0.15)]","focus:outline-none focus-visible:ring-1 focus-visible:ring-vscode-focusBorder","active:bg-[rgba(255,255,255,0.1)]","cursor-pointer"),children:n.jsx(zt,{size:14,fill:"currentColor"})})}),n.jsx(Q,{content:i("chatInput.sendTitle"),children:n.jsx("button",{"aria-label":i("chatInput.sendTitle"),disabled:g,onClick:j,className:N("relative inline-flex items-center justify-center","bg-transparent border-none p-1.5","rounded-md min-w-[28px] min-h-[28px]","opacity-60 hover:opacity-100 text-vscode-descriptionForeground hover:text-vscode-foreground","transition-all duration-150","hover:bg-[rgba(255,255,255,0.03)] hover:border-[rgba(255,255,255,0.15)]","focus:outline-none focus-visible:ring-1 focus-visible:ring-vscode-focusBorder","active:bg-[rgba(255,255,255,0.1)]",!g&&"cursor-pointer",g&&"opacity-40 cursor-not-allowed grayscale-[30%] hover:bg-transparent hover:border-[rgba(255,255,255,0.08)] active:bg-transparent"),children:n.jsx(Oe,{className:"w-4 h-4 rtl:-scale-x-100"})})})]}),!c&&n.jsx("div",{className:"absolute left-3 right-[70px] z-30 flex items-center h-8 overflow-hidden text-ellipsis whitespace-nowrap",style:{bottom:"0.25rem",color:"var(--vscode-descriptionForeground)",opacity:.7,fontSize:"11px",userSelect:"none",pointerEvents:"none"},children:i("chatInput.hint")})]})]})})};function Nn({selectedBranch:e,onSelect:t,onClose:s}){const{t:o}=B("agentManager"),a=T(st),r=T(nt),l=r&&a.includes(r)?[r]:[],i=a.filter(d=>d!==r),c=x.useCallback(d=>{t(d),s()},[t,s]);x.useEffect(()=>{const d=p=>{p.key==="Escape"&&s()};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[s]);const u=d=>{d.target===d.currentTarget&&s()};return a.length===0?n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start justify-center pt-20 z-50",onClick:u,children:n.jsxs("div",{className:"bg-vscode-editor-background border border-vscode-editorWidget-border rounded-md shadow-lg w-96 p-4 text-center text-vscode-descriptionForeground",children:[n.jsx(U,{size:24,className:"mx-auto mb-2 opacity-50"}),o("sessionDetail.noBranches")]})}):n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start justify-center pt-20 z-50",onClick:u,children:n.jsxs(mt,{className:"bg-vscode-editor-background border border-vscode-editorWidget-border rounded-md shadow-lg w-96 max-h-96 flex flex-col overflow-hidden",children:[n.jsx(pt,{placeholder:o("sessionDetail.searchBranches"),autoFocus:!0}),n.jsxs(ht,{children:[n.jsx(ft,{children:o("sessionDetail.noMatchingBranches")}),l.length>0&&n.jsx(Ee,{heading:o("sessionDetail.yourBranches"),children:l.map(d=>n.jsxs(ze,{value:d,onSelect:()=>c(d),children:[n.jsx(U,{size:12,className:"flex-shrink-0"}),n.jsx("span",{className:"truncate flex-1",children:d}),e===d&&n.jsx(Y,{size:12,className:"ml-auto"})]},d))}),l.length>0&&i.length>0&&n.jsx(gt,{}),i.length>0&&n.jsx(Ee,{heading:o("sessionDetail.otherBranches"),children:i.map(d=>n.jsxs(ze,{value:d,onSelect:()=>c(d),children:[n.jsx(U,{size:12,className:"flex-shrink-0"}),n.jsx("span",{className:"truncate flex-1",children:d}),e===d&&n.jsx(Y,{size:12,className:"ml-auto"})]},d))})]})]})})}const Mn=()=>n.jsx("svg",{id:"Layer_2","data-name":"Layer 2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",width:"100%",height:"100%",style:{display:"block"},children:n.jsx("g",{id:"Kilo_Code_Branding","data-name":"Kilo Code Branding",children:n.jsx("path",{id:"Logo_Outline_-_White","data-name":"Logo Outline - White",fill:"currentColor",d:"M0,0v100h100V0H0ZM92.5925926,92.5925926H7.4074074V7.4074074h85.1851852v85.1851852ZM61.1111044,71.9096084h9.2592593v7.4074074h-11.6402116l-5.026455-5.026455v-11.6402116h7.4074074v9.2592593ZM77.7777711,71.9096084h-7.4074074v-9.2592593h-9.2592593v-7.4074074h11.6402116l5.026455,5.026455v11.6402116ZM46.2962963,61.1114207h-7.4074074v-7.4074074h7.4074074v7.4074074ZM22.2222222,53.7040133h7.4074074v16.6666667h16.6666667v7.4074074h-19.047619l-5.026455-5.026455v-19.047619ZM77.7777711,38.8888889v7.4074074h-24.0740741v-7.4074074h8.2781918v-9.2592593h-8.2781918v-7.4074074h10.6591442l5.026455,5.026455v11.6402116h8.3884749ZM29.6296296,30.5555556h9.2592593l7.4074074,7.4074074v8.3333333h-7.4074074v-8.3333333h-9.2592593v8.3333333h-7.4074074v-24.0740741h7.4074074v8.3333333ZM46.2962963,30.5555556h-7.4074074v-8.3333333h7.4074074v8.3333333Z"})})});function An(){var k,v;const{t:e}=B("agentManager"),t=T(Ps),s=T(Me),o=T(P),a=T(Hs),r=x.useRef(void 0),l=x.useMemo(()=>rt(e),[e]);if(x.useEffect(()=>{if(!t)return;const y=r.current,g={id:t.sessionId,status:t.status};r.current=g,(y==null?void 0:y.id)===g.id&&y.status==="running"&&g.status!=="running"&&E.postMessage({type:"agentManager.cancelSession",sessionId:t.sessionId})},[t]),s&&!t)return n.jsx(Cn,{pendingSession:s});if(!t)return n.jsx(In,{});const i=o[t.sessionId],c=(i==null?void 0:i.isActive)??!1,u=(i==null?void 0:i.showSpinner)??!1,d=(k=t.parallelMode)==null?void 0:k.enabled,p=(v=t.parallelMode)==null?void 0:v.branch,m=t.sessionId.startsWith("provisional-"),h=t.status==="running",b=!!d&&h;return n.jsxs("div",{className:"am-session-detail",children:[n.jsxs("div",{className:"am-detail-header",children:[n.jsxs("div",{className:"am-header-info",children:[n.jsx("div",{className:"am-header-title",title:t.prompt,children:t.label}),n.jsxs("div",{className:"am-header-meta",children:[u&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[n.jsx(q,{size:12,className:"am-spinning"}),n.jsx("span",{children:e(a==="creating"?"status.creating":"status.running")})]}),n.jsx("span",{children:at(t.startTime,l)}),d?n.jsxs("div",{className:"am-worktree-badge",style:{display:"flex",alignItems:"center",gap:4},title:p||e("sessionDetail.runningInWorktree"),children:[n.jsx(U,{size:12}),n.jsx("span",{children:p||e("sidebar.worktree")})]}):n.jsxs("div",{className:"am-local-badge",style:{display:"flex",alignItems:"center",gap:4},title:e("sessionDetail.runningLocally"),children:[n.jsx(ne,{size:12}),n.jsx("span",{children:e("sessionDetail.runModeLocal")})]})]})]}),n.jsx("div",{className:"am-header-actions",children:!m&&n.jsx("button",{className:"am-icon-btn",onClick:()=>{E.postMessage({type:"agentManager.showTerminal",sessionId:t.sessionId})},"aria-label":e("sessionDetail.openTerminal"),title:e("sessionDetail.openTerminal"),children:n.jsx(Jt,{size:14})})})]}),t.status==="error"&&t.error&&n.jsxs("div",{className:"am-session-error-banner",role:"alert",children:[n.jsx(Ne,{size:16}),n.jsx("span",{children:t.error})]}),c&&n.jsxs("div",{className:"am-full-auto-banner",children:[n.jsx(Bt,{size:14}),n.jsx("span",{children:e("sessionDetail.autoModeWarning")})]}),n.jsx(bn,{sessionId:t.sessionId}),n.jsx(jn,{sessionId:t.sessionId,sessionLabel:t.label,isActive:c,showCancel:c,showFinishToBranch:b,worktreeBranchName:p,sessionStatus:t.status})]})}function Cn({pendingSession:e}){const{t}=B("agentManager"),s=()=>{E.postMessage({type:"agentManager.cancelPendingSession"})};return n.jsxs("div",{className:"am-session-detail",children:[n.jsxs("div",{className:"am-detail-header",children:[n.jsxs("div",{className:"am-header-info",children:[n.jsx("div",{className:"am-header-title",title:e.prompt,children:e.label}),n.jsx("div",{className:"am-header-meta",children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[n.jsx(q,{size:12,className:"am-spinning"}),n.jsx("span",{children:t("status.creating")})]})})]}),n.jsx("div",{className:"am-header-actions",children:n.jsx("button",{className:"am-icon-btn",onClick:s,"aria-label":t("sessionDetail.cancelCreating"),title:t("sessionDetail.cancelCreating"),children:n.jsx(xt,{size:14})})})]}),n.jsxs("div",{className:"am-center-form",children:[n.jsx(q,{size:48,className:"am-spinning",style:{opacity:.5}}),n.jsx("h2",{style:{marginTop:16},children:t("sessionDetail.creatingSession")}),n.jsx("p",{children:t("sessionDetail.waitingForCli")}),n.jsx("button",{className:"am-cancel-btn",onClick:s,style:{marginTop:16},children:t("sessionDetail.cancelButton")})]})]})}function In(){const{t:e}=B("agentManager"),[t,s]=x.useState(""),[o,a]=ce(Bs),[r,l]=ce(Fs),[i,c]=x.useState(!1),[u,d]=x.useState(!1),[p,m]=x.useState(!1),[h,b]=x.useState(!1),[k,v]=x.useState(null),[y,g]=x.useState(!1),j=x.useRef(null),_=x.useRef(null),M=T(Ge),I=r>1,D=I?"worktree":o;x.useEffect(()=>{M>0&&c(!1)},[M]),x.useEffect(()=>{E.postMessage({type:"agentManager.listBranches"})},[]),x.useEffect(()=>{D==="worktree"&&E.postMessage({type:"agentManager.listBranches"})},[D]),x.useEffect(()=>{const A=Ie=>{j.current&&!j.current.contains(Ie.target)&&m(!1),_.current&&!_.current.contains(Ie.target)&&b(!1)};return(p||h)&&document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[p,h]);const S=t.trim(),W=S.length===0,J=()=>{if(W||i)return;c(!0);const A=I?Ls(S.slice(0,50),r):void 0;E.postMessage({type:"agentManager.startSession",prompt:S,parallelMode:D==="worktree",versions:r,labels:A,existingBranch:k||void 0})},se=A=>{A.key==="Enter"&&!A.shiftKey&&!A.nativeEvent.isComposing&&(A.preventDefault(),J())},Ce=A=>{a(A),m(!1)},ct=A=>{l(A),b(!1)};return n.jsxs("div",{className:"am-center-form",children:[n.jsx("div",{className:"text-[var(--vscode-editor-foreground)]",style:{width:48,height:48,margin:"0 auto 16px auto"},children:n.jsx(Mn,{})}),n.jsx("div",{style:{width:"100%",maxWidth:"100%",minWidth:"280px"},children:n.jsxs("div",{className:N("relative","flex","flex-col-reverse","min-h-0","overflow-visible","rounded"),children:[n.jsx(qe,{autoFocus:!0,value:t,onChange:A=>s(A.target.value),onKeyDown:se,onFocus:()=>d(!0),onBlur:()=>d(!1),"aria-label":e("sessionDetail.startNewAgent"),disabled:i,placeholder:e("sessionDetail.placeholderTask"),minRows:5,maxRows:12,style:{paddingTop:"12px",paddingBottom:"40px",paddingLeft:"16px",paddingRight:"36px"},className:N("w-full","text-vscode-input-foreground","font-vscode-font-family","text-vscode-editor-font-size","leading-vscode-editor-line-height","cursor-text",u?"border border-vscode-focusBorder outline outline-vscode-focusBorder":"border border-vscode-input-border","bg-vscode-input-background","transition-background-color duration-150 ease-in-out","will-change-background-color","box-border","rounded","resize-none","overflow-x-hidden","overflow-y-auto","flex-none flex-grow","z-[2]","scrollbar-none","scrollbar-hide")}),n.jsx("div",{className:"absolute bottom-[1px] left-2 right-2 h-10 bg-gradient-to-t from-[var(--vscode-input-background)] via-[var(--vscode-input-background)] to-transparent pointer-events-none z-[2]","aria-hidden":"true"}),n.jsxs("div",{className:"absolute bottom-2 right-2 z-30 flex items-center gap-2",children:[n.jsxs("div",{ref:j,className:"am-run-mode-dropdown-inline relative",children:[n.jsx(Q,{content:I?e("sessionDetail.versionsHelperText",{count:r}):e(D==="local"?"sessionDetail.runModeLocal":"sessionDetail.runModeWorktree"),children:n.jsxs("button",{className:N("am-run-mode-trigger-inline",I&&"am-locked"),onClick:()=>!I&&m(!p),disabled:i||I,type:"button",children:[D==="local"?n.jsx(ne,{size:14}):n.jsx(U,{size:14}),!I&&n.jsx(X,{size:10,className:N("am-chevron",p&&"am-open")})]})}),p&&!I&&n.jsxs("div",{className:"am-run-mode-menu-inline",children:[n.jsxs("button",{className:N("am-run-mode-option-inline",o==="local"&&"am-selected"),onClick:()=>Ce("local"),type:"button",children:[n.jsx(ne,{size:12}),n.jsx("span",{children:e("sessionDetail.runModeLocal")}),o==="local"&&n.jsx("span",{className:"am-checkmark",children:""})]}),n.jsxs("button",{className:N("am-run-mode-option-inline",o==="worktree"&&"am-selected"),onClick:()=>Ce("worktree"),type:"button",children:[n.jsx(U,{size:12}),n.jsx("span",{className:"am-run-mode-label",children:e("sessionDetail.runModeWorktree")}),o==="worktree"&&n.jsx("span",{className:"am-checkmark",children:""})]})]})]}),n.jsxs("div",{ref:_,className:"am-run-mode-dropdown-inline relative",children:[n.jsx(Q,{content:e("sessionDetail.versionsTooltip"),children:n.jsxs("button",{className:"am-run-mode-trigger-inline",onClick:()=>b(!h),disabled:i,type:"button",title:e("sessionDetail.versions"),children:[n.jsx(Ut,{size:14}),n.jsx("span",{className:"am-version-count",children:r}),n.jsx(X,{size:10,className:N("am-chevron",h&&"am-open")})]})}),h&&n.jsx("div",{className:"am-run-mode-menu-inline",children:Rs.map(A=>n.jsxs("button",{className:N("am-run-mode-option-inline",r===A&&"am-selected"),onClick:()=>ct(A),type:"button",children:[n.jsx("span",{children:e("sessionDetail.versionCount",{count:A})}),r===A&&n.jsx("span",{className:"am-checkmark",children:""})]},A))})]}),D==="worktree"&&!I&&n.jsx(Q,{content:e("sessionDetail.branchPickerTooltip"),children:n.jsxs("button",{className:"am-run-mode-trigger-inline",onClick:()=>g(!0),disabled:i,type:"button",title:e("sessionDetail.selectBranch"),children:[n.jsx(U,{size:14}),n.jsx("span",{className:"truncate max-w-[80px] text-sm",children:k||e("sessionDetail.selectBranch")}),n.jsx(X,{size:10,className:"am-chevron"})]})}),n.jsx("button",{className:N("relative inline-flex items-center justify-center","bg-transparent border-none p-1.5","rounded-md min-w-[28px] min-h-[28px]","opacity-60 hover:opacity-100 text-vscode-descriptionForeground hover:text-vscode-foreground","transition-all duration-150","hover:bg-[rgba(255,255,255,0.03)] hover:border-[rgba(255,255,255,0.15)]","focus:outline-none focus-visible:ring-1 focus-visible:ring-vscode-focusBorder","active:bg-[rgba(255,255,255,0.1)]",!W&&!i&&"cursor-pointer",(W||i)&&"opacity-40 cursor-not-allowed grayscale-[30%] hover:bg-transparent hover:border-[rgba(255,255,255,0.08)] active:bg-transparent"),onClick:J,disabled:W||i,"aria-label":e(i?"sessionDetail.starting":"sessionDetail.startAriaLabel"),title:I?e("sessionDetail.launchVersions",{count:r}):e("sessionDetail.startAgent"),children:i?n.jsx(q,{size:16,className:"am-spinning"}):n.jsx(Oe,{size:16})})]}),!t&&n.jsx("div",{className:"absolute left-3 right-[140px] z-30 flex items-center h-8 overflow-hidden text-ellipsis whitespace-nowrap",style:{bottom:"0.25rem",color:"var(--vscode-descriptionForeground)",opacity:.7,fontSize:"11px",userSelect:"none",pointerEvents:"none"},children:e("sessionDetail.keyboardHint")})]})}),y&&n.jsx(Nn,{selectedBranch:k,onSelect:v,onClose:()=>g(!1)})]})}function Tn(){return n.jsx(vs,{children:n.jsx(vt,{delayDuration:bt,children:n.jsx(En,{})})})}function En(){sn();const e=T(O);return ln(e),n.jsxs("div",{className:"agent-manager-container",children:[n.jsx(dn,{}),n.jsx(An,{})]})}yt();const Le=document.getElementById("root");Le&&wt.createRoot(Le).render(n.jsx(je.StrictMode,{children:n.jsx(Dt,{i18n:_t,children:n.jsx("div",{className:"am-app-wrapper",children:n.jsx(kt,{children:n.jsx(Tn,{})})})})}));E.postMessage({type:"agentManager.webviewReady"});
//# sourceMappingURL=agent-manager.js.map
